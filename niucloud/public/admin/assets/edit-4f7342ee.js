import{d as G,O as M,f as W,r as g,q as X,N as u,v as Y,y as v,h as k,c as A,a as n,u as i,t as m,I as H,w as a,e as t,cP as P,i as r,z as c,cM as J,B as Q,W as Z,X as ee,ay as le,az as te,cI as ae,cK as oe,Y as ie,_ as ue,E as re,$ as de}from"./index-1d549745.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                     *//* empty css                       *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                          *//* empty css               *//* empty css                    *//* empty css                 *//* empty css                       */import{c as ne,g as se,e as pe}from"./marketing-2e804786.js";import me from"./goods-select-popup-aeb12c21.js";/* empty css                   *//* empty css                      *//* empty css                  *//* empty css                  *//* empty css                        */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css                        */import"./goods_default-664bb559.js";import"./goods-af228f6a.js";import"./_plugin-vue_export-helper-c27b6911.js";const ve={class:"main-container"},_e={class:"detail-head"},ce=n("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1),fe={class:"ml-[1px]"},ye=n("span",{class:"adorn"},"|",-1),ge={class:"right"},Ve={class:"flex items-center",style:{"padding-left":"5px"}},be={class:"flex items-center",style:{"padding-left":"5px"}},he={class:"w-[220px]",style:{"padding-left":"5px"}},xe=n("div",{class:"form-tip"},"开启手动领取后，会员可以直接在优惠券列表以及优惠券推广中直接领取",-1),Ce={class:"w-[180px]"},we=n("div",{class:"form-tip"},"每个会员通过前端直接可领用数量",-1),ke={class:"fixed-footer-wrap"},Pe={class:"fixed-footer"},tl=G({__name:"edit",setup(Ue){const U=M(),E=W(),R=parseInt(U.query.id),f=g(!1),T=new Date,D=g(null),V=new Date;V.setTime(V.getTime()+3600*1e3*2*360);const e=g({...{title:"",price:"",type:1,limit:2,receive_type:2,remain_count:1e3,threshold:2,limit_count:"",min_condition_money:"",length:30,goods_ids:[],goods_category_ids:[],receive_type_time:2,valid_type:1,receive_time:[T,V],valid_time:V}}),b=g(),I=X(()=>({title:[{required:!0,message:u("titlePlaceholder"),trigger:"blur"}],price:[{required:!0,validator:N,trigger:"blur"}],remain_count:[{required:!0,validator:S,trigger:"blur"}],limit_count:[{required:!0,validator:q,trigger:"blur"}]})),S=(_,l,s)=>{e.value.remain_count!=""&&e.value.remain_count>1e5&&s(new Error(u("remainCountPlaceholder"))),s()},N=(_,l,s)=>{e.value.price!=""&&e.value.price<.01&&s(new Error(u("pricePlaceholder"))),s()},q=(_,l,s)=>{e.value.limit_count!=""&&e.value.limit_count<1&&s(new Error(u("userLimitCountPlaceholder"))),s()},B={multiple:!0},h=g([]),x=()=>{se({}).then(_=>{h.value=_.data.goods_category_tree})};x();const L=async _=>{f.value||!_||await _.validate(async l=>{if(l){f.value=!0;const s=e.value;pe(s).then(p=>{f.value=!1,history.back()}).catch(p=>{f.value=!1})}})};Y(async()=>{F(R)});const F=_=>{f.value=!0,ne(_).then(l=>{e.value=Object.assign(e.value,l.data),f.value=!1}).catch(()=>{f.value=!1})},K=()=>{history.back()};return(_,l)=>{const s=Z,d=ee,p=le,y=te,$=ae,C=oe,j=ie,z=ue,w=re,O=de;return v((k(),A("div",ve,[n("div",_e,[n("div",{class:"left",onClick:l[0]||(l[0]=o=>i(E).push("/shop/marketing/coupon/list"))},[ce,n("span",fe,m(i(u)("returnToPreviousPage")),1)]),ye,n("span",ge,m(i(u)("editCoupon")),1)]),Object.keys(e.value).length?(k(),H(z,{key:0,class:"box-card !border-none page-height",shadow:"never"},{default:a(()=>[t(j,{model:e.value,"label-width":"120px",ref_key:"formRef",ref:b,rules:i(I),class:"page-form"},{default:a(()=>[t(d,{label:i(u)("title"),prop:"title"},{default:a(()=>[t(s,{modelValue:e.value.title,"onUpdate:modelValue":l[1]||(l[1]=o=>e.value.title=o),clearable:"",placeholder:i(u)("titlePlaceholder"),class:"input-width",maxlength:20},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(d,{label:i(u)("price"),prop:"price"},{default:a(()=>[t(s,{modelValue:e.value.price,"onUpdate:modelValue":l[2]||(l[2]=o=>e.value.price=o),onKeyup:l[3]||(l[3]=o=>i(P)(o)),clearable:"",placeholder:i(u)("pricePlaceholder"),class:"input-width",maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(d,{label:i(u)("type"),prop:"type"},{default:a(()=>[t(y,{modelValue:e.value.type,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.type=o)},{default:a(()=>[t(p,{label:1},{default:a(()=>[r("通用券")]),_:1}),t(p,{label:2,onClick:x},{default:a(()=>[r("品类券")]),_:1}),t(p,{label:3},{default:a(()=>[r("商品券")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),v(t(d,null,{default:a(()=>[n("div",null,[t($,{modelValue:e.value.goods_category_ids,"onUpdate:modelValue":l[5]||(l[5]=o=>e.value.goods_category_ids=o),options:h.value,props:B,"collapse-tags":"","collapse-tags-tooltip":"",clearable:""},null,8,["modelValue","options"])])]),_:1},512),[[c,e.value.type==2]]),v(t(d,null,{default:a(()=>[n("div",null,[t(d,null,{default:a(()=>[t(me,{ref_key:"goodsSelectPopupRef",ref:D,modelValue:e.value.goods_ids,"onUpdate:modelValue":l[6]||(l[6]=o=>e.value.goods_ids=o),min:1,max:99},null,8,["modelValue"])]),_:1})])]),_:1},512),[[c,e.value.type==3]]),t(d,{label:i(u)("threshold")},{default:a(()=>[t(y,{modelValue:e.value.threshold,"onUpdate:modelValue":l[7]||(l[7]=o=>e.value.threshold=o)},{default:a(()=>[t(p,{label:1},{default:a(()=>[r(m(i(u)("reduction")),1)]),_:1}),t(p,{label:2},{default:a(()=>[r(m(i(u)("noThreshold")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),v(t(d,null,{default:a(()=>[r(" 最低满 "),n("div",Ve,[t(s,{modelValue:e.value.min_condition_money,"onUpdate:modelValue":l[8]||(l[8]=o=>e.value.min_condition_money=o),onKeyup:l[9]||(l[9]=o=>i(P)(o)),clearable:"",class:"!w-[100px]"},null,8,["modelValue"])]),r(" 元可用 ")]),_:1},512),[[c,e.value.threshold==1]]),t(d,{label:i(u)("validType")},{default:a(()=>[t(y,{modelValue:e.value.valid_type,"onUpdate:modelValue":l[10]||(l[10]=o=>e.value.valid_type=o)},{default:a(()=>[t(p,{label:1},{default:a(()=>[r(m(i(u)("days")),1)]),_:1}),t(p,{label:2},{default:a(()=>[r(m(i(u)("times")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),v(t(d,null,{default:a(()=>[r(" 领劵后立即生效，有效期 "),n("div",be,[t(s,{modelValue:e.value.length,"onUpdate:modelValue":l[11]||(l[11]=o=>e.value.length=o),onKeyup:l[12]||(l[12]=o=>i(J)(o)),clearable:"",class:"!w-[100px]"},null,8,["modelValue"]),r(" 天 ")])]),_:1},512),[[c,e.value.valid_type==1]]),v(t(d,{prop:"valid_time"},{default:a(()=>[r(" 领劵后立即生效，使用时间截止至 "),n("div",he,[t(C,{modelValue:e.value.valid_time,"onUpdate:modelValue":l[13]||(l[13]=o=>e.value.valid_time=o),type:"datetime",placeholder:i(u)("validTimePlaceholder")},null,8,["modelValue","placeholder"])])]),_:1},512),[[c,e.value.valid_type==2]]),t(d,{label:i(u)("receiveType")},{default:a(()=>[n("div",null,[t(y,{modelValue:e.value.receive_type,"onUpdate:modelValue":l[14]||(l[14]=o=>e.value.receive_type=o)},{default:a(()=>[t(p,{label:1},{default:a(()=>[r(m(i(u)("user")),1)]),_:1}),t(p,{label:2},{default:a(()=>[r(m(i(u)("grant")),1)]),_:1})]),_:1},8,["modelValue"])]),xe]),_:1},8,["label"]),v(t(d,{label:i(u)("receiveTime")},{default:a(()=>[t(y,{modelValue:e.value.receive_type_time,"onUpdate:modelValue":l[15]||(l[15]=o=>e.value.receive_type_time=o)},{default:a(()=>[t(p,{label:1},{default:a(()=>[r(m(i(u)("limitedTime")),1)]),_:1}),t(p,{label:2},{default:a(()=>[r(m(i(u)("unlimitedTime")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),[[c,e.value.receive_type==1]]),v(t(d,{prop:"receive_time"},{default:a(()=>[n("div",Ce,[t(C,{modelValue:e.value.receive_time,"onUpdate:modelValue":l[16]||(l[16]=o=>e.value.receive_time=o),type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])]),_:1},512),[[c,e.value.receive_type_time==1&&e.value.receive_type==1]]),v(t(d,{label:i(u)("receiveNumber")},{default:a(()=>[t(y,{modelValue:e.value.limit,"onUpdate:modelValue":l[17]||(l[17]=o=>e.value.limit=o)},{default:a(()=>[t(p,{label:1},{default:a(()=>[r(m(i(u)("limit")),1)]),_:1}),t(p,{label:2},{default:a(()=>[r(m(i(u)("unlimited")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),[[c,e.value.receive_type==1]]),v(t(d,{prop:"remain_count"},{default:a(()=>[n("div",null,[t(s,{onkeypress:"return( /[\\d]/.test(String.fromCharCode(event.keyCode) ) )",modelValue:e.value.remain_count,"onUpdate:modelValue":l[18]||(l[18]=o=>e.value.remain_count=o),clearable:"",placeholder:i(u)("remainCountPlaceholder"),class:"input-width",min:e.value.remain_count,max:1e5,controls:!1},{append:a(()=>[r("张")]),_:1},8,["modelValue","placeholder","min"])])]),_:1},512),[[c,e.value.limit==1&&e.value.receive_type==1]]),v(t(d,{label:i(u)("userLimitCount"),prop:"limit_count"},{default:a(()=>[t(s,{onkeypress:"return( /[\\d]/.test(String.fromCharCode(event.keyCode) ) )",modelValue:e.value.limit_count,"onUpdate:modelValue":l[19]||(l[19]=o=>e.value.limit_count=o),clearable:"",placeholder:i(u)("userLimitCountPlaceholder"),class:"input-width",min:1,max:1e5},{append:a(()=>[r("张")]),_:1},8,["modelValue","placeholder"]),we]),_:1},8,["label"]),[[c,e.value.receive_type==1]])]),_:1},8,["model","rules"])]),_:1})):Q("",!0),n("div",ke,[n("div",Pe,[t(w,{type:"primary",onClick:l[20]||(l[20]=o=>L(b.value))},{default:a(()=>[r(m(i(u)("save")),1)]),_:1}),t(w,{onClick:l[21]||(l[21]=o=>K())},{default:a(()=>[r(m(i(u)("cancel")),1)]),_:1})])])])),[[O,f.value]])}}});export{tl as default};
