import{d as te,O as le,f as re,r as g,cT as L,q as oe,N as t,v as se,bM as ie,h as w,c as C,a as d,t as u,u as l,e as r,w as i,y as E,I as N,i as p,B as de,z as B,F as ne,G as ue,A as pe,a5 as $,E as _e,X as ce,aA as ve,cQ as me,ay as fe,az as ye,W as ge,Y as xe,ap as be,_ as he,$ as we,p as Ve,g as ke}from"./index-1d549745.js";/* empty css                   *//* empty css                *//* empty css                     *//* empty css                     *//* empty css                 *//* empty css                       *//* empty css                 *//* empty css                          *//* empty css                    *//* empty css                  */import{U as Ce}from"./sys-a0a00e99.js";import{c as Ee,b as U,d as G,e as O,s as Te}from"./qqmap-1075d9c1.js";import{j as Ue,k as qe}from"./delivery-c3b692ea.js";import{T as V}from"./test-1df70a90.js";import{c as Re}from"./shop_address-cec702f8.js";import{_ as je}from"./_plugin-vue_export-helper-c27b6911.js";const q=k=>(Ve("data-v-f38ccb71"),k=k(),ke(),k),Ae={class:"main-container"},De={class:"detail-head"},Se=q(()=>d("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1)),Me={class:"ml-[1px]"},Pe=q(()=>d("span",{class:"adorn"},"|",-1)),Fe={class:"right"},Ie={class:"flex flex-col"},ze={class:"flex"},Le={key:0,class:"text-error leading-none"},Ne={class:"flex"},Be={class:"w-[60px] mx-[5px]"},$e={class:"w-[60px] mx-[5px]"},Ge={class:"w-[60px] mx-[5px]"},Oe={class:"w-[60px] mx-[5px]"},Qe={class:"flex"},We={class:"w-[60px] mx-[5px]"},Xe={class:"w-[60px] mx-[5px]"},Ye={class:"w-[60px] mx-[5px]"},He={class:"relative w-full"},Je=q(()=>d("div",{id:"container",class:"w-full h-[520px]"},null,-1)),Ke={class:"absolute bg-white w-[270px] h-[500px] z-[1000] top-[10px] left-[10px] region-list"},Ze=["onClick"],ea={class:"pb-[18px]"},aa={class:"pb-[18px]"},ta={class:"pb-[10px]"},la={class:"p-[10px] text-center"},ra={class:"fixed-footer-wrap"},oa={class:"fixed-footer"},sa=te({__name:"local",setup(k){const Q=le(),R=re(),x=g(!1),W=Q.meta.title,j=g(),T=g(),c=g(null);(async()=>{await Re().then(({data:o})=>{c.value=o}).catch()})();const e=g({center:{lat:"",lng:""},delivery_type:["business"],fee_type:"region",base_dist:"",base_price:"",grad_dist:"",grad_price:"",weight_start:0,weight_unit:0,weight_price:0,area:[{area_name:"",area_type:"radius",start_price:0,delivery_price:0,area_json:{key:L()}}]}),A=oe(()=>({delivery_address:[{validator:(o,a,s)=>{c.value||s(new Error(t("defaultDeliveryAddressEmpty"))),s()}}],delivery_type:[{validator:(o,a,s)=>{e.value.delivery_type.length||s(new Error(t("deliveryTypeRequire"))),s()}}],distance:[{validator:(o,a,s)=>{e.value.fee_type=="distance"&&(V.require(e.value.base_dist)&&s(new Error(t("baseDistRequire"))),V.require(e.value.base_price)&&s(new Error(t("basePriceRequire"))),V.require(e.value.grad_dist)&&s(new Error(t("gradDistRequire"))),V.require(e.value.grad_price)&&s(new Error(t("gradPriceRequire")))),s()},trigger:"blur"}],area_name:[{required:!0,message:t("areaNameRequire"),trigger:"blur"}],start_price:[{required:!0,message:t("startPriceRequire"),trigger:"blur"},{validator:(o,a,s)=>{parseInt(a)<0&&s(new Error(t("startPriceMin"))),s()},trigger:"blur"}],delivery_price:[{required:e.value.fee_type=="region",message:t("deliveryPriceRequire"),trigger:"blur"},{validator:(o,a,s)=>{parseInt(a)<0&&s(new Error(t("deliveryPriceMin"))),s()},trigger:"blur"}],area:[{validator:(o,a,s)=>{V.empty(e.value.area)&&s(new Error(t("areaPlaceholder"))),s()},trigger:"blur"}]}));Ue().then(({data:o})=>{o&&Object.assign(e.value,o)}).catch(),se(()=>{const o=document.createElement("script");Ce().then(a=>{o.type="text/javascript",o.src="https://map.qq.com/api/gljs?libraries=tools,service&v=1.exp&key="+a.data.key,document.body.appendChild(o)}),o.onload=()=>{setTimeout(()=>{X()},500)}});let y;const D=g(!0),X=()=>{const o=window.TMap,a=o.LatLng,s=new a(c.value?c.value.lat:39.980619,c.value?c.value.lng:116.321277);y=new o.Map("container",{center:s,zoom:14}),Ee(y),y.on("tilesloaded",()=>{D.value=!1}),e.value.area.forEach(_=>{_.area_type=="radius"?U(y,_.area_json):G(y,_.area_json)})},S=g(0),Y=()=>{e.value.area.push({area_name:"",area_type:"radius",start_price:0,delivery_price:0,area_json:{key:L()}});const o=e.value.area.length-1;U(y,e.value.area[o].area_json)},H=o=>{const a=e.value.area[o];O(a.area_json.key),e.value.area.splice(o,1)},J=o=>{S.value=o;const a=e.value.area[o];Te(a.area_json.key)},K=o=>{const a=e.value.area[o];O(a.area_json.key),a.area_type=="radius"?U(y,a.area_json):G(y,a.area_json)};ie(()=>{y.destroy()});const Z=async o=>{x.value||!o||await o.validate(async a=>{var _;let s=!0;for(let b=0;b<((_=T.value)==null?void 0:_.length)&&(await T.value[b].validate(async h=>{s=h}),!!s);b++);s&&a&&(x.value=!0,e.value.center={lat:c.value.lat,lng:c.value.lng},await o.validate(async b=>{qe(e.value).then(()=>{x.value=!1}).catch(()=>{x.value=!1})}))})},M=()=>{R.push({path:"/shop/order/delivery"})};return(o,a)=>{const s=_e,_=ce,b=ve,P=me,h=fe,F=ye,m=ge,I=xe,ee=be,ae=he,z=we;return w(),C("div",Ae,[d("div",De,[d("div",{class:"left",onClick:M},[Se,d("span",Me,u(l(t)("returnToPreviousPage")),1)]),Pe,d("span",Fe,u(l(W)),1)]),r(ae,{class:"box-card !border-none",shadow:"never"},{default:i(()=>[E((w(),N(I,{"label-width":"120px",ref_key:"formRef",ref:j,rules:l(A),model:e.value,class:"page-form"},{default:i(()=>[r(_,{label:l(t)("deliveryAddress"),prop:"delivery_address"},{default:i(()=>[d("div",Ie,[d("div",ze,[p(u(c.value?c.value.full_address:l(t)("defaultDeliveryAddressEmpty"))+" ",1),r(s,{type:"primary",onClick:a[0]||(a[0]=n=>l(R).push("/shop/order/address")),link:"",class:"ml-[10px]"},{default:i(()=>[p(u(c.value?l(t)("update"):l(t)("toSetting")),1)]),_:1})]),e.value.center.lat&&c.value&&(e.value.center.lat!=c.value.lat||e.value.center.lng!=c.value.lng)?(w(),C("div",Le,u(l(t)("deliveryAddressChange")),1)):de("",!0)])]),_:1},8,["label"]),r(_,{label:l(t)("deliveryType"),prop:"delivery_type"},{default:i(()=>[r(P,{modelValue:e.value.delivery_type,"onUpdate:modelValue":a[1]||(a[1]=n=>e.value.delivery_type=n)},{default:i(()=>[r(b,{label:"business"},{default:i(()=>[p(u(l(t)("business")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),r(_,{label:l(t)("feeType")},{default:i(()=>[r(F,{modelValue:e.value.fee_type,"onUpdate:modelValue":a[2]||(a[2]=n=>e.value.fee_type=n)},{default:i(()=>[r(h,{label:"region"},{default:i(()=>[p(u(l(t)("region")),1)]),_:1}),r(h,{label:"distance"},{default:i(()=>[p(u(l(t)("distance")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),E(r(_,{label:l(t)("feeSetting"),prop:"distance"},{default:i(()=>[d("div",Ne,[d("div",Be,[r(m,{modelValue:e.value.base_dist,"onUpdate:modelValue":a[3]||(a[3]=n=>e.value.base_dist=n),modelModifiers:{number:!0},type:"text"},null,8,["modelValue"])]),p(" "+u(l(t)("feeSettingTextOne"))+" ",1),d("div",$e,[r(m,{modelValue:e.value.base_price,"onUpdate:modelValue":a[4]||(a[4]=n=>e.value.base_price=n),type:"text"},null,8,["modelValue"])]),p(" "+u(l(t)("feeSettingTextTwo"))+" ",1),d("div",Ge,[r(m,{modelValue:e.value.grad_dist,"onUpdate:modelValue":a[5]||(a[5]=n=>e.value.grad_dist=n),modelModifiers:{number:!0},type:"text"},null,8,["modelValue"])]),p(" "+u(l(t)("feeSettingTextThree"))+" ",1),d("div",Oe,[r(m,{modelValue:e.value.grad_price,"onUpdate:modelValue":a[6]||(a[6]=n=>e.value.grad_price=n),type:"text"},null,8,["modelValue"])]),p(" "+u(l(t)("priceUnit")),1)])]),_:1},8,["label"]),[[B,e.value.fee_type=="distance"]]),r(_,{label:l(t)("weightFee"),prop:""},{default:i(()=>[d("div",Qe,[p(u(l(t)("weightFeeTextOne"))+" ",1),d("div",We,[r(m,{modelValue:e.value.weight_start,"onUpdate:modelValue":a[7]||(a[7]=n=>e.value.weight_start=n),type:"text"},null,8,["modelValue"])]),p(" "+u(l(t)("weightFeeTextTwo"))+" ",1),d("div",Xe,[r(m,{modelValue:e.value.weight_unit,"onUpdate:modelValue":a[8]||(a[8]=n=>e.value.weight_unit=n),type:"text"},null,8,["modelValue"])]),p(" "+u(l(t)("weightFeeTextThree"))+" ",1),d("div",Ye,[r(m,{modelValue:e.value.weight_price,"onUpdate:modelValue":a[9]||(a[9]=n=>e.value.weight_price=n),type:"text"},null,8,["modelValue"])]),p(" "+u(l(t)("priceUnit")),1)])]),_:1},8,["label"]),E((w(),N(_,{prop:"area"},{default:i(()=>[d("div",He,[Je,d("div",Ke,[r(ee,null,{default:i(()=>[(w(!0),C(ne,null,ue(e.value.area,(n,v)=>(w(),C("div",{class:pe(["p-[10px] region-item pr-[50px] relative",{"!border-primary":v==S.value}]),key:v,onClick:f=>J(v)},[r(I,{"label-width":"80px",model:n,rules:l(A),class:"page-form",ref_for:!0,ref_key:"areaFromRef",ref:T},{default:i(()=>[d("div",ea,[r(_,{label:l(t)("areaName"),prop:"area_name"},{default:i(()=>[r(m,{modelValue:e.value.area[v].area_name,"onUpdate:modelValue":f=>e.value.area[v].area_name=f,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),d("div",aa,[r(_,{label:l(t)("startPrice"),prop:"start_price"},{default:i(()=>[r(m,{modelValue:e.value.area[v].start_price,"onUpdate:modelValue":f=>e.value.area[v].start_price=f,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),E(d("div",ta,[r(_,{label:l(t)("deliveryPrice"),prop:"delivery_price"},{default:i(()=>[r(m,{modelValue:e.value.area[v].delivery_price,"onUpdate:modelValue":f=>e.value.area[v].delivery_price=f,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])],512),[[B,e.value.fee_type=="region"]]),r(_,{label:l(t)("areaType")},{default:i(()=>[r(F,{modelValue:e.value.area[v].area_type,"onUpdate:modelValue":f=>e.value.area[v].area_type=f,onClick:a[10]||(a[10]=$(()=>{},["stop"])),onChange:f=>K(v)},{default:i(()=>[r(h,{label:"radius",size:"large",class:"!mr-[10px]"},{default:i(()=>[p(u(l(t)("radius")),1)]),_:1}),r(h,{label:"custom",size:"large",class:"!mr-[0px]"},{default:i(()=>[p(u(l(t)("custom")),1)]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label"])]),_:2},1032,["model","rules"]),r(s,{type:"primary",link:"",class:"absolute z-1 top-[10px] right-[10px]",onClick:$(f=>H(v),["stop"])},{default:i(()=>[p(u(l(t)("delete")),1)]),_:2},1032,["onClick"])],10,Ze))),128)),d("div",la,[r(s,{type:"default",plain:"",onClick:Y},{default:i(()=>[p(u(l(t)("addDeliveryArea")),1)]),_:1})])]),_:1})])])]),_:1})),[[z,D.value]])]),_:1},8,["rules","model"])),[[z,x.value]])]),_:1}),d("div",ra,[d("div",oa,[r(s,{type:"primary",onClick:a[11]||(a[11]=n=>Z(j.value)),disabled:x.value},{default:i(()=>[p(u(l(t)("save")),1)]),_:1},8,["disabled"]),r(s,{onClick:a[12]||(a[12]=n=>M())},{default:i(()=>[p(u(l(t)("cancel")),1)]),_:1})])])])}}});const Ca=je(sa,[["__scopeId","data-v-f38ccb71"]]);export{Ca as default};
