import{d as Y,O as H,f as J,r as D,n as E,q as K,N as l,v as Q,h as m,c as f,a as c,t as _,u as s,e as r,w as n,F as x,G as P,I as M,i as L,s as Z,W as ee,X as te,as as ae,aE as le,E as oe,Y as se,_ as re,p as de,g as ie}from"./index-a2233f8b.js";/* empty css                *//* empty css                *//* empty css                  *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import{_ as ne}from"./index-58cd4749.js";import"./el-form-item-4ed993c7.js";import{r as ce,t as ue,u as me}from"./delivery-af7aa755.js";import{V as pe,af as _e,ad as I,ag as ge,ah as ve}from"./sys-6f61a94e.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                        */import"./index.vue_vue_type_style_index_0_lang-a6915b29.js";/* empty css                   */import"./attachment-181b3017.js";/* empty css                   *//* empty css                      *//* empty css                    *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css                    *//* empty css                         *//* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-be5440b6.js";/* empty css                */const C=y=>(de("data-v-0f342351"),y=y(),ie(),y),he={class:"main-container"},be={class:"detail-head"},ye=C(()=>c("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1)),we={class:"ml-[1px]"},Ve=C(()=>c("span",{class:"adorn"},"|",-1)),ke={key:0,class:"right"},xe={key:1,class:"right"},Pe={class:"text-[12px] text-[#999]"},Me=C(()=>c("div",{class:"mt-4"},[c("div",{id:"TxMap",class:"map-item w-[800px] h-[500px]"})],-1)),Le={class:"fixed-footer-wrap"},Ce={class:"fixed-footer"},Te=Y({__name:"store_edit",setup(y){const F=H(),T=J(),w=parseInt(F.query.id),V=D(!1),q={store_id:0,store_name:"",store_desc:"",store_logo:"",store_mobile:"",province_id:0,province_name:"",city_id:0,city_name:"",district_id:0,district_name:"",address:"",full_address:"",longitude:"",latitude:"",trade_time:""},e=E({...q});w&&(async(a=0)=>{Object.assign(e,q);const t=await(await ce(a)).data;Object.keys(e).forEach(d=>{t[d]!=null&&(e[d]=t[d])})})(w);const S=D(),U=K(()=>({store_name:[{required:!0,message:l("storeNamePlaceholder"),trigger:"blur"}],store_logo:[{required:!0,message:l("storeLogoPlaceholder"),trigger:"blur"}],store_mobile:[{required:!0,message:l("storeMobilePlaceholder"),trigger:"blur"}],province_id:[{required:!0,message:l("provinceIdPlaceholder"),trigger:"blur"}],city_id:[{required:!0,message:l("cityIdPlaceholder"),trigger:"blur"}],district_id:[{required:!0,message:l("districtIdPlaceholder"),trigger:"blur"}],address_area:[{required:!0,validator:j,trigger:"blur"}],address:[{required:!0,message:l("storeAddressDetailPlaceholder"),trigger:"blur"}],trade_time:[{required:!0,message:l("tradeTimePlaceholder"),trigger:"blur"}]})),j=(a,t,d)=>{(e.province_name==""||e.city_name==""||e.district_name=="")&&d(new Error(l("storeAddressPlaceholder"))),d()},N=async a=>{V.value||!a||await a.validate(async t=>{t&&(V.value=!0,(w?ue:me)(e).then(p=>{V.value=!1,T.push("/shop/order/delivery/store")}).catch(()=>{V.value=!1}))})},g=E({province:[],city:[],district:[]});(()=>{_e(1).then(a=>{g.province=a.data})})();const O=a=>{Object.keys(a).length==0?a.id=e.province_id:(e.province_id=a.id,e.province_name=a.name),I(a.id).then(t=>{g.city=t.data})},B=a=>{Object.keys(a).length==0?a.id=e.city_id:(e.city_id=a.id,e.city_name=a.name),I(a.id).then(t=>{g.district=t.data})},R=a=>{e.district_id=a.id,e.district_name=a.name},G=()=>{e.province_id&&e.city_id&&e.district_id&&e.address&&(e.full_address=e.province_name+e.city_name+e.district_name+e.address,ge({address:e.full_address}).then(a=>{e.latitude=a.data.result.location.lat,e.longitude=a.data.result.location.lng}))};let h;const z=()=>{let a=e.latitude,t=e.longitude;e.latitude==0&&(a="39.90469"),e.longitude==0&&(t="116.40717");const d=new window.TMap.LatLng(a,t);h=new window.TMap.Map("TxMap",{center:d,zoom:17,viewMode:"2D",showControl:!0}),h.on("click",p=>{const u={lat:p.latLng.getLat().toFixed(6),lng:p.latLng.getLng().toFixed(6)};$(u.lat,u.lng,1),i.updateGeometries({id:"shop",position:p.latLng})});const i=new window.TMap.MultiMarker({id:"marker-layer",map:h,minimumClusterSize:1});i.updateGeometries({id:"shop",position:d}),h.on("idle",()=>{Z(()=>e.latitude,(p,u)=>{const v=new window.TMap.LatLng(e.latitude,e.longitude);h.panTo(v,1),i.updateGeometries({id:"shop",position:v})})})};Q(()=>{const a=document.createElement("script");pe().then(t=>{a.type="text/javascript",a.src="https://map.qq.com/api/gljs?v=1.exp&key="+t.data.key,document.body.appendChild(a)}),a.onload=()=>{setTimeout(()=>{z()},500)}});const $=(a,t,d)=>{ve({location:a+","+t}).then(i=>{e.province_name=i.data.result.address_component.province,e.city_name=i.data.result.address_component.city,e.district_name=i.data.result.address_component.district,d==1&&(e.address=i.data.result.formatted_addresses.recommend,e.full_address=e.province_name+e.city_name+e.district_name+e.address,e.latitude=a,e.longitude=t)})},A=()=>{T.push("/shop/order/delivery/store")};return(a,t)=>{const d=ee,i=te,p=ne,u=ae,v=le,k=oe,W=se,X=re;return m(),f("div",he,[c("div",be,[c("div",{class:"left",onClick:t[0]||(t[0]=o=>A())},[ye,c("span",we,_(s(l)("returnToPreviousPage")),1)]),Ve,s(w)?(m(),f("span",ke,_(s(l)("updateStore")),1)):(m(),f("span",xe,_(s(l)("addStore")),1))]),r(X,{class:"box-card !border-none",shadow:"never"},{default:n(()=>[r(W,{model:e,"label-width":"140px",ref_key:"formRef",ref:S,rules:s(U),class:"page-form"},{default:n(()=>[r(i,{label:s(l)("storeName"),prop:"store_name"},{default:n(()=>[r(d,{modelValue:e.store_name,"onUpdate:modelValue":t[1]||(t[1]=o=>e.store_name=o),clearable:"",placeholder:s(l)("storeNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(i,{label:s(l)("storeDesc")},{default:n(()=>[r(d,{modelValue:e.store_desc,"onUpdate:modelValue":t[2]||(t[2]=o=>e.store_desc=o),type:"textarea",rows:"4",clearable:"",placeholder:s(l)("storeDescPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(i,{label:s(l)("storeLogo")},{default:n(()=>[r(p,{modelValue:e.store_logo,"onUpdate:modelValue":t[3]||(t[3]=o=>e.store_logo=o)},null,8,["modelValue"])]),_:1},8,["label"]),r(i,{label:s(l)("storeMobile"),prop:"store_mobile"},{default:n(()=>[r(d,{modelValue:e.store_mobile,"onUpdate:modelValue":t[4]||(t[4]=o=>e.store_mobile=o),clearable:"",placeholder:s(l)("storeMobilePlaceholder"),class:"input-width",onkeyup:"this.value = this.value.replace(/[^\\d\\.]/g,'');"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(i,{label:s(l)("tradeTime"),prop:"trade_time"},{default:n(()=>[c("div",null,[r(d,{modelValue:e.trade_time,"onUpdate:modelValue":t[5]||(t[5]=o=>e.trade_time=o),clearable:"",placeholder:s(l)("tradeTimePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"]),c("p",Pe,_(s(l)("tradeTimeTips")),1)])]),_:1},8,["label"]),r(i,{label:s(l)("storeAddress"),prop:"address_area"},{default:n(()=>[r(v,{modelValue:e.province_name,"onUpdate:modelValue":t[6]||(t[6]=o=>e.province_name=o),"value-key":"id",clearable:"",class:"w-[200px]",onChange:O},{default:n(()=>[r(u,{label:s(l)("provincePlaceholder"),value:""},null,8,["label"]),(m(!0),f(x,null,P(g.province,(o,b)=>(m(),M(u,{key:b,label:o.name,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(v,{modelValue:e.city_name,"onUpdate:modelValue":t[7]||(t[7]=o=>e.city_name=o),"value-key":"id",clearable:"",class:"w-[200px] ml-3",onChange:B},{default:n(()=>[r(u,{label:s(l)("cityPlaceholder"),value:""},null,8,["label"]),(m(!0),f(x,null,P(g.city,(o,b)=>(m(),M(u,{key:b,label:o.name,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(v,{modelValue:e.district_name,"onUpdate:modelValue":t[8]||(t[8]=o=>e.district_name=o),"value-key":"id",clearable:"",class:"w-[200px] ml-3",onChange:R},{default:n(()=>[r(u,{label:s(l)("districtPlaceholder"),value:""},null,8,["label"]),(m(!0),f(x,null,P(g.district,(o,b)=>(m(),M(u,{key:b,label:o.name,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),r(i,{label:s(l)("storeAddressDetail"),prop:"address"},{default:n(()=>[c("div",null,[c("div",null,[r(d,{modelValue:e.address,"onUpdate:modelValue":t[9]||(t[9]=o=>e.address=o),clearable:"",placeholder:s(l)("storeAddressDetailPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"]),r(k,{class:"ml-3",onClick:G},{default:n(()=>[L(_(s(l)("search")),1)]),_:1})]),Me])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1}),c("div",Le,[c("div",Ce,[r(k,{type:"primary",onClick:t[10]||(t[10]=o=>N(S.value))},{default:n(()=>[L(_(s(l)("save")),1)]),_:1}),r(k,{onClick:t[11]||(t[11]=o=>A())},{default:n(()=>[L(_(s(l)("cancel")),1)]),_:1})])])])}}});const nt=fe(Te,[["__scopeId","data-v-0f342351"]]);export{nt as default};
