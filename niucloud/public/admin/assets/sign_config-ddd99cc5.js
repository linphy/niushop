import{d as de,v as ue,r as m,l as D,k as a,h as r,c as p,J as G,m as y,w as i,e as d,a as u,t as o,u as n,B as b,F as z,O as H,i as h,Q as f,aw as ce,G as _e,af as pe,a0 as me,E as fe,a1 as ve,D as ge,K as we,H as ye,V as be,L as he,p as xe,g as ke}from"./index-e4c6b343.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                *//* empty css                 *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css               *//* empty css                        */import"./el-form-item-4ed993c7.js";/* empty css                  */import{h as Se,i as J,s as Ce}from"./member-23fa123f.js";import Ve from"./sign-day-0907e59b.js";import Ee from"./sign-continue-48d44767.js";import{_ as Ae}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                 */import"./test-71dfb9c1.js";const K=T=>(xe("data-v-28f677b3"),T=T(),ke(),T),De={class:"main-container"},Te={class:"text-page-title"},Oe=K(()=>u("span",{class:"ml-[10px]"},"天",-1)),$e={key:0},Be={key:1,class:"flex ml-[5px]"},Re=K(()=>u("span",{class:"ml-[5px] mr-[5px]"},"|",-1)),Fe={class:"form-tip"},Ie={class:"form-tip"},Ue={class:"mt-[10px]"},Pe={key:0},Le={key:0},Me={key:1},Ne={class:"flex mt-[10px]"},je={class:"form-tip"},qe={class:"flex"},Ge={class:"dialog-footer"},ze={class:"dialog-footer"},He={class:"fixed-footer-wrap"},Je={class:"fixed-footer"},Ke=de({__name:"sign_config",setup(T){ue().meta.title,m("signSet");const E=m(!0),A=m(!1),S=m(!1),I=m(),c=m({});let O=!1,$=0;const Q=D({sign_period:[{required:!0,message:a("signPeriodTip"),trigger:"blur"}],day_award:[{required:!0,message:a("daySignAwardPlaceholder"),trigger:"change"}]}),v=D({gifts:[]}),R=m([]),t=D({is_use:0,sign_period:30,day_award:"",continue_award:[],rule_explain:""}),x=D({receive_num:"",continue_sign:"",receive_limit:"",continue_award:[]}),g=D({loading:!1,data:[]});(async()=>{const s=await(await Se()).data;Object.keys(t).forEach(e=>{s[e]!=null&&(t[e]=s[e])}),t.day_award&&(v.gifts=t.day_award,U()),t.continue_award&&t.continue_award.forEach((e,k)=>{g.data.push(f(e)),v.gifts=[];const _=f(e);delete _.continue_sign,delete _.continue_tag,delete _.receive_limit,delete _.receive_num,v.gifts=_,P(v,e,k)}),E.value=!1})();const B=m([]),U=async()=>{const s=await(await J(v)).data;B.value=[],Object.values(s).forEach(e=>{B.value.push(e)})},P=async(s,e,k=0,_=0)=>{const F=await(await J(s)).data;R.value=[],Object.values(F).forEach(C=>{R.value.push(C)}),x.receive_num=e.receive_num,x.continue_sign=e.continue_sign,x.receive_limit=e.receive_limit,x.continue_award=R.value,O?g.data.splice($,1,f(x)):_==0?g.data.splice(k,1,f(x)):g.data.push(f(x)),O=!1,$=0},W=async s=>{E.value||!s||await s.validate(e=>{if(e){const k=f(t);Ce(k).then(()=>{E.value=!1}).catch(()=>{E.value=!1})}})},L=()=>{A.value=!0},M=m(null),X=async()=>{var s;await((s=M.value)==null?void 0:s.verify())&&(A.value=!1,!t.day_award.hasOwnProperty("balance")&&!t.day_award.hasOwnProperty("point")&&t.day_award.shop_coupon.is_use==0&&(t.day_award=""),v.gifts=t.day_award,U())},Y=()=>{t.day_award="",B.value=[]},Z=()=>{c.value="",S.value=!0},ee=(s,e)=>{O=s,$=e,c.value=t.continue_award[e],S.value=!0},N=m(null),te=async()=>{var s;if(await((s=N.value)==null?void 0:s.verify())&&(S.value=!1,!c.value.hasOwnProperty("balance")&&!c.value.hasOwnProperty("point")&&c.value.shop_coupon.is_use==0&&(c.value=""),Object.keys(c.value).length>0)){const e=f(c.value);delete e.continue_sign,delete e.continue_tag,delete e.receive_limit,delete e.receive_num,v.gifts=e,t.continue_award.length>0&&t.continue_award.length-1,P(v,c.value,0,1),O?t.continue_award.splice($,1,f(c.value)):t.continue_award.push(f(c.value))}},ae=s=>{g.data.splice(s,1),t.continue_award.splice(s,1)},ne=()=>{t.rule_explain=a("ruleExplainDefault")};return(s,e)=>{const k=ce,_=_e,F=pe,C=me,w=fe,le=ve,ie=ge,oe=we,se=ye,j=be,q=he;return r(),p("div",De,[G((r(),y(se,{class:"page-form",model:t,"label-width":"150px",ref_key:"ruleFormRef",ref:I,rules:Q},{default:i(()=>[d(oe,{class:"box-card !border-none",shadow:"never"},{default:i(()=>[u("h3",Te,o(n(a)("signRule")),1),d(_,{label:n(a)("isUse")},{default:i(()=>[d(k,{modelValue:t.is_use,"onUpdate:modelValue":e[0]||(e[0]=l=>t.is_use=l)},null,8,["modelValue"])]),_:1},8,["label"]),t.is_use?(r(),y(_,{key:0,label:n(a)("signPeriod")},{default:i(()=>[d(F,{modelValue:t.sign_period,"onUpdate:modelValue":e[1]||(e[1]=l=>t.sign_period=l),min:1,precision:0,clearable:"",class:"input-width","controls-position":"right"},null,8,["modelValue"]),Oe]),_:1},8,["label"])):b("",!0),t.is_use?(r(),y(_,{key:1,label:n(a)("daySignAward"),prop:"day_award"},{default:i(()=>[(r(!0),p(z,null,H(B.value,(l,V)=>(r(),p("div",{key:V},[l.is_use=="1"?(r(),p("span",$e,o(l.content)+"  ",1)):b("",!0)]))),128)),t.day_award==""?(r(),p("span",{key:0,class:"cursor-pointer tutorial-btn ml-[5px]",onClick:L},o(n(a)("set")),1)):(r(),p("div",Be,[u("span",{class:"cursor-pointer tutorial-btn",onClick:L},o(n(a)("modify")),1),Re,u("span",{class:"cursor-pointer tutorial-btn",onClick:Y},o(n(a)("delete")),1)])),u("div",Fe,o(n(a)("daySignAwardTip")),1)]),_:1},8,["label"])):b("",!0),t.is_use?(r(),y(_,{key:2,label:n(a)("continueSignAward"),prop:"continue_award"},{default:i(()=>[u("div",null,[u("div",Ie,o(n(a)("continueSignAwardTipTop")),1),u("div",Ue,[G((r(),y(le,{data:g.data,size:"large"},{empty:i(()=>[u("span",null,o(g.loading?"":n(a)("emptyData")),1)]),default:i(()=>[d(C,{prop:"continue_sign",label:n(a)("continueSign"),"min-width":"120"},null,8,["label"]),d(C,{label:n(a)("continueSignAward"),"min-width":"300"},{default:i(({row:l})=>[(r(!0),p(z,null,H(l.continue_award,(V,re)=>(r(),p("div",{key:re},[V.is_use=="1"?(r(),p("span",Pe,o(V.content),1)):b("",!0)]))),128))]),_:1},8,["label"]),d(C,{label:n(a)("receiveLimit"),"min-width":"120"},{default:i(({row:l})=>[l.receive_limit==1?(r(),p("span",Le,o(n(a)("noLimit")),1)):(r(),p("span",Me,o(n(a)("everyOneLimit"))+o(l.receive_num)+o(n(a)("time")),1))]),_:1},8,["label"]),d(C,{label:n(a)("operation"),align:"right",fixed:"right",width:"130"},{default:i(l=>[d(w,{type:"primary",link:"",onClick:V=>ee(!0,l.$index)},{default:i(()=>[h(o(n(a)("modify")),1)]),_:2},1032,["onClick"]),d(w,{type:"primary",link:"",onClick:V=>ae(l.$index)},{default:i(()=>[h(o(n(a)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[q,g.loading]])]),u("div",Ne,[u("span",{class:"cursor-pointer tutorial-btn",onClick:Z},o(n(a)("add")),1)]),u("div",je,o(n(a)("continueSignAwardTipBottom")),1)])]),_:1},8,["label"])):b("",!0),t.is_use?(r(),y(_,{key:3,label:n(a)("ruleExplain"),prop:"rule_explain"},{default:i(()=>[u("div",qe,[d(ie,{modelValue:t.rule_explain,"onUpdate:modelValue":e[2]||(e[2]=l=>t.rule_explain=l),modelModifiers:{trim:!0},placeholder:n(a)("ruleExplainTip"),type:"textarea",maxlength:"500","show-word-limit":"",rows:"5",class:"textarea-width",clearable:""},null,8,["modelValue","placeholder"]),d(w,{class:"ml-[20px]",type:"primary",onClick:e[3]||(e[3]=l=>ne()),plain:""},{default:i(()=>[h(o(n(a)("useDefaultExplain")),1)]),_:1})])]),_:1},8,["label"])):b("",!0)]),_:1})]),_:1},8,["model","rules"])),[[q,E.value]]),t.is_use?(r(),y(j,{key:0,modelValue:A.value,"onUpdate:modelValue":e[7]||(e[7]=l=>A.value=l),title:n(a)("daySignTitle"),width:"1000px","destroy-on-close":!0},{footer:i(()=>[u("span",Ge,[d(w,{onClick:e[5]||(e[5]=l=>A.value=!1)},{default:i(()=>[h(o(n(a)("cancel")),1)]),_:1}),d(w,{type:"primary",onClick:e[6]||(e[6]=l=>X())},{default:i(()=>[h(o(n(a)("confirm")),1)]),_:1})])]),default:i(()=>[d(Ve,{ref_key:"benefitsRef",ref:M,modelValue:t.day_award,"onUpdate:modelValue":e[4]||(e[4]=l=>t.day_award=l)},null,8,["modelValue"])]),_:1},8,["modelValue","title"])):b("",!0),t.is_use?(r(),y(j,{key:1,modelValue:S.value,"onUpdate:modelValue":e[11]||(e[11]=l=>S.value=l),title:n(a)("continueSignTitle"),width:"1200px","destroy-on-close":!0},{footer:i(()=>[u("span",ze,[d(w,{onClick:e[9]||(e[9]=l=>S.value=!1)},{default:i(()=>[h(o(n(a)("cancel")),1)]),_:1}),d(w,{type:"primary",onClick:e[10]||(e[10]=l=>te())},{default:i(()=>[h(o(n(a)("confirm")),1)]),_:1})])]),default:i(()=>[d(Ee,{ref_key:"continueRef",ref:N,modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=l=>c.value=l)},null,8,["modelValue"])]),_:1},8,["modelValue","title"])):b("",!0),u("div",He,[u("div",Je,[d(w,{type:"primary",onClick:e[12]||(e[12]=l=>W(I.value))},{default:i(()=>[h(o(n(a)("save")),1)]),_:1})])])])}}});const ht=Ae(Ke,[["__scopeId","data-v-28f677b3"]]);export{ht as default};
