import{d as X,r as p,n as Y,q as J,N as o,h as _,I as y,w as n,a as K,e as r,i as b,t as h,u as s,y as Q,c as x,F,G as P,B as T,cy as B,a3 as Z,ay as ee,az as le,X as ae,as as oe,aE as te,W as re,Y as se,ah as ne,aj as ie,E as de,aa as ue,$ as pe}from"./index-1d549745.js";/* empty css                   *//* empty css                   *//* empty css                  *//* empty css                        *//* empty css                    *//* empty css               */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                     *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css                       *//* empty css                 */import{g as _e}from"./delivery-c3b692ea.js";import{o as me,g as ce}from"./order-b9bfc26e.js";const ye={class:"dialog-footer"},Ge=X({__name:"delivery-action",emits:["complete"],setup(ve,{expose:S,emit:R}){const m=p(!1),u=p(!1),V=p([]),D=p(!1),v=p([]);_e({}).then(l=>{V.value=l.data.data});const E=p([]),a=Y({...{order_id:0,delivery_type:"",express_company_id:"",express_number:"",order_goods_ids:[]}}),w=p(),q=J(()=>({delivery_type:[{required:!0,message:o("deliveryTypePlaceholder"),trigger:"blur"}],express_company_id:[{required:!0,validator:U,trigger:"blur"}],express_number:[{required:!0,validator:G,trigger:"blur"}]})),U=(l,e,i)=>{a.delivery_type=="express"&&e===""?i(new Error(o("companyPlaceholder"))):i()},G=(l,e,i)=>{a.delivery_type=="express"&&e===""?i(new Error(o("expressNumberPlaceholder"))):i()},I=(l,e)=>l.status!=2,d=p([]),k=()=>{if(d.value=B(E.value),a.delivery_type&&a.delivery_type=="virtual")for(const l in d.value)d.value[l].goods_type!="virtual"&&d.value.splice(l,1);else if(a.delivery_type&&a.delivery_type!="virtual")for(const l in d.value)d.value[l].goods_type=="virtual"&&d.value.splice(l,1)},L=l=>{a.order_goods_ids=B([]);for(const e in l)a.order_goods_ids.push(l[e].order_goods_id)},O=async l=>{if(!(u.value||!l)){if(a.order_goods_ids.length<=0){Z({message:o("orderGoodsPlaceholder"),type:"warning"});return}await l.validate(async e=>{e&&(u.value=!0,me(a).then(f=>{u.value=!1,m.value=!1,R("complete")}).catch(f=>{u.value=!1}))})}};return S({showDialog:m,setFormData:async(l=null)=>{if(u.value=!0,l){a.order_id=l.order_id,a.delivery_type="",E.value=l.order_goods,d.value=l.order_goods,await ce({delivery_type:l.delivery_type}).then(e=>{v.value=e.data;for(const i in e.data){a.delivery_type=i;break}k()});for(let e=0;e<l.order_goods.length;e++)if(l.order_goods[e].goods_type=="virtual"){D.value=!0;break}D.value==!0&&Object.assign(v.value,{virtual:o("virtualDelivery")})}u.value=!1}}),(l,e)=>{const i=ee,f=le,g=ae,$=oe,j=te,z=re,A=se,c=ne,H=ie,N=de,M=ue,W=pe;return _(),y(M,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=t=>m.value=t),title:s(o)("delivery"),width:"700px",class:"diy-dialog-wrap","destroy-on-close":!0},{footer:n(()=>[K("span",ye,[r(N,{onClick:e[3]||(e[3]=t=>m.value=!1)},{default:n(()=>[b(h(s(o)("cancel")),1)]),_:1}),r(N,{type:"primary",loading:u.value,onClick:e[4]||(e[4]=t=>O(w.value))},{default:n(()=>[b(h(s(o)("confirm")),1)]),_:1},8,["loading"])])]),default:n(()=>[Q((_(),x("div",null,[r(A,{model:a,"label-width":"100px",ref_key:"formRef",ref:w,rules:s(q),class:"page-form mb-[30px]"},{default:n(()=>[r(g,{label:s(o)("deliveryType"),prop:"delivery_type"},{default:n(()=>[r(f,{modelValue:a.delivery_type,"onUpdate:modelValue":e[0]||(e[0]=t=>a.delivery_type=t),onChange:k},{default:n(()=>[(_(!0),x(F,null,P(v.value,(t,C)=>(_(),y(i,{label:C,key:C},{default:n(()=>[b(h(t),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a.delivery_type=="express"?(_(),y(g,{key:0,label:s(o)("company"),prop:"express_company_id"},{default:n(()=>[r(j,{modelValue:a.express_company_id,"onUpdate:modelValue":e[1]||(e[1]=t=>a.express_company_id=t),placeholder:s(o)("companyPlaceholder"),class:"input-width"},{default:n(()=>[(_(!0),x(F,null,P(V.value,t=>(_(),y($,{key:t.index,label:t.company_name,value:t.company_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):T("",!0),a.delivery_type=="express"?(_(),y(g,{key:1,label:s(o)("expressNumber"),prop:"express_number"},{default:n(()=>[r(z,{modelValue:a.express_number,"onUpdate:modelValue":e[2]||(e[2]=t=>a.express_number=t),clearable:"",placeholder:s(o)("expressNumberPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):T("",!0)]),_:1},8,["model","rules"]),r(H,{data:d.value,size:"large",onSelectionChange:L},{default:n(()=>[r(c,{type:"selection",width:"55",selectable:I}),r(c,{prop:"goods_name",label:s(o)("goodsName"),"min-width":"200"},null,8,["label"]),r(c,{prop:"num",label:s(o)("num"),"min-width":"80"},null,8,["label"]),r(c,{prop:"status_name",label:s(o)("refundStatusName"),"min-width":"120"},null,8,["label"]),r(c,{prop:"delivery_status_name",label:s(o)("deliveryStatusName"),"min-width":"120",align:"right"},null,8,["label"])]),_:1},8,["data"])])),[[W,u.value]])]),_:1},8,["modelValue","title"])}}});export{Ge as _};
