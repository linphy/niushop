import{d as Z,O as ee,r as b,n as M,v as te,q as le,N as s,s as g,h as m,c as w,a as _,t as k,u as n,y as L,I as x,w as u,e as o,z as G,F as N,G as S,i as K,aA as ae,X as ie,W as de,as as se,aE as oe,Y as re,_ as ne,E as ce,$ as ue}from"./index-a2233f8b.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                    */import{g as _e,e as pe,a as me}from"./shop_address-0a1f2bbf.js";import{ad as V,V as fe,ae as ve}from"./sys-6f61a94e.js";import{c as ye,l as be,a as ge}from"./qqmap-1075d9c1.js";const he={class:"main-container"},Ve={class:"detail-head"},we=_("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1),ke={class:"ml-[1px]"},Le=_("span",{class:"adorn"},"|",-1),xe={class:"right"},Ee={class:"flex flex-col"},Pe={id:"container",class:"w-[800px] h-[520px] relative"},Ae={class:"fixed-footer-wrap"},Ce={class:"fixed-footer !z-[1000]"},Xe=Z({__name:"edit",setup(Re){const j=ee(),E=parseInt(j.query.id),f=b(!1),W=j.meta.title,p=M({province:[],city:[],district:[]}),P=b(),A=b(),C=b();V(0).then(a=>{p.province=a.data});let R="";te(()=>{const a=document.createElement("script");fe().then(t=>{R=t.data.key,a.type="text/javascript",a.src="https://map.qq.com/api/gljs?libraries=tools,service&v=1.exp&key="+t.data.key,document.body.appendChild(a)}),a.onload=()=>{setTimeout(()=>{X()},500)}});let y,T;const B=b(!0),X=()=>{const a=window.TMap,t=a.LatLng,l=new t(e.lat,e.lng);y=new a.Map("container",{center:l,zoom:14}),y.on("tilesloaded",()=>{B.value=!1}),T=ye(y),y.on("click",d=>{y.setCenter(d.latLng),T.updateGeometries({id:"center",position:d.latLng}),D(d.latLng.lat,d.latLng.lng)}),D(l.lat,l.lng)},c=M({province_id:0,city_id:0,district_id:0}),D=(a,t)=>{be({mapKey:R,lat:a,lng:t}).then(({message:l,result:d})=>{l=="query ok"&&(e.lat=d.location.lat,e.lng=d.location.lng,e.address=d.formatted_addresses.recommend,ve(d.ad_info.adcode).then(({data:r})=>{c.province_id=r.province?r.province.id:0,c.city_id=r.city?r.city.id:0,c.district_id=r.district?r.district.id:0}))}).catch(l=>{console.log(l)})},F={id:0,contact_name:"",mobile:"",province_id:0,city_id:0,district_id:0,address:"",full_address:"",lat:39.908626,lng:116.39719,is_delivery_address:0,is_refund_address:0,is_default_delivery:0,is_default_refund:0},e=M({...F});E&&(async(a=0)=>{f.value=!0,Object.assign(e,F);const t=await(await _e(a)).data;Object.keys(e).forEach(l=>{t[l]!=null&&(e[l]=t[l])}),f.value=!1})(E);const I=b(),Y=le(()=>({address_type:[{validator:(a,t,l)=>{!e.is_delivery_address&&!e.is_refund_address&&l(new Error(s("addressTypeRequire"))),l()}}],contact_name:[{required:!0,message:s("contactNamePlaceholder"),trigger:"blur"}],mobile:[{required:!0,message:s("mobilePlaceholder"),trigger:"blur"}],address_area:[{validator:(a,t,l)=>{e.province_id||l(new Error(s("provincePlaceholder"))),e.city_id||l(new Error(s("cityPlaceholder"))),p.district.length&&!e.district_id&&l(new Error(s("districtPlaceholder"))),l()}}],address:[{required:!0,message:s("addressPlaceholder"),trigger:"blur"}]}));g(()=>e.province_id,a=>{a?V(e.province_id).then(t=>{p.city=t.data;const l=e.city_id;if(l){let d=!1;for(let r=0;r<t.data.length;r++)if(l==t.data[r].id){d=!0;break}if(d){e.city_id=l;return}}e.city_id=0,q()}):e.city_id=0}),g(()=>e.city_id,a=>{a?V(e.city_id).then(t=>{p.district=t.data;const l=e.district_id;if(l){let d=!1;for(let r=0;r<t.data.length;r++)if(l==t.data[r].id){d=!0;break}if(d){e.district_id=l;return}}q(),e.district_id=0}):e.district_id=0}),g(()=>e.district_id,a=>{a&&q()});const q=()=>{setTimeout(()=>{const a=[e.province_id?P.value.selectedLabel:"",e.city_id?A.value.selectedLabel:"",e.district_id?C.value.selectedLabel:""];ge({mapKey:R,address:a.join("")}).then(({message:t,result:l})=>{if(t=="query ok"){const d=new window.TMap.LatLng(l.location.lat,l.location.lng);y.setCenter(d),T.updateGeometries({id:"center",position:d})}})},500)};g(()=>c.province_id,a=>{a&&V(c.province_id).then(t=>{p.city=t.data,e.province_id=c.province_id,e.city_id=c.city_id})}),g(()=>c.city_id,a=>{a&&V(c.city_id).then(t=>{p.district=t.data,e.city_id=c.city_id,e.district_id=c.district_id})}),g(()=>c.district_id,a=>{a&&(e.district_id=c.district_id)});const H=async a=>{f.value||!a||await a.validate(async t=>{if(t){f.value=!0;const l=e,d=[l.province_id?P.value.selectedLabel:"",l.city_id?A.value.selectedLabel:"",l.district_id?C.value.selectedLabel:"",l.address];l.full_address=d.join(""),(E?pe:me)(l).then(v=>{f.value=!1,history.back()}).catch(()=>{f.value=!1})}})},z=()=>{history.back()};return(a,t)=>{const l=ae,d=ie,r=de,v=se,U=oe,J=re,Q=ne,O=ce,$=ue;return m(),w("div",he,[_("div",Ve,[_("div",{class:"left",onClick:t[0]||(t[0]=i=>z())},[we,_("span",ke,k(n(s)("returnToPreviousPage")),1)]),Le,_("span",xe,k(n(W)),1)]),L((m(),x(Q,{class:"box-card !border-none",shadow:"never"},{default:u(()=>[o(J,{model:e,"label-width":"90px",ref_key:"formRef",ref:I,rules:n(Y),class:"page-form"},{default:u(()=>[o(d,{label:n(s)("addressType"),prop:"address_type"},{default:u(()=>[_("div",Ee,[_("div",null,[o(l,{modelValue:e.is_delivery_address,"onUpdate:modelValue":t[1]||(t[1]=i=>e.is_delivery_address=i),label:n(s)("deliveryAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),L(o(l,{modelValue:e.is_default_delivery,"onUpdate:modelValue":t[2]||(t[2]=i=>e.is_default_delivery=i),label:n(s)("defaultDeliveryAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),[[G,e.is_delivery_address]])]),_("div",null,[o(l,{modelValue:e.is_refund_address,"onUpdate:modelValue":t[3]||(t[3]=i=>e.is_refund_address=i),label:n(s)("refundAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),L(o(l,{modelValue:e.is_default_refund,"onUpdate:modelValue":t[4]||(t[4]=i=>e.is_default_refund=i),label:n(s)("defaultRefundAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),[[G,e.is_refund_address]])])])]),_:1},8,["label"]),o(d,{label:n(s)("contactName"),prop:"contact_name"},{default:u(()=>[o(r,{modelValue:e.contact_name,"onUpdate:modelValue":t[5]||(t[5]=i=>e.contact_name=i),clearable:"",placeholder:n(s)("contactNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(d,{label:n(s)("mobile"),prop:"mobile"},{default:u(()=>[o(r,{modelValue:e.mobile,"onUpdate:modelValue":t[6]||(t[6]=i=>e.mobile=i),clearable:"",placeholder:n(s)("mobilePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(d,{label:n(s)("fullAddress"),prop:"address_area"},{default:u(()=>[o(U,{modelValue:e.province_id,"onUpdate:modelValue":t[7]||(t[7]=i=>e.province_id=i),"value-key":"id",clearable:"",class:"w-[200px]",ref_key:"provinceRef",ref:P},{default:u(()=>[o(v,{label:n(s)("provincePlaceholder"),value:0},null,8,["label"]),(m(!0),w(N,null,S(p.province,(i,h)=>(m(),x(v,{key:h,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(U,{modelValue:e.city_id,"onUpdate:modelValue":t[8]||(t[8]=i=>e.city_id=i),"value-key":"id",clearable:"",class:"w-[200px] ml-3",ref_key:"cityRef",ref:A},{default:u(()=>[o(v,{label:n(s)("cityPlaceholder"),value:0},null,8,["label"]),(m(!0),w(N,null,S(p.city,(i,h)=>(m(),x(v,{key:h,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(U,{modelValue:e.district_id,"onUpdate:modelValue":t[9]||(t[9]=i=>e.district_id=i),"value-key":"id",clearable:"",class:"w-[200px] ml-3",ref_key:"districtRef",ref:C},{default:u(()=>[o(v,{label:n(s)("districtPlaceholder"),value:0},null,8,["label"]),(m(!0),w(N,null,S(p.district,(i,h)=>(m(),x(v,{key:h,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(d,{prop:"address"},{default:u(()=>[o(r,{modelValue:e.address,"onUpdate:modelValue":t[10]||(t[10]=i=>e.address=i),clearable:"",placeholder:n(s)("addressPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1}),o(d,null,{default:u(()=>[L(_("div",Pe,null,512),[[$,B.value]])]),_:1})]),_:1},8,["model","rules"])]),_:1})),[[$,f.value]]),_("div",Ae,[_("div",Ce,[o(O,{type:"primary",onClick:t[11]||(t[11]=i=>H(I.value))},{default:u(()=>[K(k(n(s)("save")),1)]),_:1}),o(O,{onClick:t[12]||(t[12]=i=>z())},{default:u(()=>[K(k(n(s)("cancel")),1)]),_:1})])])])}}});export{Xe as default};
