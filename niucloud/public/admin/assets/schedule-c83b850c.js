import{d as se,v as re,l as S,r as g,f as de,M as me,k as n,h as u,c as V,e as l,w as o,a as p,t as d,u as i,i as c,F as C,O as E,m as _,J as j,B as D,S as q,E as ue,az as pe,$ as ce,ad as _e,G as fe,H as ye,K as ve,a0 as ge,aO as be,aP as ke,aQ as we,a1 as he,a2 as Ve,D as xe,ab as Ce,ac as Ee,V as De,L as Te}from"./index-6aea3257.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                       *//* empty css                 *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                         *//* empty css                        *//* empty css                *//* empty css                     *//* empty css                 */import{a7 as Fe,a8 as Ue,a9 as Be,Q as Le,aa as Pe,ab as $e,ac as Re,ad as Oe}from"./sys-83b0ac7b.js";import{_ as ze}from"./cron-info.vue_vue_type_script_setup_true_lang-eff0ac6e.js";const Me={class:"main-container"},Ne={class:"flex justify-between items-center mb-[20px]"},Se={class:"text-page-title"},je={class:"flex items-center"},qe={class:"mt-2"},Ae={class:"flex justify-between"},Ie={class:"mt-[20px]"},Ge={class:"flex items-center"},Qe={class:"el-dropdown-link text-primary"},He={class:"mt-[16px] flex justify-end"},Je={class:"flex"},Ke={class:"input-width flex items-center text-sm"},We={class:"dialog-footer"},Ct=se({__name:"schedule",setup(Xe){const A=re().meta.title,r=S({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{type:"",status:"all"}}),T=g([]),U=g([]),B=g([]),L=g(),I=s=>{s&&(s.resetFields(),v())};(async()=>{T.value=await(await Fe()).data,U.value=await(await Ue()).data,B.value=await(await Be()).data})();const v=(s=1)=>{r.loading=!0,r.page=s,Le({page:r.page,limit:r.limit,...r.searchParam}).then(a=>{r.loading=!1,r.data=a.data.data,r.total=a.data.total}).catch(()=>{r.loading=!1})};v();const G=de(),k=g(!1),e=S({...{id:0,key:"",status:2,time:{type:"min",week:"",day:"",hour:"",min:""}}}),P=g(),Q=()=>{e.id=0,e.key="",e.status=2,e.time.type="min",e.time.week="",e.time.day="",e.time.hour="",e.time.min="",k.value=!0},H=me(()=>({key:[{required:!0,message:n("titlePlaceholder"),trigger:"blur"}],timeDate:[{required:!0,validator:J,trigger:"blur"}]})),J=(s,a,m)=>e.time.type=="min"&&e.time.min!=""||e.time.type=="week"&&e.time.week!=""&&e.time.hour!=""&&e.time.min!=""||e.time.type=="month"&&e.time.day!=""&&e.time.hour!=""&&e.time.min!=""||e.time.type=="day"&&e.time.day!=""&&e.time.hour!=""&&e.time.min!=""||e.time.type=="hour"&&e.time.hour!=""&&e.time.min!=""?m():m(new Error(n("cronTimeTips"))),x=g(!1),K=async s=>{x.value||!s||await s.validate(async a=>{if(a){x.value=!0;const m=e;(e.id>0?Pe:$e)(m).then(f=>{x.value=!1,k.value=!1,v()}).catch(()=>{x.value=!1})}})},W=s=>{e.id=s.id,e.key=s.key,e.status=s.status,e.time=s.time,k.value=!0},X=s=>{q.confirm(n("cronDeleteTips"),n("warning"),{confirmButtonText:n("confirm"),cancelButtonText:n("cancel"),type:"warning"}).then(()=>{Re(s).then(()=>{v()}).catch(()=>{})})},Y=s=>{q.confirm(n(`确认要立即执行一次"${s.name}"任务吗？`),n("warning"),{confirmButtonText:n("confirm"),cancelButtonText:n("cancel"),type:"warning"}).then(()=>{Oe({id:s.id}).then(a=>{}).catch(()=>{})})},Z=g(null),ee=s=>{G.push({path:"/tools/schedule_log",query:{id:s}})};return(s,a)=>{const m=ue,$=pe,f=ce,w=_e,b=fe,R=ye,O=ve,h=ge,z=be,te=ke,ae=we,le=he,oe=Ve,F=xe,M=Ce,ne=Ee,ie=De,N=Te;return u(),V("div",Me,[l(O,{class:"box-card !border-none",shadow:"never"},{default:o(()=>[p("div",Ne,[p("span",Se,d(i(A)),1),l(m,{type:"primary",onClick:Q},{default:o(()=>[c(d(i(n)("addCron")),1)]),_:1})]),l($,{type:"info"},{default:o(()=>[p("div",je,[p("div",null,[p("p",null,d(i(n)("cronTipsOne")),1),p("p",qe,d(i(n)("cronTipsTwo")),1)])])]),_:1}),l(O,{class:"box-card !border-none mb-[10px] table-search-wrap",shadow:"never"},{default:o(()=>[p("div",Ae,[l(R,{inline:!0,model:r.searchParam,ref_key:"searchFormRef",ref:L},{default:o(()=>[l(b,{label:i(n)("title"),prop:"key"},{default:o(()=>[l(w,{modelValue:r.searchParam.key,"onUpdate:modelValue":a[0]||(a[0]=t=>r.searchParam.key=t),placeholder:"全部",filterable:"",remote:"",clearable:"","remote-method":s.getAddonDevelopFn},{default:o(()=>[l(f,{label:"全部",value:"all"}),(u(!0),V(C,null,E(T.value,t=>(u(),_(f,{key:t.key,label:t.name,value:t.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue","remote-method"])]),_:1},8,["label"]),l(b,{label:i(n)("status"),prop:"status"},{default:o(()=>[l(w,{modelValue:r.searchParam.status,"onUpdate:modelValue":a[1]||(a[1]=t=>r.searchParam.status=t),placeholder:"全部",filterable:"",remote:"",clearable:"","remote-method":s.getAddonDevelopFn},{default:o(()=>[l(f,{label:"全部",value:"all"}),l(f,{label:"启用",value:"1"}),l(f,{label:"关闭",value:"0"})]),_:1},8,["modelValue","remote-method"])]),_:1},8,["label"]),l(b,null,{default:o(()=>[l(m,{type:"primary",onClick:a[2]||(a[2]=t=>v())},{default:o(()=>[c(d(i(n)("search")),1)]),_:1}),l(m,{onClick:a[3]||(a[3]=t=>I(L.value))},{default:o(()=>[c(d(i(n)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1}),p("div",Ie,[j((u(),_(le,{data:r.data,size:"large"},{empty:o(()=>[p("span",null,d(r.loading?"":i(n)("emptyData")),1)]),default:o(()=>[l(h,{prop:"key",label:i(n)("key"),"min-width":"150"},null,8,["label"]),l(h,{prop:"name",label:i(n)("title"),"min-width":"150"},null,8,["label"]),l(h,{label:i(n)("crondType"),"min-width":"150"},{default:o(({row:t})=>[c(d(t.crontab_content),1)]),_:1},8,["label"]),l(h,{prop:"status_name",label:i(n)("openStatus"),"min-width":"100"},null,8,["label"]),l(h,{label:i(n)("operation"),align:"right",fixed:"right",width:"180"},{default:o(({row:t})=>[p("div",Ge,[l(m,{type:"primary",link:"",onClick:y=>W(t)},{default:o(()=>[c(d(i(n)("edit")),1)]),_:2},1032,["onClick"]),l(m,{type:"primary",link:"",onClick:y=>X(t.id)},{default:o(()=>[c(d(i(n)("delete")),1)]),_:2},1032,["onClick"]),l(ae,{class:"ml-[12px]"},{dropdown:o(()=>[l(te,null,{default:o(()=>[l(z,{onClick:y=>Y(t)},{default:o(()=>[c(d(i(n)("doOne")),1)]),_:2},1032,["onClick"]),l(z,{onClick:y=>ee(t.id)},{default:o(()=>[c(d(i(n)("cronLog")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[p("span",Qe,d(i(n)("more")),1)]),_:2},1024)])]),_:1},8,["label"])]),_:1},8,["data"])),[[N,r.loading]]),p("div",He,[l(oe,{"current-page":r.page,"onUpdate:current-page":a[4]||(a[4]=t=>r.page=t),"page-size":r.limit,"onUpdate:page-size":a[5]||(a[5]=t=>r.limit=t),layout:"total, sizes, prev, pager, next, jumper",total:r.total,onSizeChange:a[6]||(a[6]=t=>v()),onCurrentChange:v},null,8,["current-page","page-size","total"])])])]),_:1}),l(ze,{ref_key:"cronDialog",ref:Z,onComplete:v},null,512),l(ie,{modelValue:k.value,"onUpdate:modelValue":a[15]||(a[15]=t=>k.value=t),title:i(n)("editCron"),width:"750px","destroy-on-close":!0},{footer:o(()=>[p("span",We,[l(m,{type:"primary",onClick:a[14]||(a[14]=t=>K(P.value))},{default:o(()=>[c(d(i(n)("confirm")),1)]),_:1})])]),default:o(()=>[j((u(),_(R,{model:e,"label-width":"110px",ref_key:"formRef",ref:P,rules:i(H),class:"page-form"},{default:o(()=>[l(b,{label:i(n)("cronTemplate"),class:"items-center",prop:"key"},{default:o(()=>[l(w,{modelValue:e.key,"onUpdate:modelValue":a[7]||(a[7]=t=>e.key=t)},{default:o(()=>[(u(!0),V(C,null,E(T.value,t=>(u(),_(f,{key:t.key,label:t.name,value:t.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(b,{label:i(n)("cronTime"),prop:"timeDate"},{default:o(()=>[l(w,{modelValue:e.time.type,"onUpdate:modelValue":a[8]||(a[8]=t=>e.time.type=t),class:"w-[150px]"},{default:o(()=>[(u(!0),V(C,null,E(U.value,(t,y)=>(u(),_(f,{key:y,label:t,value:y},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),p("div",Je,[e.time.type=="week"?(u(),_(w,{key:0,modelValue:e.time.week,"onUpdate:modelValue":a[9]||(a[9]=t=>e.time.week=t),class:"ml-2 w-[120px]"},{default:o(()=>[(u(!0),V(C,null,E(B.value,(t,y)=>(u(),_(f,{key:y,label:t,value:y},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):D("",!0),["month","day"].indexOf(e.time.type)!=-1?(u(),_(F,{key:1,modelValue:e.time.day,"onUpdate:modelValue":a[10]||(a[10]=t=>e.time.day=t),modelModifiers:{trim:!0},class:"ml-2 w-[120px]"},{append:o(()=>[c(d(i(n)("day")),1)]),_:1},8,["modelValue"])):D("",!0),["month","day","hour","week"].indexOf(e.time.type)!=-1?(u(),_(F,{key:2,modelValue:e.time.hour,"onUpdate:modelValue":a[11]||(a[11]=t=>e.time.hour=t),modelModifiers:{trim:!0},class:"ml-2 w-[120px]"},{append:o(()=>[c(d(i(n)("hour")),1)]),_:1},8,["modelValue"])):D("",!0),["month","day","hour","week","min"].indexOf(e.time.type)!=-1?(u(),_(F,{key:3,modelValue:e.time.min,"onUpdate:modelValue":a[12]||(a[12]=t=>e.time.min=t),modelModifiers:{trim:!0},class:"ml-2 w-[120px]"},{append:o(()=>[c(d(i(n)("min")),1)]),_:1},8,["modelValue"])):D("",!0)])]),_:1},8,["label"]),l(b,{label:i(n)("isopen")},{default:o(()=>[p("div",Ke,[l(ne,{modelValue:e.status,"onUpdate:modelValue":a[13]||(a[13]=t=>e.status=t)},{default:o(()=>[l(M,{label:1},{default:o(()=>[c(d(i(n)("yes")),1)]),_:1}),l(M,{label:2},{default:o(()=>[c(d(i(n)("no")),1)]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[N,s.loading]])]),_:1},8,["modelValue","title"])])}}});export{Ct as default};
