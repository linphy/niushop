import{d as de,v as ue,r as f,l as D,k as t,h as r,c as m,J as G,m as b,w as l,e as d,a as u,t as o,u as n,B as h,F as z,O as H,i as x,Q as g,aw as ce,G as pe,D as _e,a0 as me,E as fe,a1 as ge,K as ve,H as we,V as ye,L as be,p as he,g as xe}from"./index-a59af0dd.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css               *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                  */import{h as ke,i as J,s as Se}from"./member-296fb371.js";import Ce from"./sign-day-44e021d0.js";import Ve from"./sign-continue-db8e9c1c.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                 */import"./test-71dfb9c1.js";const K=T=>(he("data-v-c4db954c"),T=T(),xe(),T),Ae={class:"main-container"},De={class:"text-page-title"},Te=K(()=>u("span",{class:"ml-[10px]"},"天",-1)),$e={key:0},Oe={key:1,class:"flex ml-[5px]"},Be=K(()=>u("span",{class:"ml-[5px] mr-[5px]"},"|",-1)),Pe={class:"form-tip"},Re={class:"form-tip"},Fe={class:"mt-[10px]"},Ue={key:0},Ie={key:0},Le={key:1},Me={class:"flex mt-[10px]"},Ne={class:"form-tip"},je={class:"flex"},qe={class:"dialog-footer"},Ge={class:"dialog-footer"},ze={class:"fixed-footer-wrap"},He={class:"fixed-footer"},Je=de({__name:"sign_config",setup(T){ue().meta.title,f("signSet");const E=f(!0),A=f(!1),S=f(!1),F=f(),c=f({});let $=!1,O=0;const Q={required:/[\S]+/,number:/^\d{0,10}$/,digit:/^\d{0,10}(.?\d{0,2})$/,special:/^\d{0,10}(.?\d{0,3})$/},Z=D({day_award:[{required:!0,message:t("daySignAwardPlaceholder"),trigger:"change"}],sign_period:[{required:!0,trigger:"blur",validator:(s,e,_)=>{e===null||e===""?_(t("signPeriodTip")):isNaN(e)||!Q.number.test(e)?_(t("signPeriodLimitTips")):e<=0?_(t("signPeriodMustZeroTips")):_()}}]}),v=D({gifts:[]}),R=f([]),a=D({is_use:0,sign_period:30,day_award:"",continue_award:[],rule_explain:""}),k=D({receive_num:"",continue_sign:"",receive_limit:"",continue_award:[]}),w=D({loading:!1,data:[]});(async()=>{const s=await(await ke()).data;Object.keys(a).forEach(e=>{s[e]!=null&&(a[e]=s[e])}),a.day_award&&(v.gifts=a.day_award,U()),a.continue_award&&a.continue_award.forEach((e,_)=>{w.data.push(g(e)),v.gifts=[];const p=g(e);delete p.continue_sign,delete p.continue_tag,delete p.receive_limit,delete p.receive_num,v.gifts=p,I(v,e,_)}),E.value=!1})();const B=f([]),U=async()=>{const s=await(await J(v)).data;B.value=[],Object.values(s).forEach(e=>{B.value.push(e)})},I=async(s,e,_=0,p=0)=>{const P=await(await J(s)).data;R.value=[],Object.values(P).forEach(C=>{R.value.push(C)}),k.receive_num=e.receive_num,k.continue_sign=e.continue_sign,k.receive_limit=e.receive_limit,k.continue_award=R.value,$?w.data.splice(O,1,g(k)):p==0?w.data.splice(_,1,g(k)):w.data.push(g(k)),$=!1,O=0},W=async s=>{E.value||!s||await s.validate(e=>{if(e){const _=g(a);Se(_).then(()=>{E.value=!1}).catch(()=>{E.value=!1})}})},L=()=>{A.value=!0},M=f(null),X=async()=>{var s;await((s=M.value)==null?void 0:s.verify())&&(A.value=!1,!a.day_award.hasOwnProperty("balance")&&!a.day_award.hasOwnProperty("point")&&a.day_award.shop_coupon.is_use==0&&(a.day_award=""),v.gifts=a.day_award,U())},Y=()=>{a.day_award="",B.value=[]},ee=()=>{c.value="",S.value=!0},te=(s,e)=>{$=s,O=e,c.value=a.continue_award[e],S.value=!0},N=f(null),ae=async()=>{var s;if(await((s=N.value)==null?void 0:s.verify())&&(S.value=!1,!c.value.hasOwnProperty("balance")&&!c.value.hasOwnProperty("point")&&c.value.shop_coupon.is_use==0&&(c.value=""),Object.keys(c.value).length>0)){const e=g(c.value);delete e.continue_sign,delete e.continue_tag,delete e.receive_limit,delete e.receive_num,v.gifts=e,a.continue_award.length>0&&a.continue_award.length-1,I(v,c.value,0,1),$?a.continue_award.splice(O,1,g(c.value)):a.continue_award.push(g(c.value))}},ne=s=>{w.data.splice(s,1),a.continue_award.splice(s,1)},ie=()=>{a.rule_explain=t("ruleExplainDefault")};return(s,e)=>{const _=ce,p=pe,P=_e,C=me,y=fe,le=ge,oe=ve,se=we,j=ye,q=be;return r(),m("div",Ae,[G((r(),b(se,{class:"page-form",model:a,"label-width":"150px",ref_key:"ruleFormRef",ref:F,rules:Z},{default:l(()=>[d(oe,{class:"box-card !border-none",shadow:"never"},{default:l(()=>[u("h3",De,o(n(t)("signRule")),1),d(p,{label:n(t)("isUse")},{default:l(()=>[d(_,{modelValue:a.is_use,"onUpdate:modelValue":e[0]||(e[0]=i=>a.is_use=i)},null,8,["modelValue"])]),_:1},8,["label"]),a.is_use?(r(),b(p,{key:0,label:n(t)("signPeriod"),prop:"sign_period"},{default:l(()=>[d(P,{modelValue:a.sign_period,"onUpdate:modelValue":e[1]||(e[1]=i=>a.sign_period=i),placeholder:"0",maxlength:"8",clearable:"",class:"input-width"},null,8,["modelValue"]),Te]),_:1},8,["label"])):h("",!0),a.is_use?(r(),b(p,{key:1,label:n(t)("daySignAward"),prop:"day_award"},{default:l(()=>[(r(!0),m(z,null,H(B.value,(i,V)=>(r(),m("div",{key:V},[i.is_use=="1"?(r(),m("span",$e,o(i.content)+"  ",1)):h("",!0)]))),128)),a.day_award==""?(r(),m("span",{key:0,class:"cursor-pointer tutorial-btn ml-[5px]",onClick:L},o(n(t)("set")),1)):(r(),m("div",Oe,[u("span",{class:"cursor-pointer tutorial-btn",onClick:L},o(n(t)("modify")),1),Be,u("span",{class:"cursor-pointer tutorial-btn",onClick:Y},o(n(t)("delete")),1)])),u("div",Pe,o(n(t)("daySignAwardTip")),1)]),_:1},8,["label"])):h("",!0),a.is_use?(r(),b(p,{key:2,label:n(t)("continueSignAward"),prop:"continue_award"},{default:l(()=>[u("div",null,[u("div",Re,o(n(t)("continueSignAwardTipTop")),1),u("div",Fe,[G((r(),b(le,{data:w.data,size:"large"},{empty:l(()=>[u("span",null,o(w.loading?"":n(t)("emptyData")),1)]),default:l(()=>[d(C,{prop:"continue_sign",label:n(t)("continueSign"),"min-width":"120"},null,8,["label"]),d(C,{label:n(t)("continueSignAward"),"min-width":"300"},{default:l(({row:i})=>[(r(!0),m(z,null,H(i.continue_award,(V,re)=>(r(),m("div",{key:re},[V.is_use=="1"?(r(),m("span",Ue,o(V.content),1)):h("",!0)]))),128))]),_:1},8,["label"]),d(C,{label:n(t)("receiveLimit"),"min-width":"120"},{default:l(({row:i})=>[i.receive_limit==1?(r(),m("span",Ie,o(n(t)("noLimit")),1)):(r(),m("span",Le,o(n(t)("everyOneLimit"))+o(i.receive_num)+o(n(t)("time")),1))]),_:1},8,["label"]),d(C,{label:n(t)("operation"),align:"right",fixed:"right",width:"130"},{default:l(i=>[d(y,{type:"primary",link:"",onClick:V=>te(!0,i.$index)},{default:l(()=>[x(o(n(t)("modify")),1)]),_:2},1032,["onClick"]),d(y,{type:"primary",link:"",onClick:V=>ne(i.$index)},{default:l(()=>[x(o(n(t)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[q,w.loading]])]),u("div",Me,[u("span",{class:"cursor-pointer tutorial-btn",onClick:ee},o(n(t)("add")),1)]),u("div",Ne,o(n(t)("continueSignAwardTipBottom")),1)])]),_:1},8,["label"])):h("",!0),a.is_use?(r(),b(p,{key:3,label:n(t)("ruleExplain"),prop:"rule_explain"},{default:l(()=>[u("div",je,[d(P,{modelValue:a.rule_explain,"onUpdate:modelValue":e[2]||(e[2]=i=>a.rule_explain=i),modelModifiers:{trim:!0},placeholder:n(t)("ruleExplainTip"),type:"textarea",maxlength:"500","show-word-limit":"",rows:"5",class:"textarea-width",clearable:""},null,8,["modelValue","placeholder"]),d(y,{class:"ml-[20px]",type:"primary",onClick:e[3]||(e[3]=i=>ie()),plain:""},{default:l(()=>[x(o(n(t)("useDefaultExplain")),1)]),_:1})])]),_:1},8,["label"])):h("",!0)]),_:1})]),_:1},8,["model","rules"])),[[q,E.value]]),a.is_use?(r(),b(j,{key:0,modelValue:A.value,"onUpdate:modelValue":e[7]||(e[7]=i=>A.value=i),title:n(t)("daySignTitle"),width:"1000px","destroy-on-close":!0},{footer:l(()=>[u("span",qe,[d(y,{onClick:e[5]||(e[5]=i=>A.value=!1)},{default:l(()=>[x(o(n(t)("cancel")),1)]),_:1}),d(y,{type:"primary",onClick:e[6]||(e[6]=i=>X())},{default:l(()=>[x(o(n(t)("confirm")),1)]),_:1})])]),default:l(()=>[d(Ce,{ref_key:"benefitsRef",ref:M,modelValue:a.day_award,"onUpdate:modelValue":e[4]||(e[4]=i=>a.day_award=i)},null,8,["modelValue"])]),_:1},8,["modelValue","title"])):h("",!0),a.is_use?(r(),b(j,{key:1,modelValue:S.value,"onUpdate:modelValue":e[11]||(e[11]=i=>S.value=i),title:n(t)("continueSignTitle"),width:"1200px","destroy-on-close":!0},{footer:l(()=>[u("span",Ge,[d(y,{onClick:e[9]||(e[9]=i=>S.value=!1)},{default:l(()=>[x(o(n(t)("cancel")),1)]),_:1}),d(y,{type:"primary",onClick:e[10]||(e[10]=i=>ae())},{default:l(()=>[x(o(n(t)("confirm")),1)]),_:1})])]),default:l(()=>[d(Ve,{ref_key:"continueRef",ref:N,modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=i=>c.value=i)},null,8,["modelValue"])]),_:1},8,["modelValue","title"])):h("",!0),u("div",ze,[u("div",He,[d(y,{type:"primary",onClick:e[12]||(e[12]=i=>W(F.value))},{default:l(()=>[x(o(n(t)("save")),1)]),_:1})])])])}}});const yt=Ee(Je,[["__scopeId","data-v-c4db954c"]]);export{yt as default};
