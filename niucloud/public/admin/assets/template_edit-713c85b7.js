import{d as ue,r as k,O as ce,f as fe,n as me,q as D,N as a,h as x,c as O,a as v,t as m,u as i,e as l,w as n,y as j,I as K,i as g,B as ve,z as X,F as he,W as ge,X as ye,ay as be,az as Ve,ah as ke,E as Se,aj as we,aL as Ee,Y as xe,_ as Ce,aB as Ue,ap as De,aa as Ne,$ as Te,p as Ae,g as ze}from"./index-a2233f8b.js";/* empty css                   *//* empty css                   *//* empty css                     *//* empty css                *//* empty css                    *//* empty css                *//* empty css                *//* empty css                  *//* empty css                        *//* empty css               */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                  *//* empty css                       *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                 */import{x as Pe,y as Ie,z as Re}from"./delivery-af7aa755.js";import{af as Be}from"./sys-6f61a94e.js";import{T as $}from"./test-1df70a90.js";import{_ as Fe}from"./_plugin-vue_export-helper-c27b6911.js";const Y=C=>(Ae("data-v-1978dc8f"),C=C(),ze(),C),Oe={class:"main-container"},je={class:"detail-head"},$e=Y(()=>v("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1)),qe={class:"ml-[1px]"},Le=Y(()=>v("span",{class:"adorn"},"|",-1)),We={class:"right"},Ze={class:"area-input"},Ge=["onClick"],Ke={key:1},Xe={class:"mt-[10px]"},Ye={class:"area-input"},He={class:"form-tip"},Je={class:"mt-[10px]"},Me={class:"area-input"},Qe={class:"mt-[10px]"},ea={class:"fixed-footer-wrap"},aa={class:"fixed-footer"},la={class:"dialog-footer"},ta=ue({__name:"template_edit",setup(C){const E=k(!1),N=ce(),q=fe(),b=k(!1),H={template_id:"",template_name:"",fee_type:"num",area:[],no_delivery:0,is_free_shipping:0,fee_data:[],free_shipping_data:[],no_delivery_data:[]},J=N.meta.title,u=me({...H}),L=k(),T=k([]);N.query.id&&(b.value=!0,Pe(N.query.id).then(({data:o})=>{o&&(Object.keys(u).forEach(t=>{o[t]!=null&&(u[t]=o[t])}),f.value=o.fee_data,y.value=o.no_delivery_data,h.value=o.free_shipping_data),b.value=!1}).catch(()=>{b.value=!1})),Be(2).then(o=>{T.value=o.data}).catch();const M=D(()=>({template_name:[{required:!0,message:a("templateNamePlaceholder"),trigger:"blur"}],fee_data:[{validator:Q}],free_shipping_data:[{validator:ee}],no_delivery_data:[{validator:ae}]})),Q=(o,t,r)=>{for(let s=0;s<f.value.length;s++){const d=f.value[s];if(!d.area_ids.length){r(new Error(a("areaPlaceholder")));break}if($.empty(d.snum)||d.snum<0){r(new Error(U.value.first+a("notUnderZero")));break}if($.empty(d.xnum)||d.snum<0){r(new Error(U.value.continue+a("notUnderZero")));break}}r()},ee=(o,t,r)=>{if(u.is_free_shipping){for(let s=0;s<h.value.length;s++){const d=h.value[s];if(!d.area_ids.length){r(new Error(a("freeShippingPlaceholder")));break}if($.empty(d.free_shipping_num)||d.free_shipping_num<0){r(new Error(W.value+a("notUnderZero")));break}}r()}else r()},ae=(o,t,r)=>{if(u.no_delivery){for(let s=0;s<y.value.length;s++)if(!y.value[s].area_ids.length){r(new Error(a("noDeliveryPlaceholder")));break}r()}else r()},U=D(()=>({num:{first:a("firstNum"),continue:a("continueNum")},weight:{first:a("firstWeight"),continue:a("continueWeight")},volume:{first:a("firstVolume"),continue:a("continueVolume")}})[u.fee_type]),W=D(()=>({num:a("freeShippingNum"),weight:a("freeShippingWeight"),volume:a("freeShippingVolume")})[u.fee_type]),f=k([{area_ids:[0],fee_area_names:"全国",snum:1,sprice:0,xnum:1,xprice:0}]),h=k([]),y=k([]),A=o=>{switch(o){case"fee":f.value.push({area_ids:[],fee_area_names:"",snum:1,sprice:0,xnum:1,xprice:0});break;case"free_shipping":h.value.push({area_ids:[],free_shipping_area_names:"",free_shipping_num:0,free_shipping_price:0});break;case"no_delivery":y.value.push({area_ids:[],no_delivery_area_names:""});break}},z=(o,t)=>{switch(o){case"fee":f.value.splice(t,1);break;case"free_shipping":h.value.splice(t,1);break;case"no_delivery":y.value.splice(t,1);break}};let P=[];const I=k([]);let S={type:"",index:0};const R=(o,t)=>{S={type:o,index:t};let r=[];switch(o){case"fee":r=f.value;break;case"free_shipping":r=h.value;break;case"no_delivery":r=y.value;break}P=r[t].area_ids,I.value=[],r.forEach((s,d)=>{t!=d&&I.value.push(...s.area_ids)}),E.value=!0},le=D(()=>(T.value.forEach(o=>{o.child.forEach(t=>{t.disabled=I.value.includes(t.id)})}),T.value)),B=k(),te=()=>{const o=B.value.getCheckedNodes(!1,!1),t=[],r=[];switch(o.forEach(s=>{s.level==2&&(t.push(s.id),r.push(s.name))}),S.type){case"fee":f.value[S.index].area_ids=t,f.value[S.index].fee_area_names=r.toString();break;case"free_shipping":h.value[S.index].area_ids=t,h.value[S.index].free_shipping_area_names=r.toString();break;case"no_delivery":y.value[S.index].area_ids=t,y.value[S.index].no_delivery_area_names=r.toString();break}E.value=!1},ie=()=>{B.value.setCheckedKeys(P,!1)},ne=async o=>{if(b.value||!o)return;const t=u.template_id?Ie:Re;await o.validate(async r=>{if(r){b.value=!0;const s={template_id:u.template_id,template_name:u.template_name,fee_type:u.fee_type,no_delivery:y.value.length?1:0,is_free_shipping:h.value.length?1:0},d={};f.value.forEach(_=>{_.area_ids.forEach(p=>{d["city_"+p]={city_id:p,fee_area_ids:_.area_ids.toString(),fee_area_names:_.fee_area_names,snum:_.snum,sprice:_.sprice,xnum:_.xnum,xprice:_.xprice}})}),h.value.forEach(_=>{_.area_ids.forEach(p=>{d["city_"+p]?Object.assign(d["city_"+p],{free_shipping_area_ids:_.area_ids.toString(),free_shipping_area_names:_.free_shipping_area_names,free_shipping_num:_.free_shipping_num,free_shipping_price:_.free_shipping_price}):d["city_"+p]={city_id:p,free_shipping_area_ids:_.area_ids.toString(),free_shipping_area_names:_.free_shipping_area_names,free_shipping_num:_.free_shipping_num,free_shipping_price:_.free_shipping_price}})}),y.value.forEach(_=>{_.area_ids.forEach(p=>{d["city_"+p]?Object.assign(d["city_"+p],{no_delivery_area_ids:_.area_ids.toString(),no_delivery_area_names:_.no_delivery_area_names}):d["city_"+p]={city_id:p,no_delivery_area_ids:_.area_ids.toString(),no_delivery_area_names:_.no_delivery_area_names}})}),s.area=Object.values(d),t(s).then(()=>{b.value=!1,q.push({path:"/shop/order/shipping/template"})}).catch(()=>{b.value=!1})}})},Z=()=>{q.push({path:"/shop/order/shipping/template"})};return(o,t)=>{const r=ge,s=ye,d=be,_=Ve,p=ke,V=Se,F=we,G=Ee,re=xe,oe=Ce,se=Ue,de=De,_e=Ne,pe=Te;return x(),O(he,null,[v("div",Oe,[v("div",je,[v("div",{class:"left",onClick:Z},[$e,v("span",qe,m(i(a)("returnToPreviousPage")),1)]),Le,v("span",We,m(i(J)),1)]),l(oe,{class:"box-card !border-none",shadow:"never"},{default:n(()=>[j((x(),K(re,{model:u,"label-width":"120px",ref_key:"formRef",ref:L,rules:i(M),class:"page-form"},{default:n(()=>[l(s,{label:i(a)("templateName"),prop:"template_name"},{default:n(()=>[l(r,{modelValue:u.template_name,"onUpdate:modelValue":t[0]||(t[0]=e=>u.template_name=e),clearable:"",placeholder:i(a)("templateNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(s,{label:i(a)("feeTypeName"),prop:"fee_type"},{default:n(()=>[l(_,{modelValue:u.fee_type,"onUpdate:modelValue":t[1]||(t[1]=e=>u.fee_type=e)},{default:n(()=>[l(d,{label:"num",size:"large"},{default:n(()=>[g(m(i(a)("num")),1)]),_:1}),l(d,{label:"weight",size:"large"},{default:n(()=>[g(m(i(a)("weight")),1)]),_:1}),l(d,{label:"volume",size:"large"},{default:n(()=>[g(m(i(a)("volume")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(s,{label:i(a)("feeSetting"),prop:"fee_data"},{default:n(()=>[l(F,{data:f.value,style:{width:"100%"},size:"default"},{default:n(()=>[l(p,{label:i(a)("deliveryArea")},{default:n(({row:e,$index:c})=>[v("div",Ze,[c?(x(),O("span",{key:0,onClick:w=>R("fee",c),class:"cursor-pointer"},m(e.fee_area_names?e.fee_area_names:i(a)("areaPlaceholder")),9,Ge)):(x(),O("span",Ke,m(e.fee_area_names?e.fee_area_names:i(a)("areaPlaceholder")),1))])]),_:1},8,["label"]),l(p,{label:i(U).first},{default:n(({$index:e})=>[l(r,{modelValue:f.value[e].snum,"onUpdate:modelValue":c=>f.value[e].snum=c},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),l(p,{label:i(a)("fee")},{default:n(({$index:e})=>[l(r,{modelValue:f.value[e].sprice,"onUpdate:modelValue":c=>f.value[e].sprice=c},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),l(p,{label:i(U).continue},{default:n(({$index:e})=>[l(r,{modelValue:f.value[e].xnum,"onUpdate:modelValue":c=>f.value[e].xnum=c},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),l(p,{label:i(a)("continueFee")},{default:n(({$index:e})=>[l(r,{modelValue:f.value[e].xprice,"onUpdate:modelValue":c=>f.value[e].xprice=c},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),l(p,{label:i(a)("operation"),align:"right",width:"150"},{default:n(({$index:e})=>[e?(x(),K(V,{key:0,type:"primary",onClick:c=>z("fee",e),link:""},{default:n(()=>[g(m(i(a)("delete")),1)]),_:2},1032,["onClick"])):ve("",!0)]),_:1},8,["label"])]),_:1},8,["data"]),v("div",Xe,[l(V,{type:"primary",onClick:t[2]||(t[2]=e=>A("fee"))},{default:n(()=>[g(m(i(a)("addDeliveryArea")),1)]),_:1})])]),_:1},8,["label"]),l(s,{label:i(a)("freeShipping"),prop:"is_free_shipping"},{default:n(()=>[l(G,{modelValue:u.is_free_shipping,"onUpdate:modelValue":t[3]||(t[3]=e=>u.is_free_shipping=e),size:"small","inactive-value":0,"active-value":1},null,8,["modelValue"])]),_:1},8,["label"]),j(l(s,{prop:"free_shipping_data"},{default:n(()=>[l(F,{data:h.value,style:{width:"100%"},size:"default"},{default:n(()=>[l(p,{label:i(a)("freeShippingArea")},{default:n(({row:e,$index:c})=>[v("div",Ye,[l(r,{modelValue:e.free_shipping_area_names,"onUpdate:modelValue":w=>e.free_shipping_area_names=w,placeholder:i(a)("areaPlaceholder"),readonly:"",onClick:w=>R("free_shipping",c)},null,8,["modelValue","onUpdate:modelValue","placeholder","onClick"])])]),_:1},8,["label"]),l(p,{label:i(W)},{default:n(({$index:e})=>[l(r,{modelValue:h.value[e].free_shipping_num,"onUpdate:modelValue":c=>h.value[e].free_shipping_num=c},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),l(p,{label:i(a)("freeShippingPrice")},{default:n(({$index:e})=>[l(r,{modelValue:h.value[e].free_shipping_price,"onUpdate:modelValue":c=>h.value[e].free_shipping_price=c},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),l(p,{label:i(a)("operation"),align:"right",width:"150"},{default:n(({$index:e})=>[l(V,{type:"primary",onClick:c=>z("free_shipping",e),link:""},{default:n(()=>[g(m(i(a)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),v("div",He,m(i(a)("freeShippingAreaTips")),1),v("div",Je,[l(V,{type:"primary",onClick:t[4]||(t[4]=e=>A("free_shipping"))},{default:n(()=>[g(m(i(a)("addFreeShippingArea")),1)]),_:1})])]),_:1},512),[[X,u.is_free_shipping]]),l(s,{label:i(a)("noDelivery"),prop:"no_delivery"},{default:n(()=>[l(G,{modelValue:u.no_delivery,"onUpdate:modelValue":t[5]||(t[5]=e=>u.no_delivery=e),size:"small","inactive-value":0,"active-value":1},null,8,["modelValue"])]),_:1},8,["label"]),j(l(s,{prop:"no_delivery_data"},{default:n(()=>[l(F,{data:y.value,style:{width:"100%"},size:"default"},{default:n(()=>[l(p,{label:i(a)("noDelivery")},{default:n(({row:e,$index:c})=>[v("div",Me,[l(r,{modelValue:e.no_delivery_area_names,"onUpdate:modelValue":w=>e.no_delivery_area_names=w,readonly:"",onClick:w=>R("no_delivery",c),placeholder:i(a)("areaPlaceholder")},null,8,["modelValue","onUpdate:modelValue","onClick","placeholder"])])]),_:1},8,["label"]),l(p,{label:i(a)("operation"),align:"right",width:"150"},{default:n(({$index:e})=>[l(V,{type:"primary",onClick:c=>z("no_delivery",e),link:""},{default:n(()=>[g(m(i(a)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),v("div",Qe,[l(V,{type:"primary",onClick:t[6]||(t[6]=e=>A("no_delivery"))},{default:n(()=>[g(m(i(a)("addNoDelivery")),1)]),_:1})])]),_:1},512),[[X,u.no_delivery]])]),_:1},8,["model","rules"])),[[pe,b.value]])]),_:1}),v("div",ea,[v("div",aa,[l(V,{type:"primary",onClick:t[7]||(t[7]=e=>ne(L.value)),disabled:b.value},{default:n(()=>[g(m(i(a)("save")),1)]),_:1},8,["disabled"]),l(V,{onClick:t[8]||(t[8]=e=>Z())},{default:n(()=>[g(m(i(a)("cancel")),1)]),_:1})])])]),l(_e,{modelValue:E.value,"onUpdate:modelValue":t[10]||(t[10]=e=>E.value=e),title:i(a)("selectArea"),width:"80%",class:"diy-dialog-wrap","destroy-on-close":!0,onOpened:ie},{footer:n(()=>[v("span",la,[l(V,{onClick:t[9]||(t[9]=e=>E.value=!1)},{default:n(()=>[g(m(i(a)("cancel")),1)]),_:1}),l(V,{type:"primary",loading:b.value,onClick:te},{default:n(()=>[g(m(i(a)("confirm")),1)]),_:1},8,["loading"])])]),default:n(()=>[l(de,{height:"50vh"},{default:n(()=>[l(se,{data:i(le),props:{children:"child",label:"name"},"default-expand-all":"","show-checkbox":"",ref_key:"areaTreeRef",ref:B,"default-checked-keys":i(P),"node-key":"id"},null,8,["data","default-checked-keys"])]),_:1})]),_:1},8,["modelValue","title"])],64)}}});const xa=Fe(ta,[["__scopeId","data-v-1978dc8f"]]);export{xa as default};
