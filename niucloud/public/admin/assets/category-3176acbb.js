import{d as q,O as z,cQ as G,n as Q,v as A,D as H,r as I,cy as E,h as T,c as J,e as r,w as n,a as _,t as u,u as d,i as y,N as i,y as K,I as U,R as W,a8 as X,E as Y,ah as Z,V as ee,av as te,aj as ae,_ as oe,$ as se,p as ie,g as re}from"./index-a2233f8b.js";/* empty css                   *//* empty css                *//* empty css                        *//* empty css                    *//* empty css               */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                  */import{_ as ne}from"./category_default-03996666.js";import{g as le,u as ce,i as de,j as pe}from"./goods-b7f9d4bf.js";import{_ as _e}from"./category-edit.vue_vue_type_style_index_0_lang-64563098.js";import{_ as me}from"./goods-category-spread-popup.vue_vue_type_script_setup_true_lang-da44d90b.js";import{S as ue}from"./sortable.esm-be94e56d.js";import{_ as ge}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                   *//* empty css                *//* empty css                  */import"./index-58cd4749.js";import"./index.vue_vue_type_style_index_0_lang-a6915b29.js";import"./attachment-181b3017.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                    *//* empty css                         *//* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-be5440b6.js";/* empty css                */import"./sys-6f61a94e.js";import"./browser-a1ac24ac.js";const S=v=>(ie("data-v-b2a4c078"),v=v(),re(),v),fe={class:"main-container"},he={class:"flex justify-between items-center"},ye={class:"text-[20px]"},ve={class:"mt-[10px]"},xe=S(()=>_("i",{class:"order-0 iconfont icontuodong vues-rank mr-[8px]"},null,-1)),we={class:"order-2"},be={class:"h-[30px]"},Ce=S(()=>_("div",{class:"image-slot"},[_("img",{class:"w-[30px] h-[30px]",src:ne})],-1)),ke=q({__name:"category",setup(v){const B=z().meta.title,D=G(),a=Q({loading:!0,data:[],searchParam:{category_name:""}});A(()=>{H(()=>{$()}),w()});const p=I([]),$=()=>{const e=D.value.$el.querySelector(".el-table__body-wrapper tbody");ue.create(e,{handle:".vues-rank",animation:300,onMove:({dragged:o,related:l})=>{const c=p.value[o.rowIndex],m=p.value[l.rowIndex];if(c.pid!==m.pid)return!1},onStart:()=>{p.value=N(E(a.data))},onEnd:o=>{var x;const l=p.value[o.oldIndex],c=p.value[o.newIndex];if(o.oldIndex===o.newIndex||l.pid!==c.pid||p.value.indexOf(l)<0)return!1;const s=p.value.splice(o.oldIndex,1)[0];p.value.splice(o.newIndex,0,s);const b=c.pid,C=(x=p.value.filter(t=>t.pid===b))==null?void 0:x.map((t,g)=>{if(t.level===1&&t.category_id===s.category_id&&(a.data=a.data.filter(f=>f.category_id!==s.category_id),a.data.splice(g,0,s)),t.level===2&&t.category_id===s.category_id){const f=a.data.findIndex(k=>k.category_id===t.pid),O=E(a.data[f].child_list.filter(k=>k.category_id!==s.category_id));a.data[f].child_list=[],a.data[f].child_list.push(...O),a.data[f].child_list.splice(g,0,s)}return{category_id:t.category_id,sort:9999-g}});j({category_sort_array:C})}})},N=(e,o="child_list")=>{const l=[],c=m=>{m&&m.length>0&&m.filter(s=>s).forEach(s=>{l.push(s),c(s[o]||[])})};return c(e),l},w=()=>{a.loading=!0,le({...a.searchParam}).then(e=>{a.loading=!1,a.data=e.data}).catch(()=>{a.loading=!1})},j=e=>{ce(e).then(o=>{})},P=e=>{e.is_show=e.is_show===1?2:1;const o=E(e);delete o.child_list,de(o)},h=I(null),V=()=>{h.value.setFormData(),h.value.showDialog=!0},F=e=>{h.value.setFormData(e),h.value.showDialog=!0},L=e=>{X.confirm(!e.child_list||!e.child_list.length?i("categoryDeleteTips"):i("categoryDeleteTips1"),i("warning"),{confirmButtonText:i("confirm"),cancelButtonText:i("cancel"),type:"warning"}).then(()=>{pe(e.category_id).then(()=>{w()}).catch(()=>{})})},R=I(null),M=e=>{R.value.show(e)};return(e,o)=>{const l=Y,c=Z,m=ee,s=te,b=ae,C=oe,x=se;return T(),J("div",fe,[r(C,{class:"box-card !border-none",shadow:"never"},{default:n(()=>[_("div",he,[_("span",ye,u(d(B)),1),r(l,{type:"primary",onClick:V},{default:n(()=>[y(u(d(i)("addCategory")),1)]),_:1})]),_("div",ve,[K((T(),U(b,{data:a.data,ref_key:"tableRef",ref:D,size:"large","row-key":"category_id","tree-props":{hasChildren:"hasChildren",children:"child_list"}},{empty:n(()=>[_("span",null,u(a.loading?"":d(i)("emptyData")),1)]),default:n(()=>[r(c,{label:d(i)("categoryName"),"min-width":"120"},{default:n(({row:t})=>[xe,_("span",we,u(t.category_name),1)]),_:1},8,["label"]),r(c,{label:d(i)("image"),width:"170",align:"left"},{default:n(({row:t})=>[_("div",be,[r(m,{class:"w-[30px] h-[30px]",src:d(W)(t.image),fit:"contain"},{error:n(()=>[Ce]),_:2},1032,["src"])])]),_:1},8,["label"]),r(c,{prop:"is_show",label:d(i)("isShow"),width:"400"},{default:n(({row:t})=>[r(s,{class:"cursor-pointer",type:t.is_show!=2?"success":"danger",onClick:g=>P(t)},{default:n(()=>[y(u(t.is_show!=2?"是":"否"),1)]),_:2},1032,["type","onClick"])]),_:1},8,["label"]),r(c,{label:d(i)("operation"),fixed:"right",align:"right",width:"120"},{default:n(({row:t})=>[r(l,{type:"primary",link:"",onClick:g=>M(t)},{default:n(()=>[y(u(d(i)("spreadGoodsCategory")),1)]),_:2},1032,["onClick"]),r(l,{type:"primary",link:"",onClick:g=>F(t)},{default:n(()=>[y(u(d(i)("edit")),1)]),_:2},1032,["onClick"]),r(l,{type:"primary",link:"",onClick:g=>L(t)},{default:n(()=>[y(u(d(i)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[x,a.loading]])]),r(_e,{ref_key:"editCategoryDialog",ref:h,onComplete:w},null,512)]),_:1}),r(me,{ref_key:"goodsCategorySpreadPopupRef",ref:R},null,512)])}}});const dt=ge(ke,[["__scopeId","data-v-b2a4c078"]]);export{dt as default};
