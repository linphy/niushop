import{d as te,q as F,r as C,n as V,h as S,c as E,a as p,b as ae,e as d,w as n,i as P,t as c,u as l,N as s,y as w,z as T,F as le,G as se,I,R as de,cy as ne,D as pe,a3 as z,E as re,as as ie,aE as ce,X as ue,W as ge,cI as me,Y as _e,ah as fe,V as he,aj as ye,a4 as ve,aa as Se,$ as Pe,p as xe,g as be}from"./index-a2233f8b.js";/* empty css                   *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css                        *//* empty css                *//* empty css                          *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                  */import{_ as B}from"./goods_default-664bb559.js";import{g as ke,a as Ce,b as Ve}from"./goods-b7f9d4bf.js";import{_ as we}from"./_plugin-vue_export-helper-c27b6911.js";const Ge=x=>(xe("data-v-83122881"),x=x(),be(),x),Ee={class:"inline-block ml-[10px] text-[14px]"},Te={class:"text-primary mx-[2px]"},Ie={class:"flex items-center cursor-pointer"},$e={class:"min-w-[60px] h-[60px] flex items-center justify-center"},De=Ge(()=>p("div",{class:"image-slot"},[p("img",{class:"w-[60px] h-[60px]",src:B})],-1)),Ne={key:1,class:"w-[70px] h-[60px]",src:B,fit:"contain"},Fe={class:"ml-2"},ze=["title"],Be={class:"text-primary text-[12px]"},Re={class:"mt-[16px] flex"},Ue={class:"flex items-center flex-1"},Le={class:"layui-table-bottom-left-container mr-[10px]"},je={class:"text-primary mx-[2px]"},Ae={class:"dialog-footer"},Oe=te({__name:"goods-select-popup",props:{modelValue:{type:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0}},emits:["update:modelValue"],setup(x,{expose:R,emit:U}){const m=x,g=F({get(){return m.modelValue},set(t){U("update:modelValue",t)}}),y=C(!1),u=V({}),f=F(()=>Object.keys(u).length),o=V({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{keyword:"",goods_category:[],select_type:"all",goods_ids:"",verify_goods_ids:"",goods_type:""}}),$=C(),L=t=>{v()},G=V([]),j={checkStrictly:!0},D=V([]);(()=>{ke().then(t=>{const e=t.data;if(e){const r=[];e.forEach(i=>{const h=[];i.child_list&&i.child_list.forEach(_=>{h.push({value:_.category_id,label:_.category_name})}),r.push({value:i.category_id,label:i.category_name,children:h})}),G.splice(0,G.length,...r)}}),Ce().then(t=>{const e=t.data;if(e)for(const r in e)D.push(e[r])})})();const b=C();C([]);const A=(t,e)=>{let r=!1;for(let i=0;i<t.length;i++)if(t[i].goods_id==e.goods_id){r=!0;break}r?u["goods_"+e.goods_id]=e:delete u["goods_"+e.goods_id]},O=t=>{t.length?t.forEach(e=>{u["goods_"+e.goods_id]=e}):o.data.forEach(e=>{delete u["goods_"+e.goods_id]})},v=(t=1,e=null)=>{o.loading=!0,o.page=t;const r=ne(o.searchParam);if(r.select_type=="selected"){const i=[];for(let h in u)i.push(parseInt(h.replace("goods_","")));r.goods_ids=i}else r.goods_ids="";Ve({page:o.page,limit:o.limit,...r}).then(i=>{o.loading=!1,o.data=i.data.data,o.total=i.data.total,e&&e(i.data.verify_goods_ids),N()}).catch(()=>{o.loading=!1})},N=()=>{pe(()=>{if(b.value)for(let t=0;t<o.data.length;t++)b.value.toggleRowSelection(o.data[t],!1),u["goods_"+o.data[t].goods_id]&&b.value.toggleRowSelection(o.data[t],!0)})},M=t=>{t&&(t.resetFields(),v())},q=()=>{o.searchParam.verify_goods_ids=g.value,v(1,t=>{if(g.value){g.value.splice(0,g.value.length,...t),g.value.forEach(e=>{u["goods_"+e]||(u["goods_"+e]={})});for(let e=0;e<o.data.length;e++)g.value.indexOf(o.data[e].goods_id)!=-1&&(u["goods_"+o.data[e].goods_id]=o.data[e])}}),y.value=!0},W=()=>{for(let t in u)delete u[t];N()},X=()=>{if(m.min&&f.value<m.min){z({type:"warning",message:`${s("goodsSelectPopupGoodsMinTip")}${m.min}${s("goodsSelectPopupPiece")}`});return}if(m.max&&m.max>0&&f.value&&f.value>m.max){z({type:"warning",message:`${s("goodsSelectPopupGoodsMaxTip")}${m.max}${s("goodsSelectPopupPiece")}`});return}let t=[];for(let e in u)t.push(parseInt(e.replace("goods_","")));g.value.splice(0,g.value.length,...t),y.value=!1};return R({showDialog:y,selectGoods:u,selectGoodsNum:f}),(t,e)=>{const r=re,i=ie,h=ce,_=ue,Y=ge,H=me,J=_e,k=fe,K=he,Q=ye,Z=ve,ee=Se,oe=Pe;return S(),E("div",null,[p("div",{onClick:q},[ae(t.$slots,"default",{},()=>[d(r,null,{default:n(()=>[P(c(l(s)("goodsSelectPopupSelectGoodsButton")),1)]),_:1}),w(p("div",Ee,[p("span",null,c(l(s)("goodsSelectPopupSelect")),1),p("span",Te,c(l(g).length),1),p("span",null,c(l(s)("goodsSelectPopupPiece")),1)],512),[[T,l(g).length]])],!0)]),d(ee,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=a=>y.value=a),title:l(s)("goodsSelectPopupSelectGoodsDialog"),width:"1000px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:n(()=>[p("span",Ae,[d(r,{onClick:e[9]||(e[9]=a=>y.value=!1)},{default:n(()=>[P(c(l(s)("cancel")),1)]),_:1}),d(r,{type:"primary",onClick:X},{default:n(()=>[P(c(l(s)("confirm")),1)]),_:1})])]),default:n(()=>[d(J,{inline:!0,model:o.searchParam,ref_key:"searchFormRef",ref:$},{default:n(()=>[d(_,{prop:"select_type",class:"form-item-wrap"},{default:n(()=>[d(h,{modelValue:o.searchParam.select_type,"onUpdate:modelValue":e[0]||(e[0]=a=>o.searchParam.select_type=a),onChange:L},{default:n(()=>[d(i,{label:l(s)("goodsSelectPopupAllGoods"),value:"all"},null,8,["label"]),d(i,{label:l(s)("goodsSelectPopupSelectedGoods"),value:"selected"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),d(_,{label:l(s)("goodsSelectPopupGoodsName"),prop:"keyword",class:"form-item-wrap"},{default:n(()=>[d(Y,{modelValue:o.searchParam.keyword,"onUpdate:modelValue":e[1]||(e[1]=a=>o.searchParam.keyword=a),placeholder:l(s)("goodsSelectPopupGoodsNamePlaceholder"),maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d(_,{label:l(s)("goodsSelectPopupGoodsCategory"),prop:"goods_category",class:"form-item-wrap"},{default:n(()=>[d(H,{props:j,modelValue:o.searchParam.goods_category,"onUpdate:modelValue":e[2]||(e[2]=a=>o.searchParam.goods_category=a),options:G,placeholder:l(s)("goodsSelectPopupGoodsCategoryPlaceholder"),clearable:"",filterable:""},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),d(_,{label:l(s)("goodsSelectPopupGoodsType"),prop:"goods_type",class:"form-item-wrap"},{default:n(()=>[d(h,{modelValue:o.searchParam.goods_type,"onUpdate:modelValue":e[3]||(e[3]=a=>o.searchParam.goods_type=a),placeholder:l(s)("goodsSelectPopupGoodsTypePlaceholder"),clearable:""},{default:n(()=>[(S(!0),E(le,null,se(D,a=>(S(),I(i,{key:a.type,label:a.name,value:a.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),d(_,{class:"form-item-wrap"},{default:n(()=>[d(r,{type:"primary",onClick:e[4]||(e[4]=a=>v())},{default:n(()=>[P(c(l(s)("search")),1)]),_:1}),d(r,{onClick:e[5]||(e[5]=a=>M($.value))},{default:n(()=>[P(c(l(s)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),w((S(),I(Q,{data:o.data,size:"large",ref_key:"goodsListTableRef",ref:b,"max-height":"400",onSelect:A,onSelectAll:O},{empty:n(()=>[p("span",null,c(o.loading?"":l(s)("emptyData")),1)]),default:n(()=>[d(k,{type:"selection",width:"55"}),d(k,{prop:"goods_id",label:l(s)("goodsSelectPopupGoodsInfo"),"min-width":"400"},{default:n(({row:a})=>[p("div",Ie,[p("div",$e,[a.goods_cover_thumb_small?(S(),I(K,{key:0,class:"w-[60px] h-[60px]",src:l(de)(a.goods_cover_thumb_small),fit:"contain"},{error:n(()=>[De]),_:2},1032,["src"])):(S(),E("img",Ne))]),p("div",Fe,[p("span",{title:a.goods_name,class:"multi-hidden"},c(a.goods_name),9,ze),p("span",Be,c(a.goods_type_name),1)])])]),_:1},8,["label"]),d(k,{prop:"price",label:l(s)("goodsSelectPopupPrice"),"min-width":"120",align:"right"},{default:n(({row:a})=>[p("div",null,"ï¿¥"+c(a.goodsSku.price),1)]),_:1},8,["label"]),d(k,{prop:"stock",label:l(s)("goodsSelectPopupStock"),"min-width":"120",align:"right"},null,8,["label"])]),_:1},8,["data"])),[[oe,o.loading]]),p("div",Re,[p("div",Ue,[w(p("div",Le,[p("span",null,c(l(s)("goodsSelectPopupBeforeTip")),1),p("span",je,c(l(f)),1),p("span",null,c(l(s)("goodsSelectPopupAfterTip")),1)],512),[[T,l(f)]]),w(d(r,{type:"primary",link:"",onClick:W},{default:n(()=>[P(c(l(s)("goodsSelectPopupClearGoods")),1)]),_:1},512),[[T,l(f)]])]),d(Z,{"current-page":o.page,"onUpdate:current-page":e[6]||(e[6]=a=>o.page=a),"page-size":o.limit,"onUpdate:page-size":e[7]||(e[7]=a=>o.limit=a),layout:"total, sizes, prev, pager, next, jumper",total:o.total,onSizeChange:e[8]||(e[8]=a=>v()),onCurrentChange:v},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"])])}}});const _o=we(Oe,[["__scopeId","data-v-83122881"]]);export{_o as default};
