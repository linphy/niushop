import{d as Z,v as K,f as ee,r as w,l as te,M as le,k as a,h as u,c as b,e as r,w as d,u as o,J as ae,m as F,a as s,t as f,F as x,O as V,i as q,B as O,am as re,P as A,av as oe,K as ne,D as ie,G as de,$ as se,ad as pe,ab as ue,ac as ce,aw as _e,ak as me,bx as fe,H as ve,E as ge,L as be}from"./index-e4c6b343.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                          *//* empty css                    *//* empty css                  *//* empty css                       *//* empty css                 *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                       */import{g as he,a as xe,b as ke,c as ye,e as Ve,d as we}from"./printer-c553c60d.js";const Pe={class:"main-container"},Ee={class:"panel-title !text-sm"},Ue={class:"text-[12px] text-[#b2b2b2]"},Ce={class:"text-[12px] text-[#b2b2b2]"},Te={class:"text-[12px] text-[#b2b2b2]"},Fe={class:"text-[12px] text-[#b2b2b2]"},Ne={class:"panel-title !text-sm"},Be={class:"flex mb-[10px] py-[8px] bg-[#F5F7F9] text-[14px]"},Me={class:"px-[12px] w-[200px]"},$e={class:"px-[12px] w-[100px]"},qe={class:"px-[12px] w-[250px]"},Le={class:"px-[12px] w-[200px]"},Oe={class:"font-bold w-[200px] px-[12px]"},Re={class:"w-[100px] px-[12px]"},De={class:"w-[250px] px-[12px]"},je={key:0,class:"w-[300px] px-[12px] flex-1"},Se={class:"w-[200px] px-[12px]"},Ge={class:"fixed-footer-wrap"},He={class:"fixed-footer"},ut=Z({__name:"edit",setup(Ae){const R=K(),D=ee(),P=w(!1),N=w(!0),I=R.meta.title,J={printer_id:R.query.printer_id||0,brand:"",printer_name:"",printer_code:"",printer_key:"",open_id:"",apikey:"",template_type:[],trigger:[],value:{},print_width:"58mm",status:1},e=te({...J}),j=w(),W=le(()=>({printer_name:[{required:!0,message:a("printerNamePlaceholder"),trigger:"blur"}],brand:[{required:!0,message:a("brandPlaceholder"),trigger:"blur"}],printer_code:[{required:!0,message:a("printerCodePlaceholder"),trigger:"blur"}],printer_key:[{required:!0,message:a("printerKeyPlaceholder"),trigger:"blur"}],open_id:[{required:!0,message:a("openIdPlaceholder"),trigger:"blur"}],apikey:[{required:!0,message:a("apikeyPlaceholder"),trigger:"blur"}]})),k=w([]);(async()=>{await ke({}).then(v=>{if(v.data){k.value=v.data;for(let l=0;l<k.value.length;l++){let n=k.value[l];e.value[n.key]={};let i={};for(let _=0;_<n.condition.length;_++){let m=n.condition[_];if(i[m.key]=[],m.type=="checkbox"){i[m.key]=[];for(let p=0;p<m.list.length;p++)i[m.key].push(m.list[p].value)}}for(let _ in n.trigger)e.value[n.key]["trigger_"+_]={status:1,template_id:"",print_num:1},Object.assign(e.value[n.key]["trigger_"+_],re(i))}}e.printer_id||(N.value=!1)}),e.printer_id&&ye(e.printer_id).then(v=>{let l=v.data;l&&Object.keys(e).forEach(n=>{if(l[n]!=null)if(n=="value")for(let i in e[n])Object.assign(e[n][i],l[n][i]);else e[n]=l[n]}),N.value=!1})})();const S=w([]);he({}).then(v=>{S.value=v.data});const B=w({});xe({}).then(v=>{if(v.data){let l=v.data;for(let n=0;n<l.length;n++){let i=l[n];B.value[i.template_type]==null&&(B.value[i.template_type]=[]),B.value[i.template_type].push({template_id:i.template_id,template_name:i.template_name})}}});const z=async v=>{if(N.value||!v)return;if(k.value.length==0){A({type:"warning",message:a("printTypeEmpty")});return}let l=e.printer_id?Ve:we;await v.validate(async n=>{if(n){let i=!1,_="";for(let p=0;p<k.value.length;p++){let c=k.value[p];for(let E=0;E<Object.keys(c.trigger).length;E++){let y=Object.keys(c.trigger)[E];if(e.value[c.key]["trigger_"+y].status==0)continue;if(!e.value[c.key]["trigger_"+y].template_id){i=!0,_=`请设置${c.title}[${c.trigger[y]}]的小票打印模板`;break}let U=!1;for(let C=0;C<c.condition.length;C++){let T=c.condition[C];if(T.type=="checkbox"&&e.value[c.key]["trigger_"+y][T.key].length==0){i=!0,_=`请设置${c.title}[${c.trigger[y]}]的${T.title}`,U=!0;break}}if(U)break}if(i)break}if(i){A({type:"warning",message:_});return}e.template_type=[],e.trigger=[];for(let p in e.value){for(let c in e.value[p])e.trigger.push(p+"_"+c);e.template_type.push(p)}if(P.value)return;P.value=!0,l(e).then(p=>{P.value=!1,e.printer_id||D.push("/printer/list")}).catch(p=>{P.value=!1})}})},G=()=>{D.push("/printer/list")};return(v,l)=>{const n=oe,i=ne,_=ie,m=de,p=se,c=pe,E=ue,y=ce,U=_e,C=me,T=fe,Q=ve,H=ge,X=be;return u(),b("div",Pe,[r(i,{class:"card !border-none mb-[15px]",shadow:"never"},{default:d(()=>[r(n,{content:o(I),icon:v.ArrowLeft,onBack:G},null,8,["content","icon"])]),_:1}),ae((u(),F(Q,{class:"page-form",model:e,rules:o(W),"label-width":"150px",ref_key:"formRef",ref:j},{default:d(()=>[r(i,{class:"box-card !border-none",shadow:"never"},{default:d(()=>[s("h3",Ee,f(o(a)("printerSet")),1),r(m,{label:o(a)("printerName"),prop:"printer_name"},{default:d(()=>[r(_,{modelValue:e.printer_name,"onUpdate:modelValue":l[0]||(l[0]=t=>e.printer_name=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("printerNamePlaceholder"),class:"input-width",maxlength:"20"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(m,{label:o(a)("brand"),prop:"brand"},{default:d(()=>[r(c,{modelValue:e.brand,"onUpdate:modelValue":l[1]||(l[1]=t=>e.brand=t),placeholder:o(a)("brandPlaceholder"),clearable:""},{default:d(()=>[(u(!0),b(x,null,V(S.value,(t,L)=>(u(),F(p,{key:L,label:t,value:L},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),r(m,{label:o(a)("printerCode"),prop:"printer_code"},{default:d(()=>[s("div",null,[r(_,{modelValue:e.printer_code,"onUpdate:modelValue":l[2]||(l[2]=t=>e.printer_code=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("printerCodePlaceholder"),class:"input-width",maxlength:"30"},null,8,["modelValue","placeholder"]),s("p",Ue,f(o(a)("printerCodeTips")),1)])]),_:1},8,["label"]),r(m,{label:o(a)("printerKey"),prop:"printer_key"},{default:d(()=>[s("div",null,[r(_,{modelValue:e.printer_key,"onUpdate:modelValue":l[3]||(l[3]=t=>e.printer_key=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("printerKeyPlaceholder"),class:"input-width",maxlength:"30"},null,8,["modelValue","placeholder"]),s("p",Ce,f(o(a)("printerKeyTips")),1)])]),_:1},8,["label"]),r(m,{label:o(a)("openId"),prop:"open_id"},{default:d(()=>[s("div",null,[r(_,{modelValue:e.open_id,"onUpdate:modelValue":l[4]||(l[4]=t=>e.open_id=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("openIdPlaceholder"),class:"input-width",maxlength:"30"},null,8,["modelValue","placeholder"]),s("p",Te,f(o(a)("openIdTips")),1)])]),_:1},8,["label"]),r(m,{label:o(a)("apikey"),prop:"apikey"},{default:d(()=>[s("div",null,[r(_,{modelValue:e.apikey,"onUpdate:modelValue":l[5]||(l[5]=t=>e.apikey=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("apikeyPlaceholder"),class:"input-width",maxlength:"60"},null,8,["modelValue","placeholder"]),s("p",Fe,f(o(a)("apikeyTips")),1)])]),_:1},8,["label"]),r(m,{label:o(a)("printWidth"),prop:"print_width"},{default:d(()=>[r(y,{modelValue:e.print_width,"onUpdate:modelValue":l[6]||(l[6]=t=>e.print_width=t)},{default:d(()=>[r(E,{value:"58mm"},{default:d(()=>[q("58mm")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),r(m,{label:o(a)("status")},{default:d(()=>[r(U,{modelValue:e.status,"onUpdate:modelValue":l[7]||(l[7]=t=>e.status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),(u(!0),b(x,null,V(k.value,(t,L)=>(u(),F(i,{key:t.key,class:"box-card !border-none",shadow:"never"},{default:d(()=>[s("h3",Ne,f(t.title),1),s("div",Be,[s("div",Me,f(o(a)("printTrigger")),1),s("div",$e,f(o(a)("status")),1),s("div",qe,f(o(a)("usePrintTemplate")),1),(u(!0),b(x,null,V(t.condition,M=>(u(),b("div",{class:"px-[12px] w-[300px] flex-1",key:M.key},f(M.title),1))),128)),s("div",Le,f(o(a)("printNum")),1)]),t.trigger?(u(!0),b(x,{key:0},V(t.trigger,(M,h)=>(u(),b("div",{class:"flex bg-[#f8f8f9] mb-[10px] py-[20px]",key:h},[e.value[t.key]["trigger_"+h]?(u(),b(x,{key:0},[s("div",Oe,f(M),1),s("div",Re,[r(U,{modelValue:e.value[t.key]["trigger_"+h].status,"onUpdate:modelValue":g=>e.value[t.key]["trigger_"+h].status=g,"active-value":1,"inactive-value":0},null,8,["modelValue","onUpdate:modelValue"])]),s("div",De,[r(c,{modelValue:e.value[t.key]["trigger_"+h].template_id,"onUpdate:modelValue":g=>e.value[t.key]["trigger_"+h].template_id=g,placeholder:o(a)("请选择小票打印模板"),clearable:""},{default:d(()=>[(u(!0),b(x,null,V(B.value[t.key],g=>(u(),F(p,{key:g.template_id,label:g.template_name,value:g.template_id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),(u(!0),b(x,null,V(t.condition,g=>(u(),b(x,null,[g.type=="checkbox"?(u(),b("div",je,[r(T,{modelValue:e.value[t.key]["trigger_"+h][g.key],"onUpdate:modelValue":$=>e.value[t.key]["trigger_"+h][g.key]=$},{default:d(()=>[(u(!0),b(x,null,V(g.list,($,Y)=>(u(),F(C,{label:$.value,key:Y},{default:d(()=>[q(f($.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):O("",!0)],64))),256)),s("div",Se,[r(c,{modelValue:e.value[t.key]["trigger_"+h].print_num,"onUpdate:modelValue":g=>e.value[t.key]["trigger_"+h].print_num=g},{default:d(()=>[r(p,{label:"1联",value:1}),r(p,{label:"2联",value:2}),r(p,{label:"3联",value:3}),r(p,{label:"4联",value:4})]),_:2},1032,["modelValue","onUpdate:modelValue"])])],64)):O("",!0)]))),128)):O("",!0)]),_:2},1024))),128))]),_:1},8,["model","rules"])),[[X,N.value]]),s("div",Ge,[s("div",He,[r(H,{type:"primary",loading:P.value,onClick:l[8]||(l[8]=t=>z(j.value))},{default:d(()=>[q(f(o(a)("save")),1)]),_:1},8,["loading"]),r(H,{onClick:l[9]||(l[9]=t=>G())},{default:d(()=>[q(f(o(a)("cancel")),1)]),_:1})])])])}}});export{ut as default};
