import{d as ee,v as te,f as le,r as U,l as ae,M as oe,k as c,h as s,c as v,e as u,w as d,u as g,J as se,m as x,a as _,t as h,F as T,O as F,i as j,B as V,aC as ne,aD as re,P as S,av as ue,K as de,D as pe,G as ie,ab as me,ac as ce,ak as ve,bx as _e,$ as fe,ad as ye,H as be,E as ke,L as ge}from"./index-a59af0dd.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                          *//* empty css                    *//* empty css                       *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                       */import{b as xe,i as he,j as Ve,k as we}from"./printer-0d9e5c39.js";const Ee={class:"main-container"},Ue={class:"flex"},Te={class:"flex-1 mr-[20px] bg-[#fff]"},Ce={class:"panel-title !text-sm"},Pe={class:"panel-title !text-sm"},Ne={class:"panel-title !text-sm"},Fe={class:"flex"},Oe={class:"leading-[30px] w-[50px] text-center text-[#707070] bg-[#d7d7d7] border-1 border-solid border-[#ededed]"},je={key:4,class:"flex mr-[30px]"},Be=_("div",{class:"leading-[30px] w-[50px] text-center text-[#707070] bg-[#d7d7d7] border-1 border-solid border-[#ededed]"},"字号",-1),De={key:5,class:"flex mr-[30px]"},Se=_("div",{class:"leading-[30px] w-[50px] text-center text-[#707070] bg-[#d7d7d7] border-1 border-solid border-[#ededed]"},"粗细",-1),Re={key:0,class:"text-[12px] text-[#b2b2b2] mt-[10px]"},ze={class:"panel-title !text-sm"},Le={class:"fixed-footer-wrap"},Me={class:"fixed-footer"},rt=ee({__name:"template_edit",setup($e){const R=te(),H=le(),A=R.meta.title,C=U(!1),P=U(!0),J={template_id:R.query.template_id||0,template_type:"",template_name:"",value:{}},e=ae({...J}),z=U(),K=oe(()=>({template_name:[{required:!0,message:c("templateNamePlaceholder"),trigger:"blur"}],template_type:[{required:!0,message:c("templateTypePlaceholder"),trigger:"blur"}]})),L=Object.assign({}),M=Object.assign({});M&&Object.assign(L,M);const $={};for(const[r,o]of Object.entries(L)){const n=r.split("/").pop().split(".")[0];$[n]=o.default}const W=U(""),f=U([]),w=U([]);(async()=>{await xe({}).then(r=>{r.data&&r.data.length&&(f.value=r.data,q(f.value[0].key,Boolean(parseInt(e.template_id)))),e.template_id||(P.value=!1)}),e.template_id&&he(e.template_id).then(r=>{let o=r.data;o&&Object.keys(o).length?(Object.keys(e).forEach(a=>{if(a=="value")for(let n in e[a])Object.assign(e[a][n],o[a][n]);else e[a]=o[a]}),P.value=!1):(S({type:"warning",duration:1500,message:c("printTemplateEmpty")}),setTimeout(()=>{O(),P.value=!1},2e3))})})();const q=(r,o=!1)=>{for(let a=0;a<f.value.length;a++)if(f.value[a].key==r){e.template_type=f.value[a].key,W.value=f.value[a].path,w.value=f.value[a].template;break}for(let a in e.value)delete e.value[a];Q()},Q=()=>{for(let r=0;r<w.value.length;r++){let o=w.value[r];e.value[o.key]={};for(let a=0;a<o.list.length;a++){let n=o.list[a];e.value[o.key][n.key]={type:n.type,value:n.value,status:n.status,fontSize:n.fontSize,fontWeight:n.fontWeight}}}},X=async r=>{if(P.value||!r)return;if(f.value.length==0){S({type:"warning",message:c("printTypeEmpty")});return}let o=e.template_id?Ve:we;await r.validate(async a=>{if(a){let n=!1,E="";for(let y=0;y<w.value.length;y++){let m=w.value[y],b=!1;for(let k=0;k<m.list.length;k++){let i=m.list[k];if(e.value[m.key][i.key].status!=0){if(i.type=="input"){if(e.value[m.key][i.key].value==""){n=!0,E=`请输入${i.label}`,b=!0;break}}else if(i.type=="select"&&e.value[m.key][i.key].value==""){n=!0,E=`${i.label}未设置[${i.text}]`,b=!0;break}}}if(b)break}if(n){S({type:"warning",message:E});return}for(let y=0;y<w.value.length;y++){let m=w.value[y];for(let b=0;b<m.list.length;b++){let k=m.list[b];k.type=="checkbox"&&(e.value[m.key][k.key].value.length?e.value[m.key][k.key].status=1:e.value[m.key][k.key].status=0)}}if(C.value)return;C.value=!0,o(e).then(y=>{C.value=!1,e.template_id||O()}).catch(y=>{C.value=!1})}})},O=()=>{H.push("/printer/template/list")};return(r,o)=>{const a=ue,n=de,E=pe,B=ie,y=me,m=ce,b=ve,k=_e,i=fe,D=ye,Y=be,G=ke,Z=ge;return s(),v("div",Ee,[u(n,{class:"card !border-none mb-[15px]",shadow:"never"},{default:d(()=>[u(a,{content:g(A),icon:r.ArrowLeft,onBack:O},null,8,["content","icon"])]),_:1}),se((s(),x(Y,{class:"page-form",model:e,rules:g(K),"label-width":"150px",ref_key:"formRef",ref:z},{default:d(()=>[_("div",Ue,[_("div",Te,[u(n,{class:"box-card !border-none",shadow:"never"},{default:d(()=>[_("h3",Ce,h(g(c)("templateInfoLabel")),1),u(B,{label:g(c)("templateName"),prop:"template_name"},{default:d(()=>[u(E,{modelValue:e.template_name,"onUpdate:modelValue":o[0]||(o[0]=l=>e.template_name=l),modelModifiers:{trim:!0},clearable:"",placeholder:g(c)("templateNamePlaceholder"),class:"input-width",maxlength:"20"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),f.value.length?(s(),x(B,{key:0,label:g(c)("templateType"),prop:"template_type"},{default:d(()=>[u(m,{modelValue:e.template_type,"onUpdate:modelValue":o[1]||(o[1]=l=>e.template_type=l)},{default:d(()=>[(s(!0),v(T,null,F(f.value,l=>(s(),x(y,{key:l.key,label:l.key,onChange:q},{default:d(()=>[j(h(l.title),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):V("",!0)]),_:1}),f.value.length?(s(),x(n,{key:0,class:"box-card !border-none",shadow:"never"},{default:d(()=>[_("h3",Pe,h(g(c)("templateEditLabel")),1),(s(!0),v(T,null,F(w.value,l=>(s(),v("div",{key:l.key,class:"bg-[#f8f8f9] mb-[20px] py-[20px] px-[40px] text-[14px]"},[_("h4",Ne,h(l.title),1),(s(!0),v(T,null,F(l.list,(t,I)=>(s(),v("div",{key:t.key,class:"ml-[30px]",style:ne({"margin-bottom":l.list.length==I+1?"0":"20px"})},[_("div",Fe,[t.label?(s(),x(b,{key:0,modelValue:e.value[l.key][t.key].status,"onUpdate:modelValue":p=>e.value[l.key][t.key].status=p,label:t.label,value:t.status,"true-value":1,"false-value":0,class:"w-[180px] mr-[10px]",disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","label","value","disabled"])):V("",!0),t.type=="input"?(s(),x(E,{key:1,modelValue:e.value[l.key][t.key].value,"onUpdate:modelValue":p=>e.value[l.key][t.key].value=p,modelModifiers:{trim:!0},clearable:"",placeholder:"请输入"+(t.placeholder?t.placeholder:t.label),class:"input-width mr-[30px]",maxlength:"32"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):V("",!0),t.type=="checkbox"?(s(),x(k,{key:2,modelValue:e.value[l.key][t.key].value,"onUpdate:modelValue":p=>e.value[l.key][t.key].value=p,class:"mr-[30px]"},{default:d(()=>[(s(!0),v(T,null,F(t.list,(p,N)=>(s(),x(b,{label:N,key:N,disabled:t.disabled},{default:d(()=>[j(h(p),1)]),_:2},1032,["label","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):V("",!0),t.type=="select"?(s(),v(T,{key:3},[_("div",Oe,h(t.text),1),u(D,{modelValue:e.value[l.key][t.key].value,"onUpdate:modelValue":p=>e.value[l.key][t.key].value=p,class:"!w-[130px] mr-[30px]"},{default:d(()=>[(s(!0),v(T,null,F(t.list,(p,N)=>(s(),x(i,{key:N,label:p,value:N},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])],64)):V("",!0),t.fontSize?(s(),v("div",je,[Be,u(D,{modelValue:e.value[l.key][t.key].fontSize,"onUpdate:modelValue":p=>e.value[l.key][t.key].fontSize=p,class:"!w-[130px]"},{default:d(()=>[u(i,{label:"小",value:"normal"}),u(i,{label:"大",value:"big"})]),_:2},1032,["modelValue","onUpdate:modelValue"])])):V("",!0),t.fontWeight?(s(),v("div",De,[Se,u(D,{modelValue:e.value[l.key][t.key].fontWeight,"onUpdate:modelValue":p=>e.value[l.key][t.key].fontWeight=p,class:"!w-[130px]"},{default:d(()=>[u(i,{label:"正常",value:"normal"}),u(i,{label:"加粗",value:"bold"})]),_:2},1032,["modelValue","onUpdate:modelValue"])])):V("",!0)]),t.remark?(s(),v("div",Re,h(t.remark),1)):V("",!0)],4))),128))]))),128))]),_:1})):V("",!0)]),u(n,{class:"box-card !border-none w-[450px]",shadow:"never"},{default:d(()=>[_("h3",ze,h(g(c)("preview")),1),(s(),x(re($[W.value]),{value:e.value},null,8,["value"]))]),_:1})])]),_:1},8,["model","rules"])),[[Z,P.value]]),_("div",Le,[_("div",Me,[u(G,{type:"primary",loading:C.value,onClick:o[2]||(o[2]=l=>X(z.value))},{default:d(()=>[j(h(g(c)("save")),1)]),_:1},8,["loading"]),u(G,{onClick:o[3]||(o[3]=l=>O())},{default:d(()=>[j(h(g(c)("cancel")),1)]),_:1})])])])}}});export{rt as default};
