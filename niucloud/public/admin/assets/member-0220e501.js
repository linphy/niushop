import{d as te,bd as ae,M as se,r as m,l as I,f as le,as as oe,ag as ne,P as E,k as l,h as v,c as y,e as i,w as r,a as s,t as p,J as h,a9 as b,u as o,i as u,z as ie,B as P,n as B,m as re,F as pe,O as de,aw as ce,D as me,E as ue,G as _e,H as fe,C as ve,a4 as xe,V as we,K as ge}from"./index-785a2eda.js";/* empty css                *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                  *//* empty css                 */import{k as ye,f as he,h as be}from"./diy-58f535b0.js";import{b as De}from"./browser-a1ac24ac.js";import{_ as ke}from"./_plugin-vue_export-helper-c27b6911.js";const Ce={class:"main-container"},Ie={key:0,class:"flex flex-wrap min-w-[1200px]"},Ee={class:"page-item relative w-[340px] mr-[40px] pt-[90px] pb-[20px] bg-[#f7f7f7] bg-no-repeat"},Pe={class:"absolute top-[54px] left-[50%] translate-x-[-50%] w-[130px] text-[14px] truncate text-center"},Te={class:"w-[320px] h-[550px] mx-auto"},Ue=["id","src"],Ve={class:"w-[320px] h-[550px] mx-auto bg-body pt-[20px] px-[20px]"},Se={class:"font-bold text-xl mb-[40px]"},$e={class:"mb-[20px] flex flex-col"},Le={class:"mb-[10px]"},Oe={class:"flex"},Re={class:"overflow-hidden w-[320px] h-[550px] mx-auto"},Be=["src"],Me={class:"w-[700px]"},Ne={class:"flex flex-wrap"},Fe={class:"info-wrap"},Je={class:"mt-[20px] p-[20px] flex items-center justify-between bg"},je={class:"font-bold"},qe={class:"text-[#999] text-base"},ze={class:"text-center"},Ae={class:"flex items-start"},He={class:"flex flex-wrap"},Ge=["onClick"],Ke={class:"dialog-footer"},Qe=te({__name:"member",setup(We){const D=ae(),M=se(()=>D==null?void 0:D.apps),x=m("DIY_MEMBER_INDEX"),e=I({}),T=le(),w=m(""),U=m(""),d=m({name:""}),_=I({type:"",name:"",page:"",title:"",action:""}),g=m(!1),V=I({});ye({type:"member_index"}).then(a=>{for(const t in a.data)V[t]=a.data[t]});const S=()=>{he({type:x.value}).then(a=>{for(const t in a.data)e[t]=a.data[t];d.value.name=e.use_template.name,d.value.title=e.use_template.title,d.value.page=e.use_template.page,d.value.action=e.use_template.action,e.use_template.url&&(e.loadingIframe=!1,e.loadingDev=!1,e.isDisabledPop=!1,e.difference=0,w.value=e.domain_url.wap_domain,e.wapUrl=e.domain_url.wap_url,O())})};S();const $=m(!1);window.addEventListener("message",a=>{try{let t={type:""};if(typeof a.data=="string"?t=JSON.parse(a.data):typeof a.data=="object"&&(t=a.data),t.type&&["appOnLaunch","appOnReady"].indexOf(t.type)!=-1){e.loadingDev=!1,e.loadingIframe=!0;let f=new Date().getTime();e.difference=f-e.timeIframe,e.isDisabledPop=!1,$.value=!0}}catch(t){L(),console.log("diy member 后台接受数据错误",t)}},!1);const N=()=>{const a=JSON.stringify({type:"appOnReady",message:"加载完成"});window["previewIframe_"+x.value]&&window["previewIframe_"+x.value].contentWindow.postMessage(a,"*")},L=()=>{e.loadingDev=!0,e.isDisabledPop=!0,e.loadingIframe=!1},F=()=>{if(w.value.trim().length==0){E({type:"warning",message:`${l("wapDomainPlaceholder")}`});return}const a=w.value+"/wap";ce.set({key:"wap_domain",data:a}),e.use_template.url&&(e.wapUrl=a,O()),setTimeout(()=>{e.use_template.url&&(e.loadingIframe=!0,e.loadingDev=!1,e.isDisabledPop=!1)},100*3)},J=()=>{window.open("https://www.kancloud.cn/niucloud/niucloud-admin-develop/3213393")},O=()=>{e.use_template.wapPreview=e.wapUrl+e.use_template.url,e.shareUrl=e.wapUrl+e.page,De.toDataURL(e.shareUrl,{errorCorrectionLevel:"L",margin:0,width:100}).then(c=>{U.value=c});const a=()=>{e.timeIframe=new Date().getTime(),N()};a();let t=0,f=setInterval(()=>{if($.value||t>=50){clearInterval(f);return}a(),t++},200);setTimeout(()=>{e.difference==0&&L()},1e3*10)},j=()=>{const a={back:"/admin/diy/member"};e.use_template.id?a.id=e.use_template.id:e.use_template.type?a.name=e.use_template.type:e.use_template.url&&(a.url=e.use_template.url);const t=T.resolve({path:"/decorate/edit",query:a});window.open(t.href)},q=()=>{let a=e.use_template.page;e.use_template.url?a=e.use_template.url:e.use_template.id&&(a+="?id="+e.use_template.id);const t=T.resolve({path:"/preview/wap",query:{page:a}});window.open(t.href)},z=(a,t)=>{d.value.name=a,d.value.page=t.page,d.value.title=t.title,d.value.action=t.action},k=m(!1),A=()=>{_.type=x.value,_.name=d.value.name,_.page=d.value.page,_.title=d.value.title,_.action=d.value.action,!k.value&&(k.value=!0,be({..._}).then(a=>{k.value=!1,g.value=!1,S()}))},{copy:H,isSupported:G,copied:R}=oe(),K=a=>{G.value||E({message:l("notSupportCopy"),type:"warning"}),H(a)};return ne(R,()=>{R.value&&E({message:l("copySuccess"),type:"success"})}),(a,t)=>{const f=me,c=ue,Q=_e,W=fe,X=ve,Y=xe,Z=we,ee=ge;return v(),y("div",Ce,[i(ee,{class:"box-card !border-none",shadow:"never"},{default:r(()=>[e.use_template?(v(),y("div",Ie,[s("div",Ee,[s("p",Pe,p(e.use_template.title),1),h(s("div",Te,[h(s("iframe",{id:"previewIframe_"+x.value,class:"w-[320px] h-[550px] mx-auto",src:e.use_template.wapPreview,frameborder:"0"},null,8,Ue),[[b,e.loadingIframe]]),h(s("div",Ve,[s("div",Se,p(o(l)("developTitle")),1),s("div",$e,[s("text",Le,p(o(l)("wapDomain")),1),i(f,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=n=>w.value=n),modelModifiers:{trim:!0},placeholder:o(l)("wapDomainPlaceholder"),clearable:""},null,8,["modelValue","placeholder"])]),s("div",Oe,[i(c,{type:"primary",onClick:t[1]||(t[1]=n=>F())},{default:r(()=>[u(p(o(l)("confirm")),1)]),_:1}),i(c,{type:"primary",onClick:t[2]||(t[2]=n=>J()),plain:""},{default:r(()=>[u(p(o(l)("settingTips")),1)]),_:1})])],512),[[b,e.loadingDev]])],512),[[b,e.use_template.url]]),h(s("div",Re,[e.use_template.cover?(v(),y("img",{key:0,class:"max-w-full",src:o(ie)(e.use_template.cover)},null,8,Be)):P("",!0)],512),[[b,!e.use_template.wapPreview]]),s("div",{class:B(["popup-wrap absolute inset-x-0 inset-y-0 select-none",{disabled:e.isDisabledPop}])},null,2)]),s("div",Me,[s("div",Ne,[o(M).length>1?(v(),re(c,{key:0,type:"primary",onClick:t[3]||(t[3]=n=>g.value=!0)},{default:r(()=>[u(p(o(l)("changePage")),1)]),_:1})):P("",!0),h(i(c,{type:"primary",onClick:t[4]||(t[4]=n=>j()),class:"ml-[12px]"},{default:r(()=>[u(p(o(l)("decorate")),1)]),_:1},512),[[b,e.use_template.action=="decorate"]])]),s("div",Fe,[s("div",Je,[s("div",null,[s("div",je,p(o(l)("H5")),1),i(W,{"label-width":"40px",class:"mt-[5px]"},{default:r(()=>[i(Q,{label:o(l)("link"),class:"mb-[5px]"},{default:r(()=>[i(f,{readonly:"",value:e.shareUrl,class:"!w-[400px]"},{append:r(()=>[i(c,{onClick:t[5]||(t[5]=n=>K(e.shareUrl)),class:"bg-primary copy"},{default:r(()=>[u(p(o(l)("copy")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),s("div",qe,p(o(l)("scanQRCodeOnRight")),1)]),s("div",ze,[i(X,{class:"w-[100px] h-[100px] mb-[5px]",src:U.value},null,8,["src"]),s("div",{onClick:t[6]||(t[6]=n=>q()),class:"text-primary text-base cursor-pointer"},p(o(l)("preview")),1)])])])])])):P("",!0),i(Z,{modelValue:g.value,"onUpdate:modelValue":t[9]||(t[9]=n=>g.value=n),title:o(l)("pageSelectTips"),width:"400px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:r(()=>[s("span",Ke,[i(c,{onClick:t[7]||(t[7]=n=>g.value=!1)},{default:r(()=>[u(p(o(l)("cancel")),1)]),_:1}),i(c,{type:"primary",onClick:t[8]||(t[8]=n=>A())},{default:r(()=>[u(p(o(l)("confirm")),1)]),_:1})])]),default:r(()=>[s("div",Ae,[i(Y,{class:"pl-4 h-[300px] flex-1"},{default:r(()=>[s("div",He,[(v(!0),y(pe,null,de(V,(n,C)=>(v(),y("div",{key:C,class:B(["border border-br rounded-[3px] mr-[10px] mb-[10px] px-4 h-[32px] leading-[32px] cursor-pointer hover:bg-primary-light-9 px-[10px] hover:text-primary",[C==d.value.name?"border-primary text-primary":""]]),onClick:Xe=>z(C,n)},p(n.title),11,Ge))),128))])]),_:1})])]),_:1},8,["modelValue","title"])]),_:1})])}}});const mt=ke(Qe,[["__scopeId","data-v-19a15139"]]);export{mt as default};
