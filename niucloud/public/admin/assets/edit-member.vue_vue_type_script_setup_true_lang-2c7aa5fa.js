import{d as j,r as s,k as o,M as G,l as H,h as m,m as i,w as u,a as T,e as d,i as B,t as E,u as r,J,B as _,c as k,F as L,O as w,al as q,G as z,D as K,bh as Q,_ as W,ac as X,H as Z,E as ee,V as le,L as ae}from"./index-ac08d87d.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                       */import"./el-form-item-4ed993c7.js";import te from"./index-7d504251.js";import{a as oe,g as re,E as me}from"./member-2ca9b544.js";import{T as ue}from"./test-71dfb9c1.js";const ne={key:5},se={class:"text-sm text-gray-400"},ie={class:"dialog-footer"},Pe=j({__name:"edit-member",emits:["complete"],setup(de,{expose:C,emit:N}){const t=s(""),M=s(""),F=s(""),f=s(!1),c=s(!1),y=s(!1),x=s(null),A=s([{id:0,name:o("secrecySex")},{id:1,name:o("manSex")},{id:2,name:o("girlSex")}]),h=s(null);(async()=>{h.value=await(await re()).data})();const U=s([]);oe().then(({data:p})=>{U.value=p});const Y=G(()=>({member_level:[{validator:(p,e,v)=>{ue.empty(a.member_level)&&v(o("memberLevelPlaceholder")),v()}}]})),a=H({...{headimg:"",nickname:"",member_label:"",member_level:"",sex:"",birthday:""}}),I=async p=>{var e;await((e=x.value)==null?void 0:e.validate(v=>{if(v){if(c.value=!0,y.value)return;y.value=!0;let n=a[t.value];t.value=="member_label"&&(n=a[t.value]&&a[t.value].length?q(a[t.value]).join(",").split(","):"");const b=s({member_id:F.value,field:t.value,value:n});me(b.value).then(S=>{c.value=!1,y.value=!1,f.value=!1,N("complete")}).catch(()=>{c.value=!1,y.value=!1})}}))};return C({showDialog:f,setDialogType:async(p=null)=>{c.value=!0,t.value=p.type,M.value=p.title,F.value=p.id,a[t.value]=p.data[t.value],t.value=="member_label"&&a[t.value]&&a[t.value].forEach((e,v)=>{let n=!1;for(let b=0;b<h.value.length;b++)if(h.value[b].label_id==e){n=!0;break}n?a[t.value][v]=Number.parseFloat(e):a[t.value].splice(v,1)}),c.value=!1}}),(p,e)=>{const v=te,n=z,b=K,S=Q,V=W,D=X,R=Z,P=ee,O=le,$=ae;return m(),i(O,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=l=>f.value=l),title:M.value||r(o)("updateMember"),width:"500px","destroy-on-close":!0},{footer:u(()=>[T("span",ie,[d(P,{onClick:e[6]||(e[6]=l=>f.value=!1)},{default:u(()=>[B(E(r(o)("cancel")),1)]),_:1}),d(P,{type:"primary",loading:c.value,onClick:e[7]||(e[7]=l=>I(x.value))},{default:u(()=>[B(E(r(o)("confirm")),1)]),_:1},8,["loading"])])]),default:u(()=>[J((m(),i(R,{model:a,"label-width":"90px",rules:r(Y),ref_key:"formRef",ref:x,class:"page-form"},{default:u(()=>[t.value=="headimg"?(m(),i(n,{key:0,label:r(o)("headimg")},{default:u(()=>[d(v,{modelValue:a.headimg,"onUpdate:modelValue":e[0]||(e[0]=l=>a.headimg=l)},null,8,["modelValue"])]),_:1},8,["label"])):_("",!0),t.value=="nickname"?(m(),i(n,{key:1,label:r(o)("nickname")},{default:u(()=>[d(b,{modelValue:a.nickname,"onUpdate:modelValue":e[1]||(e[1]=l=>a.nickname=l),modelModifiers:{trim:!0},clearable:"",placeholder:r(o)("nickNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):_("",!0),t.value=="birthday"?(m(),i(n,{key:2,label:r(o)("birthday")},{default:u(()=>[d(S,{modelValue:a.birthday,"onUpdate:modelValue":e[2]||(e[2]=l=>a.birthday=l),"value-format":"YYYY-MM-DD",type:"date",placeholder:r(o)("birthdayTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):_("",!0),t.value=="sex"?(m(),i(n,{key:3,label:r(o)("sex")},{default:u(()=>[d(D,{modelValue:a.sex,"onUpdate:modelValue":e[3]||(e[3]=l=>a.sex=l),clearable:"",placeholder:r(o)("sexPlaceholder"),class:"input-width"},{default:u(()=>[(m(!0),k(L,null,w(A.value,(l,g)=>(m(),i(V,{label:l.name,value:l.id,key:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):_("",!0),t.value=="member_label"?(m(),i(n,{key:4,label:r(o)("memberLabel")},{default:u(()=>[d(D,{modelValue:a.member_label,"onUpdate:modelValue":e[4]||(e[4]=l=>a.member_label=l),multiple:"","collapse-tags":"",placeholder:r(o)("memberLabelPlaceholder"),class:"input-width"},{default:u(()=>[(m(!0),k(L,null,w(h.value,(l,g)=>(m(),i(V,{label:l.label_name,value:l.label_id,key:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):_("",!0),t.value=="member_level"?(m(),k("div",ne,[d(n,{label:r(o)("memberLevelUpdate"),prop:"member_level"},{default:u(()=>[d(D,{modelValue:a.member_level,"onUpdate:modelValue":e[5]||(e[5]=l=>a.member_level=l),placeholder:r(o)("memberLevelPlaceholder"),class:"input-width"},{default:u(()=>[d(V,{label:r(o)("memberLevelPlaceholder"),value:0},null,8,["label"]),(m(!0),k(L,null,w(U.value,(l,g)=>(m(),i(V,{label:l.level_name,value:l.level_id,key:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),T("div",se,E(r(o)("memberLevelUpdateTips")),1)]),_:1},8,["label"])])):_("",!0)]),_:1},8,["model","rules"])),[[$,c.value]])]),_:1},8,["modelValue","title"])}}});export{Pe as _};
