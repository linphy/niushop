import{_ as t}from"./u-icon.2852c2d9.js";import{A as e,B as s,C as a,q as o,t as i,i as n,j as r,w as u,k as l,F as h,P as c,R as d,Q as p,p as f,m,G as g,H as y,I as b,x as _}from"./index-b892d4e0.js";import{_ as w}from"./_plugin-vue_export-helper.1b428a4d.js";const x={methods:{getTouchPoint:t=>t?t.touches&&t.touches[0]?{x:t.touches[0].pageX,y:t.touches[0].pageY}:t.changedTouches&&t.changedTouches[0]?{x:t.changedTouches[0].pageX,y:t.changedTouches[0].pageY}:{x:t.clientX||0,y:t.clientY||0}:{x:0,y:0},resetTouchStatus(){this.direction="",this.deltaX=0,this.deltaY=0,this.offsetX=0,this.offsetY=0},touchStart(t){this.resetTouchStatus();const e=this.getTouchPoint(t);this.startX=e.x,this.startY=e.y},touchMove(t){const e=this.getTouchPoint(t);var s,a;this.deltaX=e.x-this.startX,this.deltaY=e.y-this.startY,this.offsetX=Math.abs(this.deltaX),this.offsetY=Math.abs(this.deltaY),this.direction=this.direction||(s=this.offsetX,a=this.offsetY,s>a&&s>10?"horizontal":a>s&&a>10?"vertical":"")}}},v={props:{show:{type:Boolean,default:e.swipeActionItem.show},name:{type:[String,Number],default:e.swipeActionItem.name},disabled:{type:Boolean,default:e.swipeActionItem.disabled},autoClose:{type:Boolean,default:e.swipeActionItem.autoClose},threshold:{type:Number,default:e.swipeActionItem.threshold},options:{type:Array,default:()=>uni.$u.props.swipeActionItem.rightOptions},duration:{type:[String,Number],default:e.swipeActionItem.duration}}};function S(t){return t.toString().indexOf("s")>=0?t:t>30?t+"ms":t+"s"}function C(t,e,s){e.getState(),s.selectAllComponents(".u-swipe-action-item__right__button"),e.requestAnimationFrame((function(){e.setStyle({transition:"none",transform:"translateX("+t+"px)","-webkit-transform":"translateX("+t+"px)"})}))}function X(t,e){var s=t.getState();e.selectAllComponents(".u-swipe-action-item__right__button");var a=S(s.duration),o=-s.buttonsWidth;t.requestAnimationFrame((function(){t.setStyle({transition:"transform "+a,transform:"translateX("+o+"px)","-webkit-transform":"translateX("+o+"px)"})})),z("open",t,e)}function z(t,e,s){e.getState().status=t,s.callMethod("setState",t)}function k(t,e){var s=t.getState(),a=e.selectAllComponents(".u-swipe-action-item__right__button"),o=a.length,i=S(s.duration);t.requestAnimationFrame((function(){t.setStyle({transition:"transform "+i,transform:"translateX(0px)","-webkit-transform":"translateX(0px)"});for(var e=o-1;e>=0;e--)a[e].setStyle({transition:"transform "+i,transform:"translateX(0px)","-webkit-transform":"translateX(0px)"})})),z("close",t,e)}const A={touchstart:function(t,e){var s=t.instance.getState();if(!s.disabled){var a=t.touches;a&&a.length>1||(s.moving=!0,s.startX=a[0].pageX,s.startY=a[0].pageY,e.callMethod("closeOther"))}},touchmove:function(t,e){var s=t.instance,a=s.getState();if(!a.disabled&&a.moving){var o=t.touches,i=o[0].pageX,n=o[0].pageY,r=i-a.startX,u=n-a.startY,l=a.buttonsWidth;(Math.abs(r)>Math.abs(u)||Math.abs(r)>a.threshold)&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()),Math.abs(r)<Math.abs(u)||("open"===a.status?(r<0&&(r=0),r>l&&(r=l),C(-l+r,s,e)):(r>0&&(r=0),Math.abs(r)>l&&(r=-l),C(r,s,e)))}},touchend:function(t,e){var s=t.instance,a=s.getState();if(a.moving&&!a.disabled){var o=t.changedTouches?t.changedTouches[0]:{},i=o.pageX;o.pageY;var n=i-a.startX;if("open"===a.status){if(n<0)return;if(0===n)return k(s,e);Math.abs(n)<a.threshold?X(s,e):k(s,e)}else{if(n>0)return;Math.abs(n)<a.threshold?k(s,e):X(s,e)}}},sizeChange:function(t,e,s,a){var o=a.getState();if(o&&t){if(o.disabled=t.disabled,o.duration=t.duration,o.show=t.show,o.threshold=t.threshold,o.buttons=t.buttons,o.buttons)for(var i=o.buttons.length,n=0,r=t.buttons,u=0;u<i;u++)n+=r[u].width;o.buttonsWidth=n}},statusChange:function(t,e,s,a){var o=a.getState();o.disabled||("close"===t&&"open"===o.status?k(a,s):"open"===t&&"close"===o.status&&X(a,s))}},T=t=>{t.$wxs||(t.$wxs=[]),t.$wxs.push("wxs"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.wxs=A}})},Y={name:"u-swipe-action-item",emits:["click"],mixins:[s,a,v,x],mixins:[s,a,v,x,{methods:{closeHandler(){this.status="close"},setState(t){this.status=t},closeOther(){this.parent&&this.parent.closeOther(this)}}}],data:()=>({size:{},parentData:{autoClose:!0},status:"close"}),watch:{wxsInit(t,e){this.queryRect()}},computed:{wxsInit(){return[this.disabled,this.autoClose,this.threshold,this.options,this.duration]}},mounted(){this.init()},methods:{init(){this.updateParentData(),uni.$u.sleep().then((()=>{this.queryRect()}))},updateParentData(){this.getParentData("u-swipe-action")},queryRect(){this.$uGetRect(".u-swipe-action-item__right__button",!0).then((t=>{this.size={buttons:t,show:this.show,disabled:this.disabled,threshold:this.threshold,duration:this.duration}}))},buttonClickHandler(t,e){this.$emit("click",{index:e,name:this.name})}}};T(Y);const M=w(Y,[["render",function(e,s,a,w,x,v){const S=o(i("u-icon"),t),C=b,X=_;return n(),r(X,{class:"u-swipe-action-item",ref:"u-swipe-action-item"},{default:u((()=>[l(X,{class:"u-swipe-action-item__right"},{default:u((()=>[h(e.$slots,"button",{},(()=>[(n(!0),c(d,null,p(e.options,((t,s)=>(n(),r(X,{key:s,class:"u-swipe-action-item__right__button",ref_for:!0,ref:`u-swipe-action-item__right__button-${s}`,style:f([{alignItems:t.style&&t.style.borderRadius?"center":"stretch"}]),onClick:e=>v.buttonClickHandler(t,s)},{default:u((()=>[l(X,{class:"u-swipe-action-item__right__button__wrapper",style:f([{backgroundColor:t.style&&t.style.backgroundColor?t.style.backgroundColor:"#C7C6CD",borderRadius:t.style&&t.style.borderRadius?t.style.borderRadius:"0",padding:t.style&&t.style.borderRadius?"0":"0 15px"},t.style])},{default:u((()=>[t.icon?(n(),r(S,{key:0,name:t.icon,color:t.style&&t.style.color?t.style.color:"#ffffff",size:t.iconSize?e.$u.addUnit(t.iconSize):t.style&&t.style.fontSize?1.2*e.$u.getPx(t.style.fontSize):17,customStyle:{marginRight:t.text?"2px":0}},null,8,["name","color","size","customStyle"])):m("v-if",!0),t.text?(n(),r(C,{key:1,class:"u-swipe-action-item__right__button__wrapper__text u-line-1",style:f([{color:t.style&&t.style.color?t.style.color:"#ffffff",fontSize:t.style&&t.style.fontSize?t.style.fontSize:"16px",lineHeight:t.style&&t.style.fontSize?t.style.fontSize:"16px"}])},{default:u((()=>[g(y(t.text),1)])),_:2},1032,["style"])):m("v-if",!0)])),_:2},1032,["style"])])),_:2},1032,["style","onClick"])))),128))]),!0)])),_:3}),l(X,{class:"u-swipe-action-item__content",onTouchstart:e.wxs.touchstart,onTouchmove:e.wxs.touchmove,onTouchend:e.wxs.touchend,status:x.status,"change:status":e.wxs.statusChange,size:x.size,"change:size":e.wxs.sizeChange},{default:u((()=>[h(e.$slots,"default",{},void 0,!0)])),_:3},8,["onTouchstart","onTouchmove","onTouchend","status","change:status","size","change:size"])])),_:3},512)}],["__scopeId","data-v-19c3dfd5"]]);const $=w({name:"u-swipe-action",mixins:[s,a,{props:{autoClose:{type:Boolean,default:e.swipeAction.autoClose}}}],data:()=>({}),provide(){return{swipeAction:this}},computed:{parentData(){return[this.autoClose]}},watch:{parentData(){this.children.length&&this.children.map((t=>{"function"==typeof t.updateParentData&&t.updateParentData()}))}},created(){this.children=[]},methods:{closeOther(t){this.autoClose&&this.children.map(((e,s)=>{t!==e&&e.closeHandler()}))}}},[["render",function(t,e,s,a,o,i){const l=_;return n(),r(l,{class:"u-swipe-action"},{default:u((()=>[h(t.$slots,"default")])),_:3})}]]);export{M as _,$ as a};
