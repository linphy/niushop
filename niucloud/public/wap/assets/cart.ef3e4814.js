import{A as t,B as e,C as s,q as i,t as o,i as n,j as u,w as a,E as l,F as r,D as d,p as c,k as h,m,x as p,a6 as g,b1 as b,bl as _,aS as f,_ as y,K as k}from"./index-616d13f7.js";import{_ as x}from"./u-icon.9fd6fcea.js";import{_ as S}from"./_plugin-vue_export-helper.1b428a4d.js";const B=S({name:"u-number-box",mixins:[e,s,{props:{name:{type:[String,Number],default:t.numberBox.name},modelValue:{type:[String,Number],default:t.numberBox.value},min:{type:[String,Number],default:t.numberBox.min},max:{type:[String,Number],default:t.numberBox.max},step:{type:[String,Number],default:t.numberBox.step},integer:{type:Boolean,default:t.numberBox.integer},disabled:{type:Boolean,default:t.numberBox.disabled},disabledInput:{type:Boolean,default:t.numberBox.disabledInput},asyncChange:{type:Boolean,default:t.numberBox.asyncChange},inputWidth:{type:[String,Number],default:t.numberBox.inputWidth},showMinus:{type:Boolean,default:t.numberBox.showMinus},showPlus:{type:Boolean,default:t.numberBox.showPlus},decimalLength:{type:[String,Number,null],default:t.numberBox.decimalLength},longPress:{type:Boolean,default:t.numberBox.longPress},color:{type:String,default:t.numberBox.color},buttonSize:{type:[String,Number],default:t.numberBox.buttonSize},bgColor:{type:String,default:t.numberBox.bgColor},cursorSpacing:{type:[String,Number],default:t.numberBox.cursorSpacing},disablePlus:{type:Boolean,default:t.numberBox.disablePlus},disableMinus:{type:Boolean,default:t.numberBox.disableMinus},iconStyle:{type:[Object,String],default:t.numberBox.iconStyle}}}],data:()=>({currentValue:"",longPressTimer:null}),watch:{watchChange(t){this.check()},modelValue(t){t!==this.currentValue&&(this.currentValue=this.format(this.modelValue))}},computed:{getCursorSpacing(){return uni.$u.getPx(this.cursorSpacing)},buttonStyle(){return t=>{const e={backgroundColor:this.bgColor,height:uni.$u.addUnit(this.buttonSize),color:this.color};return this.isDisabled(t)&&(e.backgroundColor="#f7f8fa"),e}},inputStyle(){this.disabled||this.disabledInput;return{color:this.color,backgroundColor:this.bgColor,height:uni.$u.addUnit(this.buttonSize),width:uni.$u.addUnit(this.inputWidth)}},watchChange(){return[this.integer,this.decimalLength,this.min,this.max]},isDisabled(){return t=>"plus"===t?this.disabled||this.disablePlus||this.currentValue>=this.max:this.disabled||this.disableMinus||this.currentValue<=this.min}},mounted(){this.init()},emits:["update:modelValue","focus","blur","overlimit","change","plus","minus"],methods:{init(){this.currentValue=this.format(this.modelValue)},format(t){return t=""===(t=this.filter(t))?0:+t,t=Math.max(Math.min(this.max,t),this.min),null!==this.decimalLength&&(t=t.toFixed(this.decimalLength)),t},filter(t){return t=String(t).replace(/[^0-9.-]/g,""),this.integer&&-1!==t.indexOf(".")&&(t=t.split(".")[0]),t},check(){const t=this.format(this.currentValue);t!==this.currentValue&&(this.currentValue=t)},onFocus(t){this.$emit("focus",{...t.detail,name:this.name})},onBlur(t){this.format(t.detail.value),this.$emit("blur",{...t.detail,name:this.name})},onInput(t){const{value:e=""}=t.detail||{};if(""===e)return;let s=this.filter(e);if(null!==this.decimalLength&&-1!==s.indexOf(".")){const t=s.split(".");s=`${t[0]}.${t[1].slice(0,this.decimalLength)}`}s=this.format(s),this.emitChange(s)},emitChange(t){this.asyncChange||this.$nextTick((()=>{this.$emit("update:modelValue",t),this.currentValue=t,this.$forceUpdate()})),this.$emit("change",{value:t,name:this.name})},onChange(){const{type:t}=this;if(this.isDisabled(t))return this.$emit("overlimit",t);const e="minus"===t?-this.step:+this.step,s=this.format(this.add(+this.currentValue,e));this.emitChange(s),this.$emit(t)},add(t,e){const s=Math.pow(10,10);return Math.round((t+e)*s)/s},clickHandler(t){this.type=t,this.onChange()},longPressStep(){this.clearTimeout(),this.longPressTimer=setTimeout((()=>{this.onChange(),this.longPressStep()}),250)},onTouchStart(t){this.longPress&&(this.clearTimeout(),this.type=t,this.longPressTimer=setTimeout((()=>{this.onChange(),this.longPressStep()}),600))},onTouchEnd(){this.longPress&&this.clearTimeout()},clearTimeout(){clearTimeout(this.longPressTimer),this.longPressTimer=null}}},[["render",function(t,e,s,b,_,f){const y=p,k=i(o("u-icon"),x),S=g;return n(),u(y,{class:"u-number-box"},{default:a((()=>[t.showMinus&&t.$slots.minus?(n(),u(y,{key:0,class:"u-number-box__slot",onClick:e[0]||(e[0]=l((t=>f.clickHandler("minus")),["stop"])),onTouchstart:e[1]||(e[1]=t=>f.onTouchStart("minus")),onTouchend:l(f.clearTimeout,["stop"])},{default:a((()=>[r(t.$slots,"minus",{},void 0,!0)])),_:3},8,["onTouchend"])):t.showMinus?(n(),u(y,{key:1,class:d(["u-number-box__minus",{"u-number-box__minus--disabled":f.isDisabled("minus")}]),onClick:e[2]||(e[2]=l((t=>f.clickHandler("minus")),["stop"])),onTouchstart:e[3]||(e[3]=t=>f.onTouchStart("minus")),onTouchend:l(f.clearTimeout,["stop"]),"hover-class":"u-number-box__minus--hover","hover-stay-time":"150",style:c([f.buttonStyle("minus")])},{default:a((()=>[h(k,{name:"minus",color:f.isDisabled("minus")?"#c8c9cc":"#323233",size:"15",bold:"",customStyle:t.iconStyle},null,8,["color","customStyle"])])),_:1},8,["onTouchend","class","style"])):m("v-if",!0),r(t.$slots,"input",{},(()=>[h(S,{disabled:t.disabledInput||t.disabled,"cursor-spacing":f.getCursorSpacing,class:d([{"u-number-box__input--disabled":t.disabled||t.disabledInput},"u-number-box__input"]),modelValue:_.currentValue,"onUpdate:modelValue":e[4]||(e[4]=t=>_.currentValue=t),onBlur:f.onBlur,onFocus:f.onFocus,onInput:f.onInput,type:"number",style:c([f.inputStyle])},null,8,["disabled","cursor-spacing","class","modelValue","onBlur","onFocus","onInput","style"])]),!0),t.showPlus&&t.$slots.plus?(n(),u(y,{key:2,class:"u-number-box__slot",onClick:e[5]||(e[5]=l((t=>f.clickHandler("plus")),["stop"])),onTouchstart:e[6]||(e[6]=t=>f.onTouchStart("plus")),onTouchend:l(f.clearTimeout,["stop"])},{default:a((()=>[r(t.$slots,"plus",{},void 0,!0)])),_:3},8,["onTouchend"])):t.showPlus?(n(),u(y,{key:3,class:d(["u-number-box__plus",{"u-number-box__minus--disabled":f.isDisabled("plus")}]),onClick:e[7]||(e[7]=l((t=>f.clickHandler("plus")),["stop"])),onTouchstart:e[8]||(e[8]=t=>f.onTouchStart("plus")),onTouchend:l(f.clearTimeout,["stop"]),"hover-class":"u-number-box__plus--hover","hover-stay-time":"150",style:c([f.buttonStyle("plus")])},{default:a((()=>[h(k,{name:"plus",color:f.isDisabled("plus")?"#c8c9cc":"#323233",size:"15",bold:"",customStyle:t.iconStyle},null,8,["color","customStyle"])])),_:1},8,["onTouchend","class","style"])):m("v-if",!0)])),_:3})}],["__scopeId","data-v-07801ec5"]]);function T(t){return b.post("shop/cart",t)}function L(t){return b.put("shop/cart",t)}function C(t){return b.put("shop/cart/delete",t)}function V(t){return b.get("shop/cart/goods",t)}const P=_("cart",{state:()=>({cartList:{},totalNum:0,totalMoney:0,isRepeat:!1}),actions:{getList(){var t;f()&&b.get("shop/cart",t).then((t=>{let e=t.data;for(let s in this.cartList)delete this.cartList[s];e&&e.forEach((t=>{if(1==t.goods.status&&0==t.goods.delete_time){let e={id:t.id,goods_id:t.goods_id,sku_id:t.sku_id,stock:t.goodsSku.stock,num:t.num,sale_price:t.goodsSku.sale_price};this.cartList["goods_"+e.goods_id]||(this.cartList["goods_"+e.goods_id]={}),this.cartList["goods_"+e.goods_id]["sku_"+e.sku_id]=e}})),this.calculateNum()}))},increase(t,e=1,s=null){if(!t||t&&0==Object.keys(t).length||!t.goods_id||!t.sku_id)return;if(!f())return;let i=(t.num||0)+e,o=t.id?L:T;i>parseInt(t.stock)?y({title:k("商品库存不足"),icon:"none"}):this.isRepeat||(this.isRepeat=!0,t.id?this.cartList["goods_"+t.goods_id]["sku_"+t.sku_id].num=i:(this.cartList["goods_"+t.goods_id]||(this.cartList["goods_"+t.goods_id]={}),this.cartList["goods_"+t.goods_id]["sku_"+t.sku_id]={id:t.id,goods_id:t.goods_id,sku_id:t.sku_id,stock:t.stock,num:i,sale_price:t.sale_price}),this.calculateNum(),o({id:t.id,goods_id:t.goods_id,sku_id:t.sku_id,num:i}).then((t=>{"function"==typeof s&&s(),this.getList(),this.isRepeat=!1})).catch((t=>{this.isRepeat=!1})))},reduce(t,e=1){if(!t||t&&0==Object.keys(t).length||!t.goods_id||!t.sku_id)return;if(!f())return;let s=(t.num||0)-1,i=s>0?L:C;this.isRepeat||(this.isRepeat=!0,s>0?this.cartList["goods_"+t.goods_id]["sku_"+t.sku_id].num=s:(delete this.cartList["goods_"+t.goods_id]["sku_"+t.sku_id],0==Object.keys(this.cartList["goods_"+t.goods_id]).length&&delete this.cartList["goods_"+t.goods_id]),this.calculateNum(),i({ids:t.id,id:t.id,goods_id:t.goods_id,sku_id:t.sku_id,num:s}).then((t=>{this.getList(),this.isRepeat=!1})).catch((t=>{this.isRepeat=!1})))},delete(t,e=null){t&&C({ids:t}).then((t=>{this.getList(),this.isRepeat=!1,e&&e()})).catch((t=>{this.isRepeat=!1}))},calculateNum(){if(this.totalNum=0,this.totalMoney=0,Object.keys(this.cartList).length)for(let t in this.cartList){let e=0,s=0;for(let i in this.cartList[t])"object"==typeof this.cartList[t][i]&&(e+=this.cartList[t][i].num,s+=this.cartList[t][i].num*this.cartList[t][i].sale_price);this.cartList[t].totalNum=e,this.cartList[t].totalMoney=s.toFixed(2),this.totalNum+=e,this.totalMoney+=s}this.totalMoney=this.totalMoney.toFixed(2)}}});export{B as _,V as g,P as u};
