import{_ as e}from"./loading-page.vue_vue_type_script_setup_true_lang.670312d0.js";import{r as a,a9 as t,p as l,l as o,N as r,H as n,L as i,W as s,K as g,D as u,aa as d,Q as p,ab as c,ac as m,ad as f,d as v,a8 as b,o as x,c as _,w as y,b as S,u as h,e as j,v as k,f as B,n as w,T as C,ae as L,U as T,x as P,y as E,a as F,g as $,i as H,j as D,F as O,t as U,E as q}from"./index-7c3a221b.js";import{g as A}from"./diy_form.2c8e1e22.js";import{d as G}from"./index.d5b35b66.js";import"./mescroll-uni-option.6cb5caaa.js";/* empty css                                                                       */import{_ as N}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading-icon.2d721490.js";import"./u-transition.2636624c.js";import"./u-icon.55521b35.js";import"./u-avatar.3386fbb9.js";import"./u-popup.9cffd7ac.js";import"./u-parse.98d223e2.js";import"./top-tabbar.3104cdb6.js";import"./manifest.78cc7d9b.js";import"./u-checkbox-group.43373461.js";import"./u-datetime-picker.e7bc9307.js";import"./u-input.9b5ee2af.js";import"./u-upload.e2017f75.js";const I=N(v({__name:"diy_form",setup(v){const{setShare:N}=b(),I=function(e={}){const v=a(!0),b=t(),x=a(e.form_id||0);a(e.name||""),a("");const _=a(""),y=l({}),S=a(e.needLogin||!1),h=l({pageMode:"diy",title:"",global:{},value:[],status:0}),j=o((()=>"decorate"==b.mode?b:h)),k=a(!1),B=(e=null)=>{let a=s();_.value=a[a.length-1]?a[a.length-1].route:"";let t=[];if(uni.getStorageSync("diyPageBlank")&&(t=uni.getStorageSync("diyPageBlank")),!t.length||t.length&&-1==t.indexOf(_.value)?b.topFixedStatus="home":t.length&&-1!=t.indexOf(_.value)&&(b.topFixedStatus="diy"),"decorate"==b.mode)b.init();else{if(!x.value)return;if(S.value&&!g())return void u().setLoginBack({url:"/app/pages/index/diy_form",param:{form_id:x.value}});A({form_id:x.value}).then((a=>{if(Object.assign(y,a.data),h.status=a.data.status,y.value){h.pageMode=y.mode,h.title=y.title,b.id=y.form_id;let e=y.value,a=uni.getStorageSync("diyFormStorage_"+b.id);if(a){var t=new Date;let l=parseInt(t.getTime()/1e3);a.validTime>l?a.components&&a.components.forEach((a=>{for(let t=0;t<e.value.length;t++)if("diy_form"==e.value[t].componentType&&a.id==e.value[t].id){let l=d(a),o=d(l.field);delete l.field,delete o.required,delete o.unique,delete o.autofill,delete o.privacyProtection,Object.assign(e.value[t],l),Object.assign(e.value[t].field,o);break}})):uni.removeStorageSync("diyFormStorage_"+b.id)}b.value=e.value,h.global=e.global,h.value=e.value,h.value.forEach(((e,a)=>{e.isHidden?h.value.splice(a,1):(e.pageStyle="",("FormSubmit"!=e.componentName||"FormSubmit"==e.componentName&&"hover_screen_bottom"!=e.btnPosition)&&(e.pageStartBgColor&&(e.pageStartBgColor&&e.pageEndBgColor?e.pageStyle+=`background:linear-gradient(${e.pageGradientAngle},${e.pageStartBgColor},${e.pageEndBgColor});`:e.pageStyle+="background-color:"+e.pageStartBgColor+";"),e.margin&&(e.margin.top>0&&(e.pageStyle+="padding-top:"+2*e.margin.top+"rpx;"),e.pageStyle+="padding-bottom:"+2*e.margin.bottom+"rpx;",e.pageStyle+="padding-right:"+2*e.margin.both+"rpx;",e.pageStyle+="padding-left:"+2*e.margin.both+"rpx;")))})),k.value=h.value.some((e=>e&&e.position&&"top_fixed"==e.position)),p({title:h.title})}v.value=!1,e&&e(y)}))}};return{getLoading:()=>v.value,requestData:y,data:j.value,isShowTopTabbar:k,pageStyle:()=>{var e="";return j.value.global.pageStartBgColor&&(j.value.global.pageStartBgColor&&j.value.global.pageEndBgColor?e+=`background:linear-gradient(${j.value.global.pageGradientAngle},${j.value.global.pageStartBgColor},${j.value.global.pageEndBgColor});`:e+="background-color:"+j.value.global.pageStartBgColor+";"),j.value.global.bottomTabBarSwitch?e+="min-height:calc(100vh - 50px);":e+="min-height:calc(100vh);",j.value.global.bgUrl&&(e+=`background-image:url('${r(j.value.global.bgUrl)}');`),j.value.global.bgHeightScale&&(e+=`background-size: 100% ${j.value.global.bgHeightScale}%;`),e},onLoad:(e=null)=>{n((a=>{b.mode=a.mode||"","decorate"==b.mode&&(y.status=1,y.error=[],v.value=!1),x.value=a.form_id||"",B(e)}))},onShow:(e=null)=>{i((()=>{e&&e(y)}))},onHide:(e=null)=>{c((()=>{let a=[];uni.getStorageSync("diyPageBlank")&&(a=uni.getStorageSync("diyPageBlank")),a.length&&(a=Array.from(new Set(a)),a.forEach(((e,a,t)=>{e==_.value&&t.splice(a,1)}))),"diy"==b.topFixedStatus&&a.push(_.value),uni.setStorageSync("diyPageBlank",a),e&&e()}))},onUnload:()=>{m((()=>{}))},onPageScroll:()=>{f((e=>{e.scrollTop>0&&(b.scrollTop=e.scrollTop)}))},getData:B}}({needLogin:!0}),M=a(null);a(null);const z=o((()=>I.requestData)),K=()=>{F({url:"/app/pages/index/index",mode:"reLaunch"})};return I.onLoad((e=>{var a;let t=e.share?e.share:null;N(t),null==(a=M.value)||a.refresh()})),I.onShow((e=>{var a;let t=e.share?e.share:null;t&&N(t),null==(a=M.value)||a.refresh()})),I.onHide(),I.onUnload(),I.onPageScroll(),(a,t)=>{const l=$(H("loading-page"),e),o=D,r=q,n=O;return x(),_(o,{style:w(a.themeColor())},{default:y((()=>[S(l,{loading:h(I).getLoading()},null,8,["loading"]),j(S(o,null,{default:y((()=>[B(" 自定义模板渲染 "),S(o,{class:"diy-template-wrap bg-index",style:w(h(I).pageStyle())},{default:y((()=>[S(G,{ref_key:"diyGroupRef",ref:M,data:h(I).data},null,8,["data"])])),_:1},8,["style"])])),_:1},512),[[k,1==h(z).status&&h(z).error&&0===h(z).error.length&&!h(I).getLoading()]]),h(z).error&&h(z).error.length>0?(x(),_(o,{key:0,class:"w-screen h-screen flex flex-col"},{default:y((()=>[(x(!0),C(T,null,L(h(z).error.slice(0,1),((e,a)=>(x(),_(o,{class:"flex-1 flex flex-col items-center pt-[180rpx] px-[60rpx]",key:a},{default:y((()=>[S(r,{class:"nc-iconfont nc-icon-tanhaoV6mm text-[#ccc] mb-[30rpx] !text-[100rpx]"}),S(o,{class:"text-[38rpx] font-bold mt-3"},{default:y((()=>[P(E(e.title),1)])),_:2},1024),S(o,{class:"p-[30rpx] mt-10 w-full"},{default:y((()=>[S(o,{class:"flex w-full"},{default:y((()=>[S(o,{class:"w-[30%] text-[#999] text-left"},{default:y((()=>[P(E(e.type),1)])),_:2},1024),S(o,{class:"w-[70%] text-left"},{default:y((()=>[P(E(e.desc),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),S(o,{class:"pb-[260rpx]"},{default:y((()=>[S(n,{class:"w-[380rpx] !border-0 h-[80rpx] text-[28rpx] text-[#333] !bg-[#f2f2f2] flex-center font-500 rounded-[20rpx]",plain:!0,onClick:K},{default:y((()=>[P(E(h(U)("close")),1)])),_:1})])),_:1})])),_:1})):B("v-if",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-b3e116b2"]]);export{I as default};
