import{d as e,J as a,an as t,r as l,au as r,a as s,g as o,i as u,o as n,c as p,w as i,s as d,b as c,x as f,y as x,u as m,t as _,aj as v,T as y,U as g,ae as b,N as h,f as k,A as w,j,av as F,F as T,H as S,L as C,ab as I,ac as P,Q as R,R as B,n as O,K as z,D as E,E as H,z as L,M as U}from"./index-7c3a221b.js";import{_ as A}from"./u-avatar.3386fbb9.js";import{a as J,_ as M}from"./u--image.e6a0b443.js";import{_ as N}from"./u-icon.55521b35.js";import{_ as $}from"./u-popup.9cffd7ac.js";import{p as D,g as G}from"./pay.24c9cd41.js";import{_ as K}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as Q}from"./loading-page.vue_vue_type_script_setup_true_lang.670312d0.js";import{t as V}from"./topTabbar.7ca2ef58.js";import{g as q,_ as W}from"./message.vue_vue_type_script_setup_true_lang.ea7dfc70.js";import"./u-transition.2636624c.js";import"./u-loading-icon.2d721490.js";const X=K(e({__name:"pay",emits:["close","confirm"],setup(e,{expose:S,emit:C}){a()&&t.init();const I=l(!1),P=l(!1),R=l(null),B=l(""),O=()=>{var e,l,r,o;if(!uni.$u.test.isEmpty(B.value))return"friendspay"==B.value?(s({url:"/app/pages/friendspay/share",param:{id:null==(e=R.value)?void 0:e.trade_id,type:null==(l=R.value)?void 0:l.trade_type},mode:"redirectTo"}),!1):void(P.value||(P.value=!0,D({trade_type:null==(r=R.value)?void 0:r.trade_type,trade_id:null==(o=R.value)?void 0:o.trade_id,type:B.value,openid:uni.getStorageSync("openid")||""}).then((e=>{var l,r,o,u,n,p;switch(B.value){case"wechatpay":a()?(e.data.timestamp=e.data.timeStamp,delete e.data.timeStamp,t.pay({...e.data,success:()=>{E()},cancel:()=>{P.value=!1}})):(uni.setStorageSync("paymenting",{trade_type:null==(l=R.value)?void 0:l.trade_type,trade_id:null==(r=R.value)?void 0:r.trade_id}),location.href=e.data.h5_url);break;case"alipay":a()?s({url:"/app/pages/pay/browser",param:{trade_type:null==(o=R.value)?void 0:o.trade_type,trade_id:null==(u=R.value)?void 0:u.trade_id,alipay:encodeURIComponent(e.data.url)},mode:"redirectTo"}):(uni.setStorageSync("paymenting",{trade_type:null==(n=R.value)?void 0:n.trade_type,trade_id:null==(p=R.value)?void 0:p.trade_id}),location.href=e.data.url);break;default:if(e.data.url)return void s({url:e.data.url,param:e.data.param||{},mode:"redirectTo"});E()}})).catch((()=>{P.value=!1}))));w({title:_("pay.notHavePayType"),icon:"none"})};r("checkIsReturnAfterPayment",(()=>{const e=uni.getStorageSync("paymenting");uni.getStorageSync("paymenting")&&s({url:"/app/pages/pay/result",param:{trade_type:e.trade_type,trade_id:e.trade_id},mode:"redirectTo",success(){uni.removeStorageSync("paymenting")}})}));const z=l(!1),E=()=>{var e,a;C("confirm"),s({url:"/app/pages/pay/result",param:{trade_type:null==(e=R.value)?void 0:e.trade_type,trade_id:null==(a=R.value)?void 0:a.trade_id},mode:"redirectTo"})},H=()=>{uni.removeStorageSync("paymenting"),I.value=!1,C("close")};return S({open:(e,a,t="",l="")=>{if(z.value)return;z.value=!0,uni.setStorageSync("payReturn",encodeURIComponent(t));const r={};l&&(r.scene=l),G(e,a,r).then((e=>{let{data:a}=e;R.value=a,uni.$u.test.isEmpty(a)?w({title:_("pay.notObtainedInfo"),icon:"none"}):0!=a.money?(B.value=a.pay_type_list[0]?a.pay_type_list[0].key:"",I.value=!0,z.value=!1):E()})).catch((()=>{z.value=!1}))}}),(e,a)=>{const t=j,l=o(u("u-image"),J),r=o(u("u-icon"),N),s=F,w=T,S=o(u("u-popup"),$);return n(),p(S,{show:I.value,round:10,onClose:H,closeable:!0,bgColor:"#fff",zIndex:"10081",closeOnClickOverlay:!1},{default:i((()=>[R.value?(n(),p(t,{key:0,class:"flex flex-col h-[65vh] popup-common",onTouchmove:a[0]||(a[0]=d((()=>{}),["prevent","stop"]))},{default:i((()=>[c(t,{class:"head"},{default:i((()=>[c(t,{class:"title"},{default:i((()=>[f(x(m(_)("pay.payTitle")),1)])),_:1}),c(t,{class:"flex items-end justify-center w-full text-xl font-bold py-[20rpx] price-font"},{default:i((()=>[c(t,{class:"text-base mr-[4rpx]"},{default:i((()=>[f(x(m(_)("currency")),1)])),_:1}),f(" "+x(m(v)(R.value.money)),1)])),_:1})])),_:1}),c(s,{"scroll-y":"true",class:"flex-1 pt-[20rpx]"},{default:i((()=>[c(t,{class:"flex text-[28rpx] px-[36rpx] py-[20rpx] mb-[10rpx]"},{default:i((()=>[c(t,{class:"text-[var(--text-color-light6)]"},{default:i((()=>[f(x(m(_)("pay.orderInfo")),1)])),_:1}),c(t,{class:"text-right flex-1 pl-[30rpx] truncate"},{default:i((()=>[f(x(R.value.body),1)])),_:1})])),_:1}),c(t,{class:"mx-[var(--popup-sidebar-m)] px-[30rpx] bg-white rounded-[20rpx] bg-[var(--temp-bg)]"},{default:i((()=>[R.value.pay_type_list.length?(n(!0),y(g,{key:0},b(R.value.pay_type_list,((e,a)=>(n(),p(t,{class:"pay-item py-[30rpx] flex items-center border-0 border-b border-solid border-[#eee]",key:a,onClick:a=>B.value=e.key},{default:i((()=>[c(l,{src:m(h)(e.icon),width:"50rpx",height:"50rpx"},null,8,["src"]),c(t,{class:"flex-1 px-[20rpx] text-[28rpx] font-500"},{default:i((()=>[f(x(e.name),1)])),_:2},1024),e.key==B.value?(n(),p(r,{key:0,name:"checkbox-mark",color:"var(--primary-color)"})):k("v-if",!0)])),_:2},1032,["onClick"])))),128)):(n(),p(t,{key:1,class:"py-[30rpx] text-center text-[24rpx] text-gray-subtitle"},{default:i((()=>[f(x(m(_)("pay.notHavePayType")),1)])),_:1}))])),_:1})])),_:1}),c(t,{class:"btn-wrap"},{default:i((()=>[c(w,{class:"primary-btn-bg btn","hover-class":"none",loading:P.value,onClick:O},{default:i((()=>[f(x(m(_)("pay.confirmPay")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):k("v-if",!0)])),_:1},8,["show"])}}}),[["__scopeId","data-v-a03fe042"]]),Y=K(e({__name:"money",setup(e){const a=V();a.setTopTabbarParam({title:""});const t=l(!0),r=l(0),d=l(""),v=l({}),w=l(!1),F=l(!0),J=l(null);S((e=>{r.value=e.id||0,d.value=e.type||""})),C((()=>{r.value&&d.value&&N(d.value,r.value)})),I((()=>{J.value&&(clearTimeout(J.value),J.value=null)})),P((()=>{J.value&&(clearTimeout(J.value),J.value=null)}));const N=(e,l)=>{F.value&&(t.value=!0,F.value=!1),q(e,l).then((r=>{v.value=r.data,R({title:v.value.config.pay_page_name}),a.setTopTabbarParam({title:v.value.config.pay_page_name}),t.value=!1,2!=v.value.status&&1!=v.value.status&&-1!=v.value.status?J.value=setTimeout((()=>{N(e,l)}),3e3):(clearTimeout(J.value),J.value=null)})).catch((()=>{J.value&&(clearTimeout(J.value),J.value=null),t.value=!1;B({title:"未找到帮付订单信息",url:"/app/pages/index/index",mode:"reLaunch"})}))},$=l(null),D=()=>{$.value.open(v.value.config)},G=l(),K=()=>{var e;z()?null==(e=G.value)||e.open(v.value.trade_type,v.value.trade_id,"/app/pages/index/index","friendspay"):E().setLoginBack({url:"/app/pages/friendspay/money",param:{id:v.value.trade_id,type:v.value.trade_type}})};return(e,a)=>{const l=o(u("u-avatar"),A),r=H,d=j,F=T,S=U,C=o(u("u--image"),M),I=o(u("pay"),X),P=o(u("loading-page"),Q);return n(),p(d,{style:O(e.themeColor())},{default:i((()=>[Object.keys(v.value).length&&!t.value?(n(),p(d,{key:0,class:"bg-[var(--page-bg-color)] min-h-screen overflow-hidden"},{default:i((()=>[c(d,{style:O({background:"url("+m(h)("static/resource/images/app/friendpay_money.png")+") left bottom / cover no-repeat"}),class:"pb-[194rpx] overflow-hidden"},{default:i((()=>[c(d,{class:"mt-[20rpx] flex flex-col items-center"},{default:i((()=>[c(l,{src:m(h)(v.value.member.headimg),size:"50",leftIcon:"none","default-url":m(h)("static/resource/images/default_headimg.png")},null,8,["src","default-url"]),c(d,{class:"flex items-center mt-[20rpx] text-[#fff] text-[26rpx] leading-[36rpx]"},{default:i((()=>[c(r,{class:"font-bold mr-[10rpx] max-w-[250rpx] truncate"},{default:i((()=>[f(x(v.value.member.nickname),1)])),_:1}),c(r,null,{default:i((()=>[f("请您帮忙付款~")])),_:1})])),_:1}),v.value.config.pay_leave_message?(n(),p(d,{key:0,class:"message bg-[#fe0708] relative max-w-[520rpx] px-[20rpx] py-[12rpx] rounded-[12rpx] border-solid border-[1rpx] border-color text-[24rpx] text-[#fff] leading-[30rpx] box-border text-center mt-[20rpx] mx-[114rpx]"},{default:i((()=>[f(x(v.value.config.pay_leave_message),1)])),_:1})):k("v-if",!0)])),_:1})])),_:1},8,["style"]),c(d,{class:"-mt-[154rpx] card-template sidebar-margin mb-[var(--top-m)]"},{default:i((()=>[c(d,{class:"text-[24rpx] text-center mb-[10rpx]"},{default:i((()=>[f(x(m(_)("payMoney")),1)])),_:1}),c(d,{class:"text-center mb-[50rpx]"},{default:i((()=>[c(r,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:i((()=>[f("￥")])),_:1}),c(r,{class:"text-[56rpx] font-bold price-font text-[#FF4142]"},{default:i((()=>[f(x(parseFloat(v.value.money).toFixed(2).split(".")[0]),1)])),_:1}),c(r,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:i((()=>[f("."+x(parseFloat(v.value.money).toFixed(2).split(".")[1]),1)])),_:1})])),_:1}),c(d,{class:"px-[20rpx] box-border"},{default:i((()=>[2==v.value.status?(n(),p(F,{key:0,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:i((()=>[f(x(m(_)("finish")),1)])),_:1})):-1==v.value.status?(n(),p(F,{key:1,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:i((()=>[f(x(m(_)("close")),1)])),_:1})):(n(),p(F,{key:2,class:"botton-color !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none",loading:w.value,onClick:K},{default:i((()=>[f(x(v.value.config.pay_button_name?v.value.config.pay_button_name:m(_)("payGenerously")),1)])),_:1},8,["loading"]))])),_:1}),c(d,{class:"mt-[20rpx] flex items-baseline justify-center text-[var(--text-color-light9)]",onClick:a[0]||(a[0]=e=>m(s)({url:"/app/pages/index/index"}))},{default:i((()=>[c(r,{class:"text-[24rpx] mr-[6rpx]"},{default:i((()=>[f("返回首页")])),_:1})])),_:1})])),_:1}),v.value.config.pay_info_switch?(n(),p(d,{key:0,class:"card-template sidebar-margin mb-[var(--top-m)]"},{default:i((()=>["[]"!==JSON.stringify(v.value.trade_info)&&v.value.trade_info.item_list.length?(n(),y(g,{key:0},[c(d,{class:"flex justify-between items-center mb-[30rpx]"},{default:i((()=>[c(d,{class:"text-[30rpx] text-[#333] font-500"},{default:i((()=>[f(x(m(_)("helpPayInfo")),1)])),_:1}),v.value.config.pay_explain_switch?(n(),p(d,{key:0,class:"flex-shrink-0",onClick:D},{default:i((()=>[c(r,{class:"mr-[8rpx] text-[24rpx]"},{default:i((()=>[f(x(v.value.config.pay_explain_title),1)])),_:1}),c(r,{class:"nc-iconfont nc-icon-jichuxinxiV6xx text-[26rpx]"})])),_:1})):k("v-if",!0)])),_:1}),c(d,{class:"border-0 border-solid border-b-[1rpx] border-[#f6f6f6] mb-[20rpx]"},{default:i((()=>[(n(!0),y(g,null,b(v.value.trade_info.item_list,((e,a)=>(n(),p(d,{class:L(["flex justify-between",{" mb-[34rpx]":a+1!=v.value.trade_info.length}])},{default:i((()=>[c(d,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden flex-shrink-0"},{default:i((()=>[c(C,{class:"overflow-hidden",radius:"var(--goods-rounded-big)",width:"170rpx",height:"170rpx",src:m(h)(e.item_image?e.item_image:""),model:"aspectFill"},{error:i((()=>[c(S,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:m(h)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"])])),_:2},1024),c(d,{class:"ml-[20rpx] flex flex-1 flex-col justify-between"},{default:i((()=>[c(d,null,{default:i((()=>[c(d,{class:"text-[28rpx] using-hidden leading-[40rpx] text-[#333]"},{default:i((()=>[f(x(e.item_name),1)])),_:2},1024),e.item_sub_name?(n(),p(d,{key:0,class:"text-[24rpx] mt-[14rpx] text-[var(--text-color-light9)] using-hidden leading-[28rpx]"},{default:i((()=>[f(x(e.item_sub_name),1)])),_:2},1024)):k("v-if",!0)])),_:2},1024),c(d,{class:"flex justify-between items-baseline"},{default:i((()=>[c(d,{class:"price-font text-[#FF4142]"},{default:i((()=>[c(r,{class:"text-[24rpx]"},{default:i((()=>[f("￥")])),_:1}),c(r,{class:"text-[40rpx] font-500"},{default:i((()=>[f(x(parseFloat(e.item_price).toFixed(2).split(".")[0]),1)])),_:2},1024),c(r,{class:"text-[24rpx] font-500"},{default:i((()=>[f("."+x(parseFloat(e.item_price).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024),c(r,{class:"text-right text-[26rpx]"},{default:i((()=>[f("x"+x(e.item_num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),256))])),_:1}),c(d,{class:"text-[26rpx] text-right"},{default:i((()=>[f(x(v.value.trade_info.item_total),1)])),_:1})],64)):(n(),p(d,{key:1,class:"text-[28rpx] leading-[40rpx] text-[#333]"},{default:i((()=>[f(x(v.value.body),1)])),_:1}))])),_:1})):k("v-if",!0)])),_:1})):k("v-if",!0),k(" 帮付说明 "),c(W,{ref_key:"messageRef",ref:$},null,512),k(" 支付 "),c(I,{ref_key:"payRef",ref:G},null,512),c(P,{loading:t.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-906f180b"]]);export{Y as default};
