import{_ as e}from"./loading-page.vue_vue_type_script_setup_true_lang.3d71513d.js";import{r as a,a9 as t,p as l,l as o,N as r,H as n,L as i,W as s,K as g,D as u,aa as d,Q as p,ab as c,ac as m,ad as f,d as v,a8 as b,o as x,c as S,w as h,b as y,u as _,e as j,v as k,f as B,n as w,T as C,ae as L,U as T,x as P,y as E,a as F,g as $,i as H,j as D,F as O,t as U,E as q}from"./index-4dda66b6.js";import{g as A}from"./diy_form.1a9f0bb0.js";import{d as G}from"./index.efecf22a.js";import{_ as N}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading-icon.10016ae2.js";import"./u-transition.c22f21f6.js";import"./u-icon.252ff5e7.js";import"./u-avatar.cb24cfde.js";import"./u-popup.5542352e.js";import"./u-parse.fe048780.js";import"./top-tabbar.5c467bb0.js";import"./manifest.ed582bbb.js";import"./u-checkbox-group.56070d31.js";import"./u-datetime-picker.3d4a7cfb.js";import"./u-input.52123ca7.js";import"./u-upload.973449ee.js";const I=N(v({__name:"diy_form",setup(v){const{setShare:N}=b(),I=function(e={}){const v=a(!0),b=t(),x=a(e.form_id||0);a(e.name||""),a("");const S=a(""),h=l({}),y=a(e.needLogin||!1),_=l({pageMode:"diy",title:"",global:{},value:[],status:0}),j=o((()=>"decorate"==b.mode?b:_)),k=a(!1),B=(e=null)=>{let a=s();S.value=a[a.length-1]?a[a.length-1].route:"";let t=[];if(uni.getStorageSync("diyPageBlank")&&(t=uni.getStorageSync("diyPageBlank")),!t.length||t.length&&-1==t.indexOf(S.value)?b.topFixedStatus="home":t.length&&-1!=t.indexOf(S.value)&&(b.topFixedStatus="diy"),"decorate"==b.mode)b.init();else{if(!x.value)return;if(y.value&&!g())return void u().setLoginBack({url:"/app/pages/index/diy_form",param:{form_id:x.value}});A({form_id:x.value}).then((a=>{if(Object.assign(h,a.data),_.status=a.data.status,h.value){_.pageMode=h.mode,_.title=h.title,b.id=h.form_id;let e=h.value,a=uni.getStorageSync("diyFormStorage_"+b.id);if(a){var t=new Date;let l=parseInt(t.getTime()/1e3);a.validTime>l?a.components&&a.components.forEach((a=>{for(let t=0;t<e.value.length;t++)if("diy_form"==e.value[t].componentType&&a.id==e.value[t].id){let l=d(a),o=d(l.field);delete l.field,delete o.required,delete o.unique,delete o.autofill,delete o.privacyProtection,Object.assign(e.value[t],l),Object.assign(e.value[t].field,o);break}})):uni.removeStorageSync("diyFormStorage_"+b.id)}b.value=e.value,_.global=e.global,_.value=e.value,_.value.forEach(((e,a)=>{e.isHidden?_.value.splice(a,1):(e.pageStyle="",("FormSubmit"!=e.componentName||"FormSubmit"==e.componentName&&"hover_screen_bottom"!=e.btnPosition)&&(e.pageStartBgColor&&(e.pageStartBgColor&&e.pageEndBgColor?e.pageStyle+=`background:linear-gradient(${e.pageGradientAngle},${e.pageStartBgColor},${e.pageEndBgColor});`:e.pageStyle+="background-color:"+e.pageStartBgColor+";"),e.margin&&(e.margin.top>0&&(e.pageStyle+="padding-top:"+2*e.margin.top+"rpx;"),e.pageStyle+="padding-bottom:"+2*e.margin.bottom+"rpx;",e.pageStyle+="padding-right:"+2*e.margin.both+"rpx;",e.pageStyle+="padding-left:"+2*e.margin.both+"rpx;")))})),k.value=_.value.some((e=>e&&e.position&&"top_fixed"==e.position)),p({title:_.title})}v.value=!1,e&&e(h)}))}};return{getLoading:()=>v.value,requestData:h,data:j.value,isShowTopTabbar:k,pageStyle:()=>{var e="";return j.value.global.pageStartBgColor&&(j.value.global.pageStartBgColor&&j.value.global.pageEndBgColor?e+=`background:linear-gradient(${j.value.global.pageGradientAngle},${j.value.global.pageStartBgColor},${j.value.global.pageEndBgColor});`:e+="background-color:"+j.value.global.pageStartBgColor+";"),j.value.global.bottomTabBarSwitch?e+="min-height:calc(100vh - 50px);":e+="min-height:calc(100vh);",j.value.global.bgUrl&&(e+=`background-image:url('${r(j.value.global.bgUrl)}');`),j.value.global.bgHeightScale&&(e+=`background-size: 100% ${j.value.global.bgHeightScale}%;`),e},onLoad:(e=null)=>{n((a=>{b.mode=a.mode||"","decorate"==b.mode&&(h.status=1,h.error=[],v.value=!1),x.value=a.form_id||"",B(e)}))},onShow:(e=null)=>{i((()=>{e&&e(h)}))},onHide:(e=null)=>{c((()=>{let a=[];uni.getStorageSync("diyPageBlank")&&(a=uni.getStorageSync("diyPageBlank")),a.length&&(a=Array.from(new Set(a)),a.forEach(((e,a,t)=>{e==S.value&&t.splice(a,1)}))),"diy"==b.topFixedStatus&&a.push(S.value),uni.setStorageSync("diyPageBlank",a),e&&e()}))},onUnload:()=>{m((()=>{}))},onPageScroll:()=>{f((e=>{e.scrollTop>0&&(b.scrollTop=e.scrollTop)}))},getData:B}}({needLogin:!0}),M=a(null);a(null);const z=o((()=>I.requestData)),K=()=>{F({url:"/app/pages/index/index",mode:"reLaunch"})};return I.onLoad((e=>{var a;let t=e.share?e.share:null;N(t),null==(a=M.value)||a.refresh()})),I.onShow((e=>{var a;let t=e.share?e.share:null;t&&N(t),null==(a=M.value)||a.refresh()})),I.onHide(),I.onUnload(),I.onPageScroll(),(a,t)=>{const l=$(H("loading-page"),e),o=D,r=q,n=O;return x(),S(o,{style:w(a.themeColor())},{default:h((()=>[y(l,{loading:_(I).getLoading()},null,8,["loading"]),j(y(o,null,{default:h((()=>[B(" 自定义模板渲染 "),y(o,{class:"diy-template-wrap bg-index",style:w(_(I).pageStyle())},{default:h((()=>[y(G,{ref_key:"diyGroupRef",ref:M,data:_(I).data},null,8,["data"])])),_:1},8,["style"])])),_:1},512),[[k,1==_(z).status&&_(z).error&&0===_(z).error.length&&!_(I).getLoading()]]),_(z).error&&_(z).error.length>0?(x(),S(o,{key:0,class:"w-screen h-screen flex flex-col"},{default:h((()=>[(x(!0),C(T,null,L(_(z).error.slice(0,1),((e,a)=>(x(),S(o,{class:"flex-1 flex flex-col items-center pt-[180rpx] px-[60rpx]",key:a},{default:h((()=>[y(r,{class:"nc-iconfont nc-icon-tanhaoV6mm text-[#ccc] mb-[30rpx] !text-[100rpx]"}),y(o,{class:"text-[38rpx] font-bold mt-3"},{default:h((()=>[P(E(e.title),1)])),_:2},1024),y(o,{class:"p-[30rpx] mt-10 w-full"},{default:h((()=>[y(o,{class:"flex w-full"},{default:h((()=>[y(o,{class:"w-[30%] text-[#999] text-left"},{default:h((()=>[P(E(e.type),1)])),_:2},1024),y(o,{class:"w-[70%] text-left"},{default:h((()=>[P(E(e.desc),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),y(o,{class:"pb-[260rpx]"},{default:h((()=>[y(n,{class:"w-[380rpx] !border-0 h-[80rpx] text-[28rpx] text-[#333] !bg-[#f2f2f2] flex-center font-500 rounded-[20rpx]",plain:!0,onClick:K},{default:h((()=>[P(E(_(U)("close")),1)])),_:1})])),_:1})])),_:1})):B("v-if",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-c69fd243"]]);export{I as default};
