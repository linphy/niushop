import{d as e,r as a,o as t,T as l,f as s,b as r,w as o,s as u,n as i,c as n,u as p,x as d,U as f,ap as c,as as m,N as _,M as v,j as x,E as g,F as y,g as b,i as h,a8 as w,k,l as F,H as j,L as T,ab as P,ac as O,Q as S,at as U,R as C,y as I,ae as $,t as N,a as B}from"./index-4dda66b6.js";import{_ as D}from"./u-avatar.cb24cfde.js";import{_ as z}from"./u--image.bd56cc87.js";import{_ as J}from"./loading-page.vue_vue_type_script_setup_true_lang.3d71513d.js";import{g as R,_ as L}from"./message.vue_vue_type_script_setup_true_lang.12a32f41.js";import{t as M}from"./topTabbar.8c5d3fa7.js";import{_ as V}from"./u-popup.5542352e.js";import{_ as A}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.252ff5e7.js";import"./u-transition.c22f21f6.js";import"./u-loading-icon.10016ae2.js";const E=A(e({__name:"share-poster",props:{posterId:{type:String||Number,default:0},posterType:{type:String,default:""},posterParam:{type:Object,default:{}},copyUrl:{type:String,default:""},copyUrlParam:{type:String,default:""}},emits:["close"],setup(e,{expose:w,emit:k}){const F=e,j=a(!1),T=()=>{let e="";if(F.copyUrl){let a=location.pathname,t=["/app/","/addon/"];for(let e=0;e<t.length;e++)-1!=a.indexOf(t[e])&&(a=a.substr(0,a.indexOf(t[e])));e=location.origin+a+F.copyUrl+F.copyUrlParam}else e=location.origin+location.pathname+F.copyUrlParam;c(e,(()=>{j.value=!1}))},P=a(!1),O=a(!1),S=a(""),U=()=>{if(S.value)P.value=!1,O.value=!0;else{P.value=!0,O.value=!1;let e={id:F.posterId,type:F.posterType,param:F.posterParam},a=Date.parse(new Date);m(e).then((e=>{S.value=e.data&&_(e.data)||"";let t=Date.parse(new Date)-a;t<2200?setTimeout((()=>{P.value=!1,O.value=!0}),2200-t):(P.value=!1,O.value=!0)})).catch((()=>{N()}))}},C=a(!1),I=()=>{C.value=!1},$=a(0),N=()=>{j.value=!1,P.value=!1,O.value=!1,k("close")};return w({openShare:()=>{j.value=!0,U()},loadPoster:U}),(e,a)=>{const c=v,m=x,w=g,k=y,F=b(h("u-popup"),V);return t(),l(f,null,[s(" 分享弹窗 "),r(m,{onTouchmove:a[2]||(a[2]=u((()=>{}),["prevent","stop"])),class:"share-popup"},{default:o((()=>[r(F,{show:j.value,type:"bottom",onClose:N,overlayOpacity:"0.8"},{default:o((()=>[r(m,{onTouchmove:a[0]||(a[0]=u((()=>{}),["prevent","stop"]))},{default:o((()=>[r(m,{class:"poster-img-wrap",style:i({top:$.value})},{default:o((()=>[P.value?(t(),n(c,{key:0,class:"poster-animation",src:p(_)("addon/shop/poster_animation.gif"),mode:"aspectFit"},null,8,["src"])):s("v-if",!0),O.value?(t(),n(c,{key:1,class:"poster-img",src:p(_)(S.value),mode:"aspectFit","show-menu-by-longpress":!0},null,8,["src"])):s("v-if",!0)])),_:1},8,["style"]),r(m,{class:"share-content"},{default:o((()=>[r(m,{class:"share-box",onClick:T},{default:o((()=>[r(k,{class:"share-btn",plain:!0},{default:o((()=>[r(m,{class:"text-[#07c160] iconfont iconfuzhilianjie"}),r(w,null,{default:o((()=>[d("复制链接")])),_:1})])),_:1})])),_:1})])),_:1}),r(m,{class:"share-footer",onClick:N},{default:o((()=>[r(w,null,{default:o((()=>[d("取消分享")])),_:1})])),_:1})])),_:1})])),_:1},8,["show"]),r(F,{show:C.value,mode:"center",round:10,closeable:!0,onClose:a[1]||(a[1]=e=>C.value=!1),"safe-area-inset-bottom":!1},{default:o((()=>[r(m,{class:"dialog-popup"},{default:o((()=>[r(m,{class:"title"},{default:o((()=>[d("提示")])),_:1}),r(m,{class:"message"},{default:o((()=>[d("您拒绝了保存图片到相册的授权请求，无法保存图片到相册，如需正常使用，请授权之后再进行操作。")])),_:1}),r(m,{class:"action-wrap"},{default:o((()=>[r(m,{onClick:I},{default:o((()=>[d("取消")])),_:1}),r(m,null,{default:o((()=>[r(k,{type:"default",class:"authorization-btn","open-type":"openSetting",onOpensetting:I,"hover-class":"none"},{default:o((()=>[d("立即授权")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})],2112)}}}),[["__scopeId","data-v-19bbb4d7"]]),H=A(e({__name:"share",setup(e){const u=M();u.setTopTabbarParam({title:""});const c=a(!0),m=a(!1),V=a(0),A=a(""),H=a({}),Q=a(!0),q=a(null),{setShare:G}=w(),K=k(),W=F((()=>K.info));j((e=>{V.value=e.id||0,A.value=e.type||""})),T((()=>{V.value&&A.value&&X(A.value,V.value)})),P((()=>{q.value&&(clearTimeout(q.value),q.value=null)})),O((()=>{q.value&&(clearTimeout(q.value),q.value=null)}));const X=(e,a)=>{Q.value&&(c.value=!0,Q.value=!1),R(e,a).then((t=>{H.value=t.data,c.value=!1,S({title:H.value.config.pay_page_name}),u.setTopTabbarParam({title:H.value.config.pay_page_name});let l="",s=location.pathname,r=["/app/","/addon/"];for(let e=0;e<r.length;e++)-1!=s.indexOf(r[e])&&(s=s.substr(0,s.indexOf(r[e])));l=location.origin+s+`/app/pages/friendspay/money?id=${H.value.trade_id}&type=${H.value.trade_type}`;let o={desc:H.value.config.pay_leave_message,path:`/app/pages/friendspay/money?id=${H.value.trade_id}&type=${H.value.trade_type}`,link:l};if(H.value.member){let e=H.value.member.nickname;e=e.length>15?e=e.substring(0,15)+"...":e,o.title=`${e}希望你帮他付${H.value.money}元`}"[]"!==JSON.stringify(H.value.trade_info)&&H.value.trade_info.item_list.length?o.url=H.value.trade_info.item_list[0].item_image?H.value.trade_info.item_list[0].item_image:H.value.config.pay_wechat_share_image:o.url=H.value.config.pay_wechat_share_image,G({wechat:{...o},weapp:{...o}}),se(),U((()=>{setTimeout((()=>{ee.value&&(le.id=H.value.trade_id,le.type=H.value.trade_type,W.value&&W.value.member_id&&(le.member_id=W.value.member_id),ee.value.loadPoster())}),400)})),2!=H.value.status&&1!=H.value.status&&-1!=H.value.status?q.value=setTimeout((()=>{X(e,a)}),3e3):(clearTimeout(q.value),q.value=null)})).catch((e=>{q.value&&(clearTimeout(q.value),q.value=null),c.value=!1;C({title:"未找到帮付订单信息",url:"/app/pages/index/index",mode:"reLaunch"})}))},Y=a(null),Z=()=>{Y.value.open(H.value.config)},ee=a(null),ae=a("/app/pages/friendspay/money"),te=a("");let le={};const se=()=>{te.value="?id="+H.value.trade_id,te.value+="&type="+H.value.trade_type},re=()=>{le.id=H.value.trade_id,le.type=H.value.trade_type,W.value&&W.value.member_id&&(le.member_id=W.value.member_id),ee.value.openShare()};return(e,a)=>{const u=b(h("u-avatar"),D),w=g,k=x,F=y,j=v,T=b(h("u--image"),z),P=b(h("loading-page"),J);return t(),n(k,{style:i(e.themeColor())},{default:o((()=>[Object.keys(H.value).length&&!c.value?(t(),n(k,{key:0,class:"bg-[var(--page-bg-color)] min-h-screen overflow-hidden"},{default:o((()=>[r(k,{style:i({background:"url("+p(_)("static/resource/images/app/friendpay_bg.png")+") left bottom /100% no-repeat"}),class:"pb-[168rpx] overflow-hidden"},{default:o((()=>[r(k,{class:"mt-[20rpx] flex flex-col items-center"},{default:o((()=>[r(u,{src:p(_)(H.value.member.headimg),size:"50",leftIcon:"none","default-url":p(_)("static/resource/images/default_headimg.png")},null,8,["src","default-url"]),r(k,{class:"flex items-center mt-[20rpx] text-[#fff] text-[26rpx] leading-[36rpx]"},{default:o((()=>[r(w,{class:"font-bold mr-[10rpx] max-w-[250rpx] truncate"},{default:o((()=>[d(I(H.value.member.nickname),1)])),_:1}),r(w,null,{default:o((()=>[d("发起了订单帮付请求~")])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),r(k,{class:"mt-[-128rpx] card-template sidebar-margin mb-[var(--top-m)]"},{default:o((()=>[r(k,{class:"text-[24rpx] text-center text-[#333] mb-[10rpx]"},{default:o((()=>[d(I(p(N)("payMoney")),1)])),_:1}),r(k,{class:"text-center mb-[50rpx]"},{default:o((()=>[r(w,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:o((()=>[d("￥")])),_:1}),r(w,{class:"text-[56rpx] font-bold price-font text-[#FF4142]"},{default:o((()=>[d(I(parseFloat(H.value.money).toFixed(2).split(".")[0]),1)])),_:1}),r(w,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:o((()=>[d("."+I(parseFloat(H.value.money).toFixed(2).split(".")[1]),1)])),_:1})])),_:1}),r(k,{class:"px-[20rpx] box-border"},{default:o((()=>[2==H.value.status?(t(),n(F,{key:0,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:o((()=>[d(I(p(N)("finish")),1)])),_:1})):-1==H.value.status?(t(),n(F,{key:1,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:o((()=>[d(I(p(N)("close")),1)])),_:1})):(t(),n(F,{key:2,class:"botton-color !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none",loading:m.value,onClick:re},{default:o((()=>[d(I(H.value.config.pay_type_name?H.value.config.pay_type_name:p(N)("friendPay")),1)])),_:1},8,["loading"]))])),_:1}),2==H.value.status&&"[]"!==JSON.stringify(H.value.trade_info)&&H.value.trade_info.detail_url?(t(),n(k,{key:0,class:"mt-[20rpx] flex items-baseline justify-center text-[var(--text-color-light9)]",onClick:a[0]||(a[0]=e=>p(B)({url:H.value.trade_info.detail_url}))},{default:o((()=>[r(w,{class:"text-[24rpx] mr-[6rpx]"},{default:o((()=>[d("查看订单")])),_:1}),r(w,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx]"})])),_:1})):s("v-if",!0)])),_:1}),r(k,{class:"card-template sidebar-margin mb-[var(--top-m)]"},{default:o((()=>[r(k,{class:"flex justify-between items-center mb-[30rpx]"},{default:o((()=>[r(k,{class:"text-[30rpx] text-[#333] font-500"},{default:o((()=>[d(I(p(N)("friendPayOrderInfo")),1)])),_:1}),H.value.config.pay_explain_switch?(t(),n(k,{key:0,class:"text-[#666] leading-[1]",onClick:Z},{default:o((()=>[r(w,{class:"mr-[8rpx] text-[24rpx]"},{default:o((()=>[d(I(H.value.config.pay_explain_title),1)])),_:1}),r(w,{class:"nc-iconfont nc-icon-jichuxinxiV6xx text-[26rpx]"})])),_:1})):s("v-if",!0)])),_:1}),"[]"!==JSON.stringify(H.value.trade_info)?(t(),l(f,{key:0},[H.value.trade_info.item_list.length?(t(),l(f,{key:0},[r(k,{class:"border-0 border-solid border-b-[1rpx] border-[#f6f6f6] mb-[20rpx]"},{default:o((()=>[(t(!0),l(f,null,$(H.value.trade_info.item_list,((e,a)=>(t(),n(k,{class:"flex justify-between mb-[30rpx]"},{default:o((()=>[r(k,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden flex-shrink-0"},{default:o((()=>[r(T,{class:"overflow-hidden",radius:"var(--goods-rounded-big)",width:"170rpx",height:"170rpx",src:p(_)(e.item_image?e.item_image:""),model:"aspectFill"},{error:o((()=>[r(j,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:p(_)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"])])),_:2},1024),r(k,{class:"ml-[20rpx] flex flex-1 flex-col justify-between"},{default:o((()=>[r(k,null,{default:o((()=>[r(k,{class:"text-[28rpx] using-hidden leading-[40rpx] text-[#333]"},{default:o((()=>[d(I(e.item_name),1)])),_:2},1024),e.item_sub_name?(t(),n(k,{key:0,class:"text-[24rpx] mt-[14rpx] text-[var(--text-color-light9)] using-hidden leading-[28rpx]"},{default:o((()=>[d(I(e.item_sub_name),1)])),_:2},1024)):s("v-if",!0)])),_:2},1024),r(k,{class:"flex justify-between items-baseline"},{default:o((()=>[r(k,{class:"price-font text-[#FF4142]"},{default:o((()=>[r(w,{class:"text-[24rpx]"},{default:o((()=>[d("￥")])),_:1}),r(w,{class:"text-[40rpx] font-500"},{default:o((()=>[d(I(parseFloat(e.item_price).toFixed(2).split(".")[0]),1)])),_:2},1024),r(w,{class:"text-[24rpx] font-500"},{default:o((()=>[d("."+I(parseFloat(e.item_price).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024),r(w,{class:"text-right text-[26rpx]"},{default:o((()=>[d("x"+I(e.item_num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1}),r(k,{class:"text-[26rpx] text-right"},{default:o((()=>[d(I(H.value.trade_info.item_total),1)])),_:1})],64)):s("v-if",!0)],64)):(t(),n(k,{key:1,class:"text-[28rpx] leading-[40rpx] text-[#333]"},{default:o((()=>[d(I(H.value.body),1)])),_:1}))])),_:1}),r(E,{ref_key:"sharePosterRef",ref:ee,posterType:"friendspay",posterId:H.value.poster_id,posterParam:p(le),copyUrl:ae.value,copyUrlParam:te.value},null,8,["posterId","posterParam","copyUrl","copyUrlParam"]),s(" 帮付说明 "),r(L,{ref_key:"messageRef",ref:Y},null,512)])),_:1})):s("v-if",!0),r(P,{loading:c.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-f3557a58"]]);export{H as default};
