import{d as e,aD as a,r as t,bc as l,h as r,q as s,t as p,i as o,j as n,w as u,k as d,G as i,H as y,n as c,K as m,a2 as _,P as v,R as x,Q as f,y as g,m as h,_ as b,x as k,a7 as S}from"./index-616d13f7.js";import{_ as w}from"./u-image.37db3168.js";import{_ as j}from"./u-icon.9fd6fcea.js";import{_ as C}from"./u-button.0dc6d340.js";import{_ as I}from"./u-popup.0e0ff09c.js";import{p as T,g as P}from"./pay.f3bd4c74.js";import{w as R}from"./wechat.a9c418ff.js";import{_ as H}from"./_plugin-vue_export-helper.1b428a4d.js";const O=H(e({__name:"pay",emits:["close"],setup(e,{expose:H,emit:O}){a()&&R.init();const q=t(!1),z=t(!1),D=t(null),E=t(""),K=()=>{var e,t;uni.$u.test.isEmpty(E.value)?b({title:m("pay.notHavePayType"),icon:"none"}):z.value||(z.value=!0,T({trade_type:null==(e=D.value)?void 0:e.trade_type,trade_id:null==(t=D.value)?void 0:t.trade_id,type:E.value}).then((e=>{var t,l,s,p,o,n;switch(E.value){case"wechatpay":a()?(e.data.timestamp=e.data.timeStamp,delete e.data.timeStamp,R.pay({...e.data,success:()=>{Q()},cancel:()=>{z.value=!1}})):(uni.setStorageSync("paymenting",{trade_type:null==(t=D.value)?void 0:t.trade_type,trade_id:null==(l=D.value)?void 0:l.trade_id}),location.href=e.data.h5_url);break;case"alipay":a()?r({url:"/app/pages/pay/browser",param:{trade_type:null==(s=D.value)?void 0:s.trade_type,trade_id:null==(p=D.value)?void 0:p.trade_id,alipay:encodeURIComponent(e.data.url)},mode:"redirectTo"}):(uni.setStorageSync("paymenting",{trade_type:null==(o=D.value)?void 0:o.trade_type,trade_id:null==(n=D.value)?void 0:n.trade_id}),location.href=e.data.url);break;default:Q()}})).catch((()=>{z.value=!1})))};l("checkIsReturnAfterPayment",(()=>{const e=uni.getStorageSync("paymenting");uni.getStorageSync("paymenting")&&r({url:"/app/pages/pay/result",param:{trade_type:e.trade_type,trade_id:e.trade_id},mode:"redirectTo",success(){uni.removeStorageSync("paymenting")}})}));const Q=()=>{var e,a;r({url:"/app/pages/pay/result",param:{trade_type:null==(e=D.value)?void 0:e.trade_type,trade_id:null==(a=D.value)?void 0:a.trade_id},mode:"redirectTo"})},U=()=>{uni.removeStorageSync("paymenting"),q.value=!1,O("close")};return H({open:(e,a,t="")=>{uni.setStorageSync("payReturn",encodeURIComponent(t)),P(e,a).then((e=>{let{data:a}=e;D.value=a,uni.$u.test.isEmpty(a)?b({title:m("pay.notObtainedInfo"),icon:"none"}):0!=a.money?0==a.status?(E.value=a.pay_type_list[0]?a.pay_type_list[0].key:"",q.value=!0):b({title:m("pay.paymentDocuments")+a.status_name,icon:"none"}):Q()})).catch((()=>{}))}}),(e,a)=>{const t=k,l=s(p("u-image"),w),r=s(p("u-icon"),j),b=S,T=s(p("u-button"),C),P=s(p("u-popup"),I);return o(),n(P,{show:q.value,round:10,onClose:U,closeable:!0,bgColor:"#fff",zIndex:"10081",closeOnClickOverlay:!1},{default:u((()=>[D.value?(o(),n(t,{key:0,class:"flex flex-col h-[75vh]"},{default:u((()=>[d(t,{class:"head"},{default:u((()=>[d(t,{class:"text-center py-[26rpx]"},{default:u((()=>[i(y(c(m)("pay.payTitle")),1)])),_:1}),d(t,{class:"flex items-end justify-center w-full text-xl font-bold py-[20rpx]"},{default:u((()=>[d(t,{class:"text-base mr-[4rpx]"},{default:u((()=>[i(y(c(m)("currency")),1)])),_:1}),i(" "+y(c(_)(D.value.money)),1)])),_:1})])),_:1}),d(b,{"scroll-y":"true",class:"flex-1 pt-[20rpx]"},{default:u((()=>[d(t,{class:"flex text-sm px-[30rpx] py-[20rpx]"},{default:u((()=>[d(t,{class:"text-gray-500"},{default:u((()=>[i(y(c(m)("pay.orderInfo")),1)])),_:1}),d(t,{class:"text-right flex-1 pl-[30rpx] truncate"},{default:u((()=>[i(y(D.value.body),1)])),_:1})])),_:1}),d(t,{class:"mx-[30rpx] py-[10rpx] px-[30rpx] bg-white rounded-md bg-page"},{default:u((()=>[D.value.pay_type_list.length?(o(!0),v(x,{key:0},f(D.value.pay_type_list,((e,a)=>(o(),n(t,{class:"pay-item py-[18rpx] flex items-center border-0 border-b border-solid border-[#eee]",key:a,onClick:a=>E.value=e.key},{default:u((()=>[d(l,{src:c(g)(e.icon),width:"50rpx",height:"50rpx"},null,8,["src"]),d(t,{class:"flex-1 px-[20rpx] text-sm font-bold"},{default:u((()=>[i(y(e.name),1)])),_:2},1024),e.key==E.value?(o(),n(r,{key:0,name:"checkbox-mark",color:"var(--primary-color)"})):h("v-if",!0)])),_:2},1032,["onClick"])))),128)):(o(),n(t,{key:1,class:"py-[20rpx] text-center text-sm text-gray-subtitle"},{default:u((()=>[i(y(c(m)("pay.notHavePayType")),1)])),_:1}))])),_:1})])),_:1}),d(t,{class:"p-[30rpx]"},{default:u((()=>[d(T,{type:"primary",loading:z.value,text:c(m)("pay.confirmPay"),shape:"circle",onClick:K},null,8,["loading","text"])])),_:1})])),_:1})):h("v-if",!0)])),_:1},8,["show"])}}}),[["__scopeId","data-v-1a623d68"]]);export{O as _};
