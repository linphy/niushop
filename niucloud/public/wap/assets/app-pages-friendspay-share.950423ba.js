import{d as e,r as a,o as t,Q as l,f as s,b as r,w as o,B as u,n as i,c as n,u as p,z as d,R as f,b_ as c,c0 as m,F as _,C as v,j as x,E as g,D as y,g as b,i as h,ac as k,m as w,k as F,q as j,y as T,aL as P,aM as O,K as S,ax as C,L as U,A as I,am as $,G as B,a as D}from"./index-2dd15007.js";import{_ as z}from"./u-avatar.9cec31ed.js";import{_ as N}from"./u--image.66118413.js";import{_ as J}from"./loading-page.vue_vue_type_script_setup_true_lang.b9794441.js";import{g as L,_ as R}from"./message.vue_vue_type_script_setup_true_lang.e5acc1b3.js";import{t as M}from"./topTabbar.2b5ec418.js";import{_ as V}from"./u-popup.95b17935.js";import{_ as q}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.c1509425.js";import"./u-transition.962c906a.js";import"./u-loading-icon.9cd30678.js";const A=q(e({__name:"share-poster",props:{posterId:{type:String||Number,default:0},posterType:{type:String,default:""},posterParam:{type:Object,default:{}},copyUrl:{type:String,default:""},copyUrlParam:{type:String,default:""}},emits:["close"],setup(e,{expose:k,emit:w}){const F=e,j=a(!1),T=()=>{let e="";if(F.copyUrl){let a=location.pathname,t=["/app/","/addon/"];for(let e=0;e<t.length;e++)-1!=a.indexOf(t[e])&&(a=a.substr(0,a.indexOf(t[e])));e=location.origin+a+F.copyUrl+F.copyUrlParam}else e=location.origin+location.pathname+F.copyUrlParam;c(e,(()=>{j.value=!1}))},P=a(!1),O=a(!1),S=a(""),C=()=>{if(S.value)P.value=!1,O.value=!0;else{P.value=!0,O.value=!1;let e={id:F.posterId,type:F.posterType,param:F.posterParam},a=Date.parse(new Date);m(e).then((e=>{S.value=e.data&&_(e.data)||"";let t=Date.parse(new Date)-a;t<2200?setTimeout((()=>{P.value=!1,O.value=!0}),2200-t):(P.value=!1,O.value=!0)})).catch((()=>{B()}))}},U=a(!1),I=()=>{U.value=!1},$=a(0),B=()=>{j.value=!1,P.value=!1,O.value=!1,w("close")};return k({openShare:()=>{j.value=!0,C()},loadPoster:C}),(e,a)=>{const c=v,m=x,k=g,w=y,F=b(h("u-popup"),V);return t(),l(f,null,[s(" 分享弹窗 "),r(m,{onTouchmove:a[2]||(a[2]=u((()=>{}),["prevent","stop"])),class:"share-popup"},{default:o((()=>[r(F,{show:j.value,type:"bottom",onClose:B,overlayOpacity:"0.8"},{default:o((()=>[r(m,{onTouchmove:a[0]||(a[0]=u((()=>{}),["prevent","stop"]))},{default:o((()=>[r(m,{class:"poster-img-wrap",style:i({top:$.value})},{default:o((()=>[P.value?(t(),n(c,{key:0,class:"poster-animation",src:p(_)("addon/shop/poster_animation.gif"),mode:"aspectFit"},null,8,["src"])):s("v-if",!0),O.value?(t(),n(c,{key:1,class:"poster-img",src:p(_)(S.value),mode:"aspectFit","show-menu-by-longpress":!0},null,8,["src"])):s("v-if",!0)])),_:1},8,["style"]),r(m,{class:"share-content"},{default:o((()=>[r(m,{class:"share-box",onClick:T},{default:o((()=>[r(w,{class:"share-btn",plain:!0},{default:o((()=>[r(m,{class:"text-[#07c160] iconfont iconfuzhilianjie"}),r(k,null,{default:o((()=>[d("复制链接")])),_:1})])),_:1})])),_:1})])),_:1}),r(m,{class:"share-footer",onClick:B},{default:o((()=>[r(k,null,{default:o((()=>[d("取消分享")])),_:1})])),_:1})])),_:1})])),_:1},8,["show"]),r(F,{show:U.value,mode:"center",round:10,closeable:!0,onClose:a[1]||(a[1]=e=>U.value=!1),"safe-area-inset-bottom":!1},{default:o((()=>[r(m,{class:"dialog-popup"},{default:o((()=>[r(m,{class:"title"},{default:o((()=>[d("提示")])),_:1}),r(m,{class:"message"},{default:o((()=>[d("您拒绝了保存图片到相册的授权请求，无法保存图片到相册，如需正常使用，请授权之后再进行操作。")])),_:1}),r(m,{class:"action-wrap"},{default:o((()=>[r(m,{onClick:I},{default:o((()=>[d("取消")])),_:1}),r(m,null,{default:o((()=>[r(w,{type:"default",class:"authorization-btn","open-type":"openSetting",onOpensetting:I,"hover-class":"none"},{default:o((()=>[d("立即授权")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})],2112)}}}),[["__scopeId","data-v-09a6e3f0"]]),E=e({__name:"share",setup(e){const u=M();u.setTopTabbarParam({title:""});const c=a(!0),m=a(!1),V=a(0),q=a(""),E=a({}),G=a(!0),K=a(null),{setShare:Q}=k(),H=w(),W=F((()=>H.info));j((e=>{V.value=e.id||0,q.value=e.type||""})),T((()=>{V.value&&q.value&&X(q.value,V.value)})),P((()=>{K.value&&(clearTimeout(K.value),K.value=null)})),O((()=>{K.value&&(clearTimeout(K.value),K.value=null)}));const X=(e,a)=>{G.value&&(c.value=!0,G.value=!1),L(e,a).then((t=>{E.value=t.data,c.value=!1,S({title:E.value.config.pay_page_name}),u.setTopTabbarParam({title:E.value.config.pay_page_name});let l="",s=location.pathname,r=["/app/","/addon/"];for(let e=0;e<r.length;e++)-1!=s.indexOf(r[e])&&(s=s.substr(0,s.indexOf(r[e])));l=location.origin+s+`/app/pages/friendspay/money?id=${E.value.trade_id}&type=${E.value.trade_type}`;let o={desc:E.value.config.pay_leave_message,path:`/app/pages/friendspay/money?id=${E.value.trade_id}&type=${E.value.trade_type}`,link:l};if(E.value.member){let e=E.value.member.nickname;e=e.length>15?e=e.substring(0,15)+"...":e,o.title=`${e}希望你帮他付${E.value.money}元`}"[]"!==JSON.stringify(E.value.trade_info)&&E.value.trade_info.item_list.length&&(o.url=E.value.trade_info.item_list[0].item_image),Q({wechat:{...o},weapp:{...o}}),se(),C((()=>{setTimeout((()=>{ee.value&&(le.id=E.value.trade_id,le.type=E.value.trade_type,W.value&&W.value.member_id&&(le.member_id=W.value.member_id),ee.value.loadPoster())}),400)})),2!=E.value.status&&1!=E.value.status&&-1!=E.value.status?K.value=setTimeout((()=>{X(e,a)}),3e3):(clearTimeout(K.value),K.value=null)})).catch((e=>{K.value&&(clearTimeout(K.value),K.value=null),c.value=!1;U({title:"未找到帮付订单信息",url:"/app/pages/index/index",mode:"reLaunch"})}))},Y=a(null),Z=()=>{Y.value.open(E.value.config)},ee=a(null),ae=a("/app/pages/friendspay/money"),te=a("");let le={};const se=()=>{te.value="?id="+E.value.trade_id,te.value+="&type="+E.value.trade_type},re=()=>{le.id=E.value.trade_id,le.type=E.value.trade_type,W.value&&W.value.member_id&&(le.member_id=W.value.member_id),ee.value.openShare()};return(e,a)=>{const u=b(h("u-avatar"),z),k=g,w=x,F=y,j=v,T=b(h("u--image"),N),P=b(h("loading-page"),J);return t(),n(w,{style:i(e.themeColor())},{default:o((()=>[Object.keys(E.value).length&&!c.value?(t(),n(w,{key:0,class:"bg-[var(--page-bg-color)] min-h-screen overflow-hidden"},{default:o((()=>[r(w,{style:i({background:"url("+p(_)("static/resource/images/app/friendpay_bg.png")+") left bottom /100% no-repeat"}),class:"pb-[168rpx] overflow-hidden"},{default:o((()=>[r(w,{class:"mt-[20rpx] flex flex-col items-center"},{default:o((()=>[r(u,{src:p(_)(E.value.member.headimg),size:"50",leftIcon:"none","default-url":p(_)("static/resource/images/default_headimg.png")},null,8,["src","default-url"]),r(w,{class:"flex items-center mt-[20rpx] text-[#fff] text-[26rpx] leading-[36rpx]"},{default:o((()=>[r(k,{class:"font-bold mr-[10rpx] max-w-[250rpx] truncate"},{default:o((()=>[d(I(E.value.member.nickname),1)])),_:1}),r(k,null,{default:o((()=>[d("发起了订单帮付请求~")])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),r(w,{class:"mt-[-128rpx] card-template sidebar-margin mb-[var(--top-m)]"},{default:o((()=>[r(w,{class:"text-[24rpx] text-center text-[#333] mb-[10rpx]"},{default:o((()=>[d(I(p(B)("payMoney")),1)])),_:1}),r(w,{class:"text-center mb-[50rpx]"},{default:o((()=>[r(k,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:o((()=>[d("￥")])),_:1}),r(k,{class:"text-[56rpx] font-bold price-font text-[#FF4142]"},{default:o((()=>[d(I(parseFloat(E.value.money).toFixed(2).split(".")[0]),1)])),_:1}),r(k,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:o((()=>[d("."+I(parseFloat(E.value.money).toFixed(2).split(".")[1]),1)])),_:1})])),_:1}),r(w,{class:"px-[20rpx] box-border"},{default:o((()=>[2==E.value.status?(t(),n(F,{key:0,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:o((()=>[d(I(p(B)("finish")),1)])),_:1})):-1==E.value.status?(t(),n(F,{key:1,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:o((()=>[d(I(p(B)("close")),1)])),_:1})):(t(),n(F,{key:2,class:"primary-btn-bg !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none",loading:m.value,onClick:re},{default:o((()=>[d(I(E.value.config.pay_type_name?E.value.config.pay_type_name:p(B)("friendPay")),1)])),_:1},8,["loading"]))])),_:1}),2==E.value.status&&"[]"!==JSON.stringify(E.value.trade_info)&&E.value.trade_info.detail_url?(t(),n(w,{key:0,class:"mt-[20rpx] flex items-baseline justify-center text-[var(--text-color-light9)]",onClick:a[0]||(a[0]=e=>p(D)({url:E.value.trade_info.detail_url}))},{default:o((()=>[r(k,{class:"text-[24rpx] mr-[6rpx]"},{default:o((()=>[d("查看订单")])),_:1}),r(k,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx]"})])),_:1})):s("v-if",!0)])),_:1}),r(w,{class:"card-template sidebar-margin mb-[var(--top-m)]"},{default:o((()=>[r(w,{class:"flex justify-between items-center mb-[30rpx]"},{default:o((()=>[r(w,{class:"text-[30rpx] text-[#333] font-500"},{default:o((()=>[d(I(p(B)("friendPayOrderInfo")),1)])),_:1}),E.value.config.pay_explain_switch?(t(),n(w,{key:0,class:"text-[#666] leading-[1]",onClick:Z},{default:o((()=>[r(k,{class:"mr-[8rpx] text-[24rpx]"},{default:o((()=>[d(I(E.value.config.pay_explain_title),1)])),_:1}),r(k,{class:"nc-iconfont nc-icon-jichuxinxiV6xx text-[26rpx]"})])),_:1})):s("v-if",!0)])),_:1}),"[]"!==JSON.stringify(E.value.trade_info)?(t(),l(f,{key:0},[E.value.trade_info.item_list.length?(t(),l(f,{key:0},[r(w,{class:"border-0 border-solid border-b-[1rpx] border-[#f6f6f6] mb-[20rpx]"},{default:o((()=>[(t(!0),l(f,null,$(E.value.trade_info.item_list,((e,a)=>(t(),n(w,{class:"flex justify-between mb-[30rpx]"},{default:o((()=>[r(w,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden flex-shrink-0"},{default:o((()=>[r(T,{class:"overflow-hidden",radius:"var(--goods-rounded-big)",width:"170rpx",height:"170rpx",src:p(_)(e.item_image?e.item_image:""),model:"aspectFill"},{error:o((()=>[r(j,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:p(_)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"])])),_:2},1024),r(w,{class:"ml-[20rpx] flex flex-1 flex-col justify-between"},{default:o((()=>[r(w,null,{default:o((()=>[r(w,{class:"text-[28rpx] using-hidden leading-[40rpx] text-[#333]"},{default:o((()=>[d(I(e.item_name),1)])),_:2},1024),e.item_sub_name?(t(),n(w,{key:0,class:"text-[24rpx] mt-[14rpx] text-[var(--text-color-light9)] using-hidden leading-[28rpx]"},{default:o((()=>[d(I(e.item_sub_name),1)])),_:2},1024)):s("v-if",!0)])),_:2},1024),r(w,{class:"flex justify-between items-baseline"},{default:o((()=>[r(w,{class:"price-font text-[#FF4142]"},{default:o((()=>[r(k,{class:"text-[24rpx]"},{default:o((()=>[d("￥")])),_:1}),r(k,{class:"text-[40rpx] font-500"},{default:o((()=>[d(I(parseFloat(e.item_price).toFixed(2).split(".")[0]),1)])),_:2},1024),r(k,{class:"text-[24rpx] font-500"},{default:o((()=>[d("."+I(parseFloat(e.item_price).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024),r(k,{class:"text-right text-[26rpx]"},{default:o((()=>[d("x"+I(e.item_num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1}),r(w,{class:"text-[26rpx] text-right"},{default:o((()=>[d(I(E.value.trade_info.item_total),1)])),_:1})],64)):s("v-if",!0)],64)):(t(),n(w,{key:1,class:"text-[28rpx] leading-[40rpx] text-[#333]"},{default:o((()=>[d(I(E.value.body),1)])),_:1}))])),_:1}),r(A,{ref_key:"sharePosterRef",ref:ee,posterType:"friendspay",posterId:E.value.poster_id,posterParam:p(le),copyUrl:ae.value,copyUrlParam:te.value},null,8,["posterId","posterParam","copyUrl","copyUrlParam"]),s(" 帮付说明 "),r(R,{ref_key:"messageRef",ref:Y},null,512)])),_:1})):s("v-if",!0),r(P,{loading:c.value},null,8,["loading"])])),_:1},8,["style"])}}});export{E as default};
