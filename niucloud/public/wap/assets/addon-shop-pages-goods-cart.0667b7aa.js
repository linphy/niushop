import{d as e,J as t,c as a,r as l,e as s,$ as o,K as r,i as c,P as n,j as u,w as i,n as x,k as d,G as p,R as f,H as m,Q as _,m as g,D as h,N as v,_ as k,h as b,aP as w,q as y,t as j,x as C,I as S,a7 as z,y as E}from"./index-616d13f7.js";import{_ as F}from"./u-empty.29495b9a.js";import{_ as V}from"./u-icon.9fd6fcea.js";import{_ as D}from"./u--image.1db8844d.js";import{u as I,g as q,_ as B}from"./cart.ef3e4814.js";import{_ as L,a as N}from"./u-swipe-action.33254540.js";import{_ as P}from"./u-loading-page.d7d194b0.js";import{_ as U}from"./tabbar.bf31e572.js";import{_ as $}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-image.37db3168.js";import"./u-transition.b526b92d.js";import"./u-loading-icon.3da3468b.js";import"./u-badge.1ef08990.js";import"./u-tabbar.2da70f0a.js";import"./u-safe-bottom.09842298.js";const A=$(e({__name:"cart",setup(e){const $=t(),A=a((()=>$.info)),G=l(!0),H=l(!1),J=l("0.00"),K=l([]),Q=l([]),R=l(!1),T=I(),X=()=>{q({}).then((({data:e})=>{K.value=[],Q.value=[],e.forEach((e=>{e.checked=!1,e.status&&0==e.goods.delete_time?K.value.push(e):Q.value.push(e)})),G.value=!1})).catch()};s((()=>{A.value?(X(),T.getList()):G.value=!1})),o((()=>A.value),(()=>{A.value&&X()}));const M=a((()=>{let e=0;return K.value.forEach((t=>{t.checked&&(e+=1)})),e}));o((()=>K.value),(()=>{let e=0;K.value.forEach((t=>{t.checked&&(e+=parseFloat(t.goodsSku.sale_price)*t.num)})),J.value=e.toFixed(2)}),{deep:!0});const O=()=>{v().setLoginBack({url:"/addon/shop/pages/goods/cart"})},W=e=>({min:1,max:e.goodsSku.stock||1}),Y=l([{text:r("delete"),style:{backgroundColor:"#F56C6C"}}]),Z=(e,t)=>{if(H.value)return;H.value=!0;const a=e.index,l=K.value[a];T.delete(l.id,(()=>{"cart"==t?K.value.splice(a,1):Q.value.splice(a,1),H.value=!1}))},ee=()=>{const e=K.value.length!=M.value;K.value.forEach((t=>{t.checked=e}))},te=()=>{if(!M.value)return void k({title:"还没有选择商品",icon:"none"});const e=[];K.value.forEach((t=>{t.checked&&e.push(t.id)})),uni.setStorage({key:"orderCreateData",data:{cart_ids:e},success(){b({url:"/addon/shop/pages/order/payment"})}})},ae=()=>{if(!M.value)return void k({title:"还没有选择商品",icon:"none"});if(H.value)return;H.value=!0;const e=[];K.value.forEach((t=>{t.checked&&e.push(t.id)})),T.delete(e,(()=>{X(),H.value=!1}))};return(e,t)=>{const a=w,l=y(j("u-empty"),F),s=C,o=S,r=y(j("u-icon"),V),v=y(j("u--image"),D),k=y(j("u-number-box"),B),I=y(j("u-swipe-action-item"),L),q=y(j("u-swipe-action"),N),$=z,X=y(j("u-loading-page"),P),le=y(j("tabbar"),U);return c(),n(f,null,[G.value?g("v-if",!0):(c(),u(s,{key:0,class:"bg-page h-screen overflow-hidden flex flex-col"},{default:i((()=>[x(A)?K.value.length?(c(),n(f,{key:2},[d(s,{class:"flex justify-between px-[32rpx] leading-[84rpx] font-500 text-[#666] text-[26rpx] bg-[#fff]"},{default:i((()=>[d(o,null,{default:i((()=>[p("共"+m(K.value.length)+"件宝贝",1)])),_:1}),d(o,{onClick:t[1]||(t[1]=e=>R.value=!R.value)},{default:i((()=>[p(m(R.value?"完成":"编辑"),1)])),_:1})])),_:1}),d(s,{class:"flex-1 h-0"},{default:i((()=>[d($,{class:"scroll-height box-border","scroll-y":!0},{default:i((()=>[d(s,{class:"py-[20rpx] px-[24rpx]"},{default:i((()=>[d(q,null,{default:i((()=>[(c(!0),n(f,null,_(K.value,((e,a)=>(c(),u(s,{class:h(["bg-[#fff] py-[30rpx] rounded-[18rpx] overflow-hidden",a?"mt-[20rpx]":""])},{default:i((()=>[d(I,{options:Y.value,onClick:t[2]||(t[2]=e=>Z(e,"cart"))},{default:i((()=>[d(s,{class:h(["flex px-[24rpx]"])},{default:i((()=>[d(o,{class:h(["self-center iconfont text-color text-[37rpx] mr-[24rpx]",e.checked?"iconxuanze1":"iconcheckbox_nol"]),onClick:t=>e.checked=!e.checked},null,8,["class","onClick"]),d(v,{width:"168rpx",height:"168rpx",onClick:t=>{b({url:"/addon/shop/pages/goods/detail",param:{goods_id:e.goods_id},mode:"navigateTo"})},src:x(E)(e.goodsSku.sku_image_thumb_mid),model:"aspectFill"},{error:i((()=>[d(r,{name:"photo",color:"#999",size:"50"})])),_:2},1032,["onClick","src"]),d(s,{class:"flex flex-1 flex-wrap ml-[20rpx]"},{default:i((()=>[d(s,{class:"w-[100%]"},{default:i((()=>[d(s,{class:"w-[404rpx] multi-hidden text-[#333] text-[26rpx] leading-[36rpx] text-ellipsis"},{default:i((()=>[p(m(e.goods.goods_name),1)])),_:2},1024),d(s,{class:"w-[404rpx] mt-[12rpx] truncate text-[#888] text-[24rpx] leading-[32rpx] font-500"},{default:i((()=>[p(m(e.goodsSku.sku_spec_format),1)])),_:2},1024)])),_:2},1024),d(s,{class:"flex justify-between items-end self-end w-[100%]"},{default:i((()=>[d(s,{class:"text-[var(--price-text-color)] leading-[40rpx] price-font"},{default:i((()=>[d(o,{class:"text-[24rpx] font-500"},{default:i((()=>[p("￥")])),_:1}),d(o,{class:"text-[32rpx] mr-[10rpx] font-500"},{default:i((()=>[p(m(e.goodsSku.sale_price),1)])),_:2},1024)])),_:2},1024),d(k,{modelValue:e.num,"onUpdate:modelValue":t=>e.num=t,min:W(e).min,max:W(e).max,integer:"",step:1,"input-width":"68rpx","input-height":"52rpx","button-size":"52rpx",disabledInput:"",onChange:e=>((e,t)=>{uni.$u.debounce((e=>{const a=K.value[t];T.increase({id:a.id,goods_id:a.goods_id,sku_id:a.sku_id,stock:a.goodsSku.stock,sale_price:a.goodsSku.sale_price,num:a.num},0)}),500)})(0,a)},{minus:i((()=>[d(o,{class:h([{"text-[#c8c9cc]":e.num===W(e).min,"text-[var(--primary-color)]":e.num!==W(e).min},"text-[44rpx] iconfont iconjianhao"])},null,8,["class"])])),input:i((()=>[d(o,{class:"text-[#333] fext-[23rpx] font-500 mx-[16rpx]"},{default:i((()=>[p(m(e.num),1)])),_:2},1024)])),plus:i((()=>[d(o,{class:h([{"text-[#c8c9cc]":e.num===W(e).max," text-[var(--primary-color)]":e.num!==W(e).max},"text-[44rpx] text-[var(--primary-color)] iconfont iconjiahao2fill"])},null,8,["class"])])),_:2},1032,["modelValue","onUpdate:modelValue","min","max","onChange"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["options"])])),_:2},1032,["class"])))),256)),(c(!0),n(f,null,_(Q.value,((e,a)=>(c(),u(s,{class:h(["bg-[#fff] py-[30rpx] rounded-[18rpx] overflow-hidden mt-[20rpx]"])},{default:i((()=>[d(I,{options:Y.value,onClick:t[3]||(t[3]=e=>Z(e,"cart"))},{default:i((()=>[d(s,{class:h(["flex px-[24rpx]"])},{default:i((()=>[d(o,{class:"self-center iconfont text-[37rpx] mr-[24rpx] iconcheckbox_nol bg-[#f5f5f5] text-[#eee] rounded-[50%]"}),d(s,{class:"relative w-[168rpx] h-[168rpx]"},{default:i((()=>[d(v,{width:"168rpx",height:"168rpx",src:x(E)(e.goodsSku.sku_image_thumb_mid),model:"aspectFill"},{error:i((()=>[d(r,{name:"photo",color:"#999",size:"50"})])),_:2},1032,["src"]),d(s,{class:"absolute left-0 top-0 w-[168rpx] h-[168rpx] leading-[168rpx] text-center",style:{"background-color":"rgba(243,244,246,0.5)"}},{default:i((()=>[d(o,{class:"text-[#333] text-[24rpx] font-500"},{default:i((()=>[p("已失效")])),_:1})])),_:1})])),_:2},1024),d(s,{class:"flex flex-1 flex-wrap ml-[20rpx]"},{default:i((()=>[d(s,{class:"w-[100%]"},{default:i((()=>[d(s,{class:"w-[404rpx] multi-hidden text-[#333] text-[26rpx] leading-[36rpx] text-ellipsis"},{default:i((()=>[p(m(e.goods.goods_name),1)])),_:2},1024),d(s,{class:"w-[404rpx] mt-[12rpx] truncate text-[#888] text-[24rpx] leading-[32rpx] font-500"},{default:i((()=>[p(m(e.goodsSku.sku_spec_format),1)])),_:2},1024)])),_:2},1024),d(s,{class:"flex justify-between items-end self-end w-[100%]"},{default:i((()=>[d(s,{class:"text-[var(--price-text-color)] leading-[40rpx] price-font"},{default:i((()=>[d(o,{class:"text-[24rpx] font-500"},{default:i((()=>[p("￥")])),_:1}),d(o,{class:"text-[32rpx] mr-[10rpx] font-500"},{default:i((()=>[p(m(e.goodsSku.sale_price),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["options"])])),_:2},1024)))),256))])),_:1})])),_:1})])),_:1})])),_:1})],64)):(c(),u(s,{key:1,class:"flex-1 flex flex-col justify-center"},{default:i((()=>[d(l,{mode:"car"}),d(a,{shape:"circle",class:"!w-[200rpx] mt-[20rpx] text-[30rpx] leading-[70rpx] text-[#fff] rounded-full bg-color remove-border",onClick:t[0]||(t[0]=e=>x(b)({url:"/addon/shop/pages/goods/list"}))},{default:i((()=>[p("去逛逛")])),_:1})])),_:1})):(c(),u(s,{key:0,class:"flex-1 flex flex-col justify-center"},{default:i((()=>[d(l,{mode:"data",text:"未登录"},{default:i((()=>[d(a,{shape:"circle",class:"!w-[200rpx] mt-[20rpx] text-[30rpx] leading-[70rpx] text-[#fff] rounded-full bg-color remove-border",onClick:O},{default:i((()=>[p("去登录")])),_:1})])),_:1})])),_:1}))])),_:1})),K.value.length?(c(),u(s,{key:1,class:"flex h-[100rpx] items-center bg-[#fff] fixed left-0 right-0 bottom-[50px] box-solid mb-[env(safe-area-inset-bottom)]"},{default:i((()=>[d(s,{class:"flex items-center px-[30rpx]",onClick:ee},{default:i((()=>[d(o,{class:h(["iconfont text-color text-[34rpx] mr-[12rpx]",K.value.length==x(M)?"iconxuanze1":"iconcheckbox_nol"])},null,8,["class"]),d(o,{class:"font-500 text-[#676767] text-[25rpx]"},{default:i((()=>[p("全选")])),_:1})])),_:1}),R.value?(c(),u(s,{key:1,class:"flex-1 flex items-center justify-end"},{default:i((()=>[d(a,{class:"!w-[204rpx] !h-[80rpx] text-[#fff] text-[30rpx] !leading-[80rpx] !text-[32rpx] mr-[30rpx] bg-color",shape:"circle",onClick:ae},{default:i((()=>[p("删除")])),_:1})])),_:1})):(c(),u(s,{key:0,class:"flex-1 flex items-center justify-between"},{default:i((()=>[d(o,{class:"whitespace-nowrap mr-[24rpx] text-[var(--price-text-color)] font-500 leading-[45rpx]"},{default:i((()=>[d(o,{class:"text-[#333333] text-[32rpx]"},{default:i((()=>[p("合计：")])),_:1}),d(o,{class:"text-[24rpx] price-font"},{default:i((()=>[p("￥")])),_:1}),d(o,{class:"text-[34rpx] mr-[10rpx] price-font"},{default:i((()=>[p(m(J.value),1)])),_:1})])),_:1}),d(a,{class:"!w-[204rpx] !h-[80rpx] text-[#fff] text-[30rpx] !leading-[80rpx] !text-[32rpx] mr-[30rpx] bg-color",shape:"circle",onClick:te},{default:i((()=>[p("结算")])),_:1})])),_:1}))])),_:1})):g("v-if",!0),d(X,{loading:H.value,"loading-text":"","bg-color":"none",loadingColor:"var(--primary-color)",iconSize:"35"},null,8,["loading"]),d(X,{loading:G.value,"loading-text":"","bg-color":"#f7f7f7",loadingColor:"var(--primary-color)",iconSize:"35"},null,8,["loading"]),d(le,{addon:"shop"})],64)}}}),[["__scopeId","data-v-ed98d0c4"]]);export{A as default};
