import{d as e,s as a,bM as t,r as l,bX as r,a as s,g as u,i as n,o,c as p,w as i,B as d,b as c,z as f,A as x,u as m,G as _,ag as v,Q as y,R as g,am as b,F as h,f as k,x as w,j as F,al as j,D as S,q as T,y as C,aL as I,aM as P,K as R,L as B,n as O,t as L,I as z,E,S as M,C as A}from"./index-2dd15007.js";import{_ as G}from"./u-avatar.9cec31ed.js";import{a as H,_ as U}from"./u--image.66118413.js";import{_ as $}from"./u-icon.c1509425.js";import{_ as q}from"./u-popup.95b17935.js";import{p as D,g as J}from"./pay.1e18cdbc.js";import{_ as K}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as N}from"./loading-page.vue_vue_type_script_setup_true_lang.b9794441.js";import{t as Q}from"./topTabbar.2b5ec418.js";import{g as V,_ as X}from"./message.vue_vue_type_script_setup_true_lang.e5acc1b3.js";import"./u-transition.962c906a.js";import"./u-loading-icon.9cd30678.js";const W=K(e({__name:"pay",emits:["close","confirm"],setup(e,{expose:T,emit:C}){a()&&t.init();const I=l(!1),P=l(!1),R=l(null),B=l(""),O=()=>{var e,l,r,u;if(!uni.$u.test.isEmpty(B.value))return"friendspay"==B.value?(s({url:"/app/pages/friendspay/share",param:{id:null==(e=R.value)?void 0:e.trade_id,type:null==(l=R.value)?void 0:l.trade_type},mode:"redirectTo"}),!1):void(P.value||(P.value=!0,D({trade_type:null==(r=R.value)?void 0:r.trade_type,trade_id:null==(u=R.value)?void 0:u.trade_id,type:B.value,openid:uni.getStorageSync("openid")||""}).then((e=>{var l,r,u,n,o,p;switch(B.value){case"wechatpay":a()?(e.data.timestamp=e.data.timeStamp,delete e.data.timeStamp,t.pay({...e.data,success:()=>{z()},cancel:()=>{P.value=!1}})):(uni.setStorageSync("paymenting",{trade_type:null==(l=R.value)?void 0:l.trade_type,trade_id:null==(r=R.value)?void 0:r.trade_id}),location.href=e.data.h5_url);break;case"alipay":a()?s({url:"/app/pages/pay/browser",param:{trade_type:null==(u=R.value)?void 0:u.trade_type,trade_id:null==(n=R.value)?void 0:n.trade_id,alipay:encodeURIComponent(e.data.url)},mode:"redirectTo"}):(uni.setStorageSync("paymenting",{trade_type:null==(o=R.value)?void 0:o.trade_type,trade_id:null==(p=R.value)?void 0:p.trade_id}),location.href=e.data.url);break;default:if(e.data.url)return void s({url:e.data.url,param:e.data.param||{},mode:"redirectTo"});z()}})).catch((()=>{P.value=!1}))));w({title:_("pay.notHavePayType"),icon:"none"})};r("checkIsReturnAfterPayment",(()=>{const e=uni.getStorageSync("paymenting");uni.getStorageSync("paymenting")&&s({url:"/app/pages/pay/result",param:{trade_type:e.trade_type,trade_id:e.trade_id},mode:"redirectTo",success(){uni.removeStorageSync("paymenting")}})}));const L=l(!1),z=()=>{var e,a;C("confirm"),s({url:"/app/pages/pay/result",param:{trade_type:null==(e=R.value)?void 0:e.trade_type,trade_id:null==(a=R.value)?void 0:a.trade_id},mode:"redirectTo"})},E=()=>{uni.removeStorageSync("paymenting"),I.value=!1,C("close")};return T({open:(e,a,t="",l="")=>{if(L.value)return;L.value=!0,uni.setStorageSync("payReturn",encodeURIComponent(t));const r={};l&&(r.scene=l),J(e,a,r).then((e=>{let{data:a}=e;R.value=a,uni.$u.test.isEmpty(a)?w({title:_("pay.notObtainedInfo"),icon:"none"}):0!=a.money?(B.value=a.pay_type_list[0]?a.pay_type_list[0].key:"",I.value=!0,L.value=!1):z()})).catch((()=>{L.value=!1}))}}),(e,a)=>{const t=F,l=u(n("u-image"),H),r=u(n("u-icon"),$),s=j,w=S,T=u(n("u-popup"),q);return o(),p(T,{show:I.value,round:10,onClose:E,closeable:!0,bgColor:"#fff",zIndex:"10081",closeOnClickOverlay:!1},{default:i((()=>[R.value?(o(),p(t,{key:0,class:"flex flex-col h-[65vh] popup-common",onTouchmove:a[0]||(a[0]=d((()=>{}),["prevent","stop"]))},{default:i((()=>[c(t,{class:"head"},{default:i((()=>[c(t,{class:"title"},{default:i((()=>[f(x(m(_)("pay.payTitle")),1)])),_:1}),c(t,{class:"flex items-end justify-center w-full text-xl font-bold py-[20rpx] price-font"},{default:i((()=>[c(t,{class:"text-base mr-[4rpx]"},{default:i((()=>[f(x(m(_)("currency")),1)])),_:1}),f(" "+x(m(v)(R.value.money)),1)])),_:1})])),_:1}),c(s,{"scroll-y":"true",class:"flex-1 pt-[20rpx]"},{default:i((()=>[c(t,{class:"flex text-[28rpx] px-[36rpx] py-[20rpx] mb-[10rpx]"},{default:i((()=>[c(t,{class:"text-[var(--text-color-light6)]"},{default:i((()=>[f(x(m(_)("pay.orderInfo")),1)])),_:1}),c(t,{class:"text-right flex-1 pl-[30rpx] truncate"},{default:i((()=>[f(x(R.value.body),1)])),_:1})])),_:1}),c(t,{class:"mx-[var(--popup-sidebar-m)] px-[30rpx] bg-white rounded-[20rpx] bg-[var(--temp-bg)]"},{default:i((()=>[R.value.pay_type_list.length?(o(!0),y(g,{key:0},b(R.value.pay_type_list,((e,a)=>(o(),p(t,{class:"pay-item py-[30rpx] flex items-center border-0 border-b border-solid border-[#eee]",key:a,onClick:a=>B.value=e.key},{default:i((()=>[c(l,{src:m(h)(e.icon),width:"50rpx",height:"50rpx"},null,8,["src"]),c(t,{class:"flex-1 px-[20rpx] text-[28rpx] font-500"},{default:i((()=>[f(x(e.name),1)])),_:2},1024),e.key==B.value?(o(),p(r,{key:0,name:"checkbox-mark",color:"var(--primary-color)"})):k("v-if",!0)])),_:2},1032,["onClick"])))),128)):(o(),p(t,{key:1,class:"py-[30rpx] text-center text-[24rpx] text-gray-subtitle"},{default:i((()=>[f(x(m(_)("pay.notHavePayType")),1)])),_:1}))])),_:1})])),_:1}),c(t,{class:"btn-wrap"},{default:i((()=>[c(w,{class:"primary-btn-bg btn","hover-class":"none",loading:P.value,onClick:O},{default:i((()=>[f(x(m(_)("pay.confirmPay")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):k("v-if",!0)])),_:1},8,["show"])}}}),[["__scopeId","data-v-a03fe042"]]),Y=K(e({__name:"money",setup(e){const a=Q();a.setTopTabbarParam({title:""});const t=l(!0),r=l(0),d=l(""),v=l({}),w=l(!1),j=l(!0),H=l(null);T((e=>{r.value=e.id||0,d.value=e.type||""})),C((()=>{r.value&&d.value&&$(d.value,r.value)})),I((()=>{H.value&&(clearTimeout(H.value),H.value=null)})),P((()=>{H.value&&(clearTimeout(H.value),H.value=null)}));const $=(e,l)=>{j.value&&(t.value=!0,j.value=!1),V(e,l).then((r=>{v.value=r.data,R({title:v.value.config.pay_page_name}),a.setTopTabbarParam({title:v.value.config.pay_page_name}),t.value=!1,2!=v.value.status&&1!=v.value.status&&-1!=v.value.status?H.value=setTimeout((()=>{$(e,l)}),3e3):(clearTimeout(H.value),H.value=null)})).catch((()=>{H.value&&(clearTimeout(H.value),H.value=null),t.value=!1;B({title:"未找到帮付订单信息",url:"/app/pages/index/index",mode:"reLaunch"})}))},q=l(null),D=()=>{q.value.open(v.value.config)},J=l(),K=()=>{var e;L()?null==(e=J.value)||e.open(v.value.trade_type,v.value.trade_id,"/app/pages/index/index","friendspay"):z().setLoginBack({url:"/app/pages/friendspay/money",param:{id:v.value.trade_id,type:v.value.trade_type}})};return(e,a)=>{const l=u(n("u-avatar"),G),r=E,d=F,j=S,T=A,C=u(n("u--image"),U),I=u(n("pay"),W),P=u(n("loading-page"),N);return o(),p(d,{style:O(e.themeColor())},{default:i((()=>[Object.keys(v.value).length&&!t.value?(o(),p(d,{key:0,class:"bg-[var(--page-bg-color)] min-h-screen overflow-hidden"},{default:i((()=>[c(d,{style:O({background:"url("+m(h)("static/resource/images/app/friendpay_money.png")+") left bottom / cover no-repeat"}),class:"pb-[194rpx] overflow-hidden"},{default:i((()=>[c(d,{class:"mt-[20rpx] flex flex-col items-center"},{default:i((()=>[c(l,{src:m(h)(v.value.member.headimg),size:"50",leftIcon:"none","default-url":m(h)("static/resource/images/default_headimg.png")},null,8,["src","default-url"]),c(d,{class:"flex items-center mt-[20rpx] text-[#fff] text-[26rpx] leading-[36rpx]"},{default:i((()=>[c(r,{class:"font-bold mr-[10rpx] max-w-[250rpx] truncate"},{default:i((()=>[f(x(v.value.member.nickname),1)])),_:1}),c(r,null,{default:i((()=>[f("请您帮忙付款~")])),_:1})])),_:1}),v.value.config.pay_leave_message?(o(),p(d,{key:0,class:"message bg-[#fe0708] relative max-w-[520rpx] px-[20rpx] py-[12rpx] rounded-[12rpx] border-solid border-[1rpx] border-color text-[24rpx] text-[#fff] leading-[30rpx] box-border text-center mt-[20rpx] mx-[114rpx]"},{default:i((()=>[f(x(v.value.config.pay_leave_message),1)])),_:1})):k("v-if",!0)])),_:1})])),_:1},8,["style"]),c(d,{class:"-mt-[154rpx] card-template sidebar-margin mb-[var(--top-m)]"},{default:i((()=>[c(d,{class:"text-[24rpx] text-center mb-[10rpx]"},{default:i((()=>[f(x(m(_)("payMoney")),1)])),_:1}),c(d,{class:"text-center mb-[50rpx]"},{default:i((()=>[c(r,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:i((()=>[f("￥")])),_:1}),c(r,{class:"text-[56rpx] font-bold price-font text-[#FF4142]"},{default:i((()=>[f(x(parseFloat(v.value.money).toFixed(2).split(".")[0]),1)])),_:1}),c(r,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:i((()=>[f("."+x(parseFloat(v.value.money).toFixed(2).split(".")[1]),1)])),_:1})])),_:1}),c(d,{class:"px-[20rpx] box-border"},{default:i((()=>[2==v.value.status?(o(),p(j,{key:0,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:i((()=>[f(x(m(_)("finish")),1)])),_:1})):-1==v.value.status?(o(),p(j,{key:1,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:i((()=>[f(x(m(_)("close")),1)])),_:1})):(o(),p(j,{key:2,class:"primary-btn-bg !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none",loading:w.value,onClick:K},{default:i((()=>[f(x(v.value.config.pay_button_name?v.value.config.pay_button_name:m(_)("payGenerously")),1)])),_:1},8,["loading"]))])),_:1}),c(d,{class:"mt-[20rpx] flex items-baseline justify-center text-[var(--text-color-light9)]",onClick:a[0]||(a[0]=e=>m(s)({url:"/app/pages/index/index"}))},{default:i((()=>[c(r,{class:"text-[24rpx] mr-[6rpx]"},{default:i((()=>[f("返回首页")])),_:1})])),_:1})])),_:1}),v.value.config.pay_info_switch?(o(),p(d,{key:0,class:"card-template sidebar-margin mb-[var(--top-m)]"},{default:i((()=>["[]"!==JSON.stringify(v.value.trade_info)&&v.value.trade_info.item_list.length?(o(),y(g,{key:0},[c(d,{class:"flex justify-between items-center mb-[30rpx]"},{default:i((()=>[c(d,{class:"text-[30rpx] text-[#333] font-500"},{default:i((()=>[f(x(m(_)("helpPayInfo")),1)])),_:1}),v.value.config.pay_explain_switch?(o(),p(d,{key:0,class:"flex-shrink-0",onClick:D},{default:i((()=>[c(r,{class:"mr-[8rpx] text-[24rpx]"},{default:i((()=>[f(x(v.value.config.pay_explain_title),1)])),_:1}),c(r,{class:"nc-iconfont nc-icon-jichuxinxiV6xx text-[26rpx]"})])),_:1})):k("v-if",!0)])),_:1}),c(d,{class:"border-0 border-solid border-b-[1rpx] border-[#f6f6f6] mb-[20rpx]"},{default:i((()=>[(o(!0),y(g,null,b(v.value.trade_info.item_list,((e,a)=>(o(),p(d,{class:M(["flex justify-between",{" mb-[34rpx]":a+1!=v.value.trade_info.length}])},{default:i((()=>[c(d,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden flex-shrink-0"},{default:i((()=>[c(C,{class:"overflow-hidden",radius:"var(--goods-rounded-big)",width:"170rpx",height:"170rpx",src:m(h)(e.item_image?e.item_image:""),model:"aspectFill"},{error:i((()=>[c(T,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:m(h)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"])])),_:2},1024),c(d,{class:"ml-[20rpx] flex flex-1 flex-col justify-between"},{default:i((()=>[c(d,null,{default:i((()=>[c(d,{class:"text-[28rpx] using-hidden leading-[40rpx] text-[#333]"},{default:i((()=>[f(x(e.item_name),1)])),_:2},1024),e.item_sub_name?(o(),p(d,{key:0,class:"text-[24rpx] mt-[14rpx] text-[var(--text-color-light9)] using-hidden leading-[28rpx]"},{default:i((()=>[f(x(e.item_sub_name),1)])),_:2},1024)):k("v-if",!0)])),_:2},1024),c(d,{class:"flex justify-between items-baseline"},{default:i((()=>[c(d,{class:"price-font text-[#FF4142]"},{default:i((()=>[c(r,{class:"text-[24rpx]"},{default:i((()=>[f("￥")])),_:1}),c(r,{class:"text-[40rpx] font-500"},{default:i((()=>[f(x(parseFloat(e.item_price).toFixed(2).split(".")[0]),1)])),_:2},1024),c(r,{class:"text-[24rpx] font-500"},{default:i((()=>[f("."+x(parseFloat(e.item_price).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024),c(r,{class:"text-right text-[26rpx]"},{default:i((()=>[f("x"+x(e.item_num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),256))])),_:1}),c(d,{class:"text-[26rpx] text-right"},{default:i((()=>[f(x(v.value.trade_info.item_total),1)])),_:1})],64)):(o(),p(d,{key:1,class:"text-[28rpx] leading-[40rpx] text-[#333]"},{default:i((()=>[f(x(v.value.body),1)])),_:1}))])),_:1})):k("v-if",!0)])),_:1})):k("v-if",!0),k(" 帮付说明 "),c(X,{ref_key:"messageRef",ref:q},null,512),k(" 支付 "),c(I,{ref_key:"payRef",ref:J},null,512),c(P,{loading:t.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-ef8918c2"]]);export{Y as default};
