import{d as e,r as t,k as a,l as r,m as l,p as o,q as s,t as n,g as i,i as p,o as u,c,w as d,b as m,s as x,x as f,y as g,u as _,a as b,f as v,z as y,A as h,B as k,C as w,D as j,j as C,I as S,E as A,F as T,G as V,H as L,J as O,K as I,L as P,n as B,M as F,N as q,O as z}from"./index-7c3a221b.js";import{_ as M,a as U}from"./u-checkbox-group.43373461.js";import{_ as E}from"./uni-popup.57849218.js";import{_ as N,a as R}from"./u-form.da80d0e8.js";import{_ as D}from"./sms-code.vue_vue_type_script_setup_true_lang.197b6cae.js";import{_ as G}from"./u-popup.9cffd7ac.js";import{_ as H}from"./_plugin-vue_export-helper.1b428a4d.js";import{t as J}from"./topTabbar.7ca2ef58.js";import"./u-icon.55521b35.js";import"./u-line.10b7be7f.js";import"./u-input.9b5ee2af.js";import"./u-modal.a4b92874.js";import"./u-loading-icon.2d721490.js";import"./u-transition.2636624c.js";const K=H(e({__name:"bind-mobile",setup(e,{expose:V}){const L=t(!1),O=a(),I=r((()=>O.info)),P=r((()=>l().login)),B=t(!1),F=t(!1),q=o({mobile:"",mobile_code:"",mobile_key:""}),z=t(!0);s((()=>{setTimeout((()=>{z.value=!1}),800),uni.getStorageSync("pid")&&Object.assign(q,{pid:uni.getStorageSync("pid")}),uni.getStorageSync("openid")&&Object.assign(q,{openid:uni.getStorageSync("openid")}),uni.getStorageSync("unionid")&&Object.assign(q,{unionid:uni.getStorageSync("unionid")}),uni.getStorageSync("nickname")&&Object.assign(q,{nickname:uni.getStorageSync("nickname")}),uni.getStorageSync("avatar")&&Object.assign(q,{headimg:uni.getStorageSync("avatar")})}));const E={mobile:[{type:"string",required:!0,message:n("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,t,a){uni.$u.test.mobile(t)?a():a(new Error("请输入正确的手机号"))},message:n("mobileError"),trigger:["change","blur"]}],mobile_code:{type:"string",required:!0,message:n("codePlaceholder"),trigger:["blur","change"]}},H=()=>{F.value=!F.value},J=t(null),K=()=>{J.value.validate().then((()=>{if(!F.value&&P.value.agreement_show)return void h({title:n("isAgreeTips"),icon:"none"});if(B.value)return;B.value=!0;(I.value?k:w)(q).then((e=>{I.value?(O.getMemberInfo(),I.value.mobile&&uni.removeStorageSync("isbindmobile")):(O.setToken(e.data.token),j().handleLoginBack()),L.value=!1})).catch((()=>{B.value=!1}))}))};return V({open:()=>{L.value=!0}}),(e,t)=>{const a=C,r=S,l=i(p("u-form-item"),N),o=i(p("sms-code"),D),s=i(p("u-checkbox"),M),h=i(p("u-checkbox-group"),U),k=A,w=T,j=i(p("u-form"),R),V=i(p("u-popup"),G);return u(),c(V,{show:L.value,onClose:t[7]||(t[7]=e=>L.value=!1),mode:"center",round:10,closeable:!0,safeAreaInsetBottom:!1,zIndex:"10086"},{default:d((()=>[m(a,{onTouchmove:t[6]||(t[6]=x((()=>{}),["prevent","stop"])),class:"max-w-[600rpx] w-[600rpx] box-border"},{default:d((()=>[m(a,{class:"text-center py-[var(--pad-top-m)] text-[32rpx] font-500 leading-[46rpx]"},{default:d((()=>[f(g(_(n)("bindMobile")),1)])),_:1}),m(a,{class:"px-[var(--pad-sidebar-m)] pb-[var(--pad-top-m)]"},{default:d((()=>[m(j,{labelPosition:"left",model:q,errorType:"toast",rules:E,ref_key:"formRef",ref:J},{default:d((()=>[m(l,{label:"",prop:"mobile",borderBottom:!0},{default:d((()=>[m(r,{modelValue:q.mobile,"onUpdate:modelValue":t[0]||(t[0]=e=>q.mobile=e),type:"number",maxlength:"11",placeholder:_(n)("mobilePlaceholder"),class:"w-full h-[50rpx] leading-[50rpx] !bg-transparent !px-[20rpx] text-[26rpx] text-[#333]",disabled:z.value,"placeholder-class":"bind-mobile"},null,8,["modelValue","placeholder","disabled"])])),_:1}),m(a,{class:"mt-[20rpx]"},{default:d((()=>[m(l,{label:"",prop:"mobile_code",borderBottom:!0},{right:d((()=>[_(P).agreement_show?(u(),c(o,{key:0,mobile:q.mobile,type:"login",modelValue:q.mobile_key,"onUpdate:modelValue":t[2]||(t[2]=e=>q.mobile_key=e),isAgree:F.value},null,8,["mobile","modelValue","isAgree"])):(u(),c(o,{key:1,mobile:q.mobile,type:"login",modelValue:q.mobile_key,"onUpdate:modelValue":t[3]||(t[3]=e=>q.mobile_key=e)},null,8,["mobile","modelValue"]))])),default:d((()=>[m(r,{modelValue:q.mobile_code,"onUpdate:modelValue":t[1]||(t[1]=e=>q.mobile_code=e),type:"number",maxlength:"6",placeholder:_(n)("codePlaceholder"),class:"box-border w-full h-[50rpx] leading-[50rpx] !bg-transparent !px-[20rpx] text-[26rpx] text-[#333]",disabled:z.value,"placeholder-class":"bind-mobile"},null,8,["modelValue","placeholder","disabled"])])),_:1})])),_:1}),_(P).agreement_show?(u(),c(a,{key:0,class:"flex items-center mt-[30rpx] pl-[10rpx] py-[10rpx]",onClick:x(H,["stop"])},{default:d((()=>[m(h,{onChange:H},{default:d((()=>[m(s,{activeColor:"var(--primary-color)",checked:F.value,shape:"circle",size:"28rpx"},null,8,["checked"])])),_:1}),m(a,{class:"text-[24rpx] text-[var(--text-color-light6)] flex items-center flex-wrap"},{default:d((()=>[m(k,null,{default:d((()=>[f(g(_(n)("agreeTips")),1)])),_:1}),m(k,{onClick:t[4]||(t[4]=x((e=>_(b)({url:"/app/pages/auth/agreement?key=privacy"})),["stop"])),class:"text-primary"},{default:d((()=>[f("《"+g(_(n)("privacyAgreement"))+"》",1)])),_:1}),m(k,null,{default:d((()=>[f(g(_(n)("and")),1)])),_:1}),m(k,{onClick:t[5]||(t[5]=x((e=>_(b)({url:"/app/pages/auth/agreement?key=service"})),["stop"])),class:"text-primary"},{default:d((()=>[f("《"+g(_(n)("userAgreement"))+"》",1)])),_:1})])),_:1})])),_:1},8,["onClick"])):v("v-if",!0),m(a,{class:"mt-[100rpx]"},{default:d((()=>[m(w,{class:y(["primary-btn-bg text-[26rpx] !text-[#fff] !h-[80rpx] leading-[80rpx] rounded-full font-500",{"opacity-50":B.value}]),disabled:B.value,onClick:K},{default:d((()=>[f(g(_(n)("bind")),1)])),_:1},8,["class","disabled"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-74d47890"]]),$=H(e({__name:"index",setup(e){let o={};J().setTopTabbarParam({title:"",topStatusBar:{textColor:"#333"}}),r((()=>Object.keys(o).length?z(Number(o.height))+z(o.top)+z(8)+"rpx":"auto")),t("");const s=t(!1),y=l(),k=r((()=>y.login)),w=j();a(),r((()=>a().info));const S=V();r((()=>!s.value&&y.login.agreement_show?"":"getPhoneNumber")),t(null);const N=r((()=>!y.login.is_auth_register)),R=t(!1);t(!1);const D=t(),G=()=>{D.value.close()},H=()=>{s.value=!0,D.value.close(),W()},$=t(null);L((async()=>{await S.getSiteInfoFn(),await y.getLoginConfig();let e=!y.login.is_username&&!y.login.is_mobile&&!y.login.is_bind_mobile;O()?!I()&&e&&N.value&&(h({title:"商家未开启登录注册",icon:"none"}),setTimeout((()=>{b({url:"/app/pages/index/index",mode:"reLaunch"})}),100)):!I()&&e&&(h({title:"商家未开启登录注册",icon:"none"}),setTimeout((()=>{b({url:"/app/pages/index/index",mode:"reLaunch"})}),100))})),P((()=>{R.value=!1}));const Q=r((()=>{var e="";return y.login.bg_url&&(e+="background-image:url("+q(y.login.bg_url)+");",e+="background-size: 100%;",e+="background-position: top;",e+="background-repeat: no-repeat;"),e})),W=(e=null,t=null)=>{((e="")=>!(s.value||!y.login.agreement_show||(e?h({title:n("isAgreeTips"),icon:"none"}):D.value.open(),0)))()||R.value||(R.value=!0,e||(e=()=>{R.value=!1}),X())},X=()=>{if(O()){let e=uni.getStorageSync("login_config");e.is_auth_register&&(e.is_bind_mobile?$.value.open():e.is_force_access_user_info?w.getAuthCode({scopes:"snsapi_userinfo"}):e.is_force_access_user_info||w.getAuthCode({scopes:"snsapi_base"})),R.value=!1}},Y=()=>{s.value=!s.value};return(e,t)=>{const a=F,r=C,l=T,o=i(p("u-checkbox"),M),y=i(p("u-checkbox-group"),U),h=A,w=i(p("uni-popup"),E),j=i(p("bind-mobile"),K);return u(),c(r,{class:"w-screen h-screen",style:B(e.themeColor())},{default:d((()=>[m(r,{class:"w-screen h-screen",style:B(_(Q))},{default:d((()=>[m(r,{class:"mx-[var(--sidebar-m)] px-[var(--pad-sidebar-m)]"},{default:d((()=>[m(r,{class:"pt-[154rpx] flex justify-center"},{default:d((()=>{var e,t;return[(null==(e=_(S).site)?void 0:e.front_end_logo)?(u(),c(r,{key:0,class:"h-[90rpx] w-[300rpx]"},{default:d((()=>{var e;return[m(a,{class:"h-[90rpx] w-[300rpx]",src:_(q)(null==(e=_(S).site)?void 0:e.front_end_logo),mode:"aspectFit"},null,8,["src"])]})),_:1})):(null==(t=_(S).site)?void 0:t.front_end_icon)?(u(),c(r,{key:1,class:"h-[250rpx] w-[250rpx]"},{default:d((()=>{var e;return[m(a,{class:"h-[250rpx] w-[250rpx]",src:_(q)(null==(e=_(S).site)?void 0:e.front_end_icon),mode:"aspectFit"},null,8,["src"])]})),_:1})):(u(),c(r,{key:2,class:"h-[90rpx] w-[300rpx]"}))]})),_:1}),m(r,{class:"text-[var(--text-color-light6)]] text-[28rpx] text-center leading-[34rpx] min-h-[34rpx] mt-[40rpx]"},{default:d((()=>[f(g(_(k).desc),1)])),_:1}),m(r,{class:"mt-[181rpx]"},{default:d((()=>[v(" 微信公众号快捷登录，开启自动注册的情况下才能使用 "),_(O)()&&_(k).is_auth_register?(u(),c(r,{key:0,class:"w-full flex items-center justify-center mb-[40rpx]"},{default:d((()=>[m(l,{class:"w-[630rpx] h-[88rpx] !mx-[0] !bg-[var(--primary-color)] text-[26rpx] rounded-[44rpx] leading-[88rpx] font-500 !text-[#fff]",onClick:t[0]||(t[0]=e=>W())},{default:d((()=>[f(g(_(n)("quickLoginOrLogout")),1)])),_:1})])),_:1})):v("v-if",!0),v(" 手机号登录 "),_(k).is_mobile?(u(),c(r,{key:1,class:"mb-[40rpx] w-full flex items-center justify-center"},{default:d((()=>[m(l,{class:"w-[630rpx] h-[88rpx] !mx-[0] !bg-[#fff] border-[var(--primary-color)] border-solid border-[2rpx] text-[26rpx] rounded-[44rpx] leading-[84rpx] !text-[var(--primary-color)]",onClick:t[1]||(t[1]=e=>_(b)({url:"/app/pages/auth/login",param:{type:"mobile"}}))},{default:d((()=>[f(g(_(n)("mobileLogin")),1)])),_:1})])),_:1})):!_(k).is_mobile&&_(k).is_username?(u(),c(r,{key:2,class:"w-full flex items-center justify-center"},{default:d((()=>[m(l,{class:"w-[630rpx] h-[88rpx] !mx-[0] !bg-[#fff] !border-[var(--primary-color)] border-solid border-[2rpx] text-[26rpx] rounded-[44rpx] leading-[84rpx] !text-[var(--primary-color)]",onClick:t[2]||(t[2]=e=>_(b)({url:"/app/pages/auth/login",param:{type:"username"}}))},{default:d((()=>[f(g(_(n)("accountLogin")),1)])),_:1})])),_:1})):v("v-if",!0),_(k).agreement_show?(u(),c(r,{key:3,class:"w-full flex items-center justify-center mt-[28rpx]"},{default:d((()=>[m(r,{class:"flex items-center justify-center mt-[28rpx] py-[14rpx] px-[50rpx]",onClick:x(Y,["stop"])},{default:d((()=>[m(y,{onChange:Y},{default:d((()=>[m(o,{activeColor:"var(--primary-color)",checked:s.value,shape:"circle",size:"30rpx"},null,8,["checked"])])),_:1}),m(r,{class:"text-[24rpx] text-[var(--text-color-light6)] flex items-center flex-wrap leading-[30rpx]"},{default:d((()=>[m(h,null,{default:d((()=>[f(g(_(n)("agreeTips")),1)])),_:1}),m(h,{onClick:t[3]||(t[3]=x((e=>_(b)({url:"/app/pages/auth/agreement?key=privacy"})),["stop"])),class:"text-primary"},{default:d((()=>[f("《"+g(_(n)("privacyAgreement"))+"》",1)])),_:1}),m(h,null,{default:d((()=>[f(g(_(n)("and")),1)])),_:1}),m(h,{onClick:t[4]||(t[4]=x((e=>_(b)({url:"/app/pages/auth/agreement?key=service"})),["stop"])),class:"text-primary"},{default:d((()=>[f("《"+g(_(n)("userAgreement"))+"》",1)])),_:1})])),_:1})])),_:1},8,["onClick"])])),_:1})):v("v-if",!0),_(k).is_mobile&&_(k).is_username?(u(),c(r,{key:4,class:"footer w-full"},{default:d((()=>[m(r,{class:"text-[26rpx] leading-[36rpx] text-[333] text-center mb-[30rpx] font-400"},{default:d((()=>[f(g(_(n)("otherLogin")),1)])),_:1}),m(r,{class:"flex justify-center"},{default:d((()=>[m(r,{class:"h-[80rpx] w-[80rpx] text-center leading-[78rpx] border-[2rpx] text-[#FF7100] rounded-[50%] border-solid border-[#ddd] nc-iconfont nc-icon-wodeV6mm3 text-[46rpx] overflow-hidden",onClick:t[5]||(t[5]=e=>_(b)({url:"/app/pages/auth/login",param:{type:"username"}}))})])),_:1}),m(r,{class:"text-[24rpx] leading-[36rpx] text-[var(--text-color-light9)] text-center font-400 mt-[30rpx]"},{default:d((()=>[f(g(_(n)("accountLogin")),1)])),_:1})])),_:1})):v("v-if",!0)])),_:1})])),_:1})])),_:1},8,["style"]),m(w,{ref_key:"popupRef",ref:D,type:"dialog"},{default:d((()=>[m(r,{class:"bg-[#fff] flex flex-col justify-between w-[600rpx] min-h-[280rpx] rounded-[var(--rounded-big)] box-border px-[35rpx] pt-[35rpx] pb-[8rpx] relative"},{default:d((()=>[m(r,{class:"flex justify-center"},{default:d((()=>[m(h,{class:"text-[33rpx] font-700"},{default:d((()=>[f(" 用户协议及隐私保护")])),_:1})])),_:1}),m(r,{class:"flex items-center mb-[20rpx] mt-[20rpx] py-[20rpx]",onClick:x(Y,["stop"])},{default:d((()=>[m(r,{class:"text-[26rpx] text-[var(--text-color-light6)] flex items-center flex-wrap"},{default:d((()=>[m(h,null,{default:d((()=>[f(g(_(n)("agreeTips")),1)])),_:1}),m(h,{onClick:t[6]||(t[6]=x((e=>_(b)({url:"/app/pages/auth/agreement?key=privacy"})),["stop"])),class:"text-primary"},{default:d((()=>[f("《"+g(_(n)("privacyAgreement"))+"》",1)])),_:1}),m(h,null,{default:d((()=>[f(g(_(n)("and")),1)])),_:1}),m(h,{onClick:t[7]||(t[7]=x((e=>_(b)({url:"/app/pages/auth/agreement?key=service"})),["stop"])),class:"text-primary"},{default:d((()=>[f("《"+g(_(n)("userAgreement"))+"》",1)])),_:1})])),_:1})])),_:1},8,["onClick"]),m(r,{class:""},{default:d((()=>[m(r,{class:"w-[100%] flex justify-center bg-[var(--primary-color)] h-[70rpx] leading-[70rpx] text-[#fff] text-[26rpx] border-[0] font-500 rounded-[50rpx]",onClick:H},{default:d((()=>[f("同意并登录")])),_:1}),m(r,{class:"w-[100%] flex justify-center h-[70rpx] leading-[70rpx] text-[#999] text-[24rpx] border-[0] font-500 rounded-[50rpx]",onClick:G},{default:d((()=>[f("不同意")])),_:1})])),_:1})])),_:1})])),_:1},512),v(" 强制绑定手机号 "),m(j,{ref_key:"bindMobileRef",ref:$},null,512)])),_:1},8,["style"])}}}),[["__scopeId","data-v-53f07846"]]);export{$ as default};
