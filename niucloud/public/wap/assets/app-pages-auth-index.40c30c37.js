import{d as e,r as t,k as r,l as a,m as l,p as o,q as s,t as n,g as i,i as u,o as p,c,w as d,b as m,s as x,x as f,y as g,u as _,a as b,f as v,z as y,A as h,B as k,C as w,D as S,j,I as C,E as A,F as T,G as L,H as V,J as O,K as B,L as I,n as P,M as F,N as q,O as z}from"./index-4dda66b6.js";import{_ as M,a as U}from"./u-checkbox-group.56070d31.js";import{_ as E}from"./uni-popup.0616e319.js";import{_ as N,a as R}from"./u-form.a2a3220e.js";import{_ as D}from"./sms-code.vue_vue_type_script_setup_true_lang.fc19aacd.js";import{_ as G}from"./u-popup.5542352e.js";import{_ as H}from"./_plugin-vue_export-helper.1b428a4d.js";import{t as J}from"./topTabbar.8c5d3fa7.js";import"./u-icon.252ff5e7.js";import"./u-line.89feda2c.js";import"./u-input.52123ca7.js";import"./u-modal.e4391a5a.js";import"./u-loading-icon.10016ae2.js";import"./u-transition.c22f21f6.js";const K=H(e({__name:"bind-mobile",setup(e,{expose:L}){const V=t(!1),O=r(),B=a((()=>O.info)),I=a((()=>l().login)),P=t(!1),F=t(!1),q=o({mobile:"",mobile_code:"",mobile_key:""}),z=t(!0);s((()=>{setTimeout((()=>{z.value=!1}),800),uni.getStorageSync("pid")&&Object.assign(q,{pid:uni.getStorageSync("pid")}),uni.getStorageSync("openid")&&Object.assign(q,{openid:uni.getStorageSync("openid")}),uni.getStorageSync("unionid")&&Object.assign(q,{unionid:uni.getStorageSync("unionid")}),uni.getStorageSync("nickname")&&Object.assign(q,{nickname:uni.getStorageSync("nickname")}),uni.getStorageSync("avatar")&&Object.assign(q,{headimg:uni.getStorageSync("avatar")})}));const E={mobile:[{type:"string",required:!0,message:n("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,t,r){uni.$u.test.mobile(t)?r():r(new Error("请输入正确的手机号"))},message:n("mobileError"),trigger:["change","blur"]}],mobile_code:{type:"string",required:!0,message:n("codePlaceholder"),trigger:["blur","change"]}},H=()=>{F.value=!F.value},J=t(null),K=()=>{J.value.validate().then((()=>{if(!F.value&&I.value.agreement_show)return void h({title:n("isAgreeTips"),icon:"none"});if(P.value)return;P.value=!0;(B.value?k:w)(q).then((e=>{B.value?(O.getMemberInfo(),B.value.mobile&&uni.removeStorageSync("isBindMobile")):(O.setToken(e.data.token),S().handleLoginBack()),V.value=!1})).catch((()=>{P.value=!1}))}))};return L({open:()=>{V.value=!0}}),(e,t)=>{const r=j,a=C,l=i(u("u-form-item"),N),o=i(u("sms-code"),D),s=i(u("u-checkbox"),M),h=i(u("u-checkbox-group"),U),k=A,w=T,S=i(u("u-form"),R),L=i(u("u-popup"),G);return p(),c(L,{show:V.value,onClose:t[7]||(t[7]=e=>V.value=!1),mode:"center",round:10,closeable:!0,safeAreaInsetBottom:!1,zIndex:"10086"},{default:d((()=>[m(r,{onTouchmove:t[6]||(t[6]=x((()=>{}),["prevent","stop"])),class:"max-w-[600rpx] w-[600rpx] box-border"},{default:d((()=>[m(r,{class:"text-center py-[var(--pad-top-m)] text-[32rpx] font-500 leading-[46rpx]"},{default:d((()=>[f(g(_(n)("bindMobile")),1)])),_:1}),m(r,{class:"px-[var(--pad-sidebar-m)] pb-[var(--pad-top-m)]"},{default:d((()=>[m(S,{labelPosition:"left",model:q,errorType:"toast",rules:E,ref_key:"formRef",ref:J},{default:d((()=>[m(l,{label:"",prop:"mobile",borderBottom:!0},{default:d((()=>[m(a,{modelValue:q.mobile,"onUpdate:modelValue":t[0]||(t[0]=e=>q.mobile=e),type:"number",maxlength:"11",placeholder:_(n)("mobilePlaceholder"),class:"w-full h-[50rpx] leading-[50rpx] !bg-transparent !px-[20rpx] text-[26rpx] text-[#333]",disabled:z.value,"placeholder-class":"bind-mobile"},null,8,["modelValue","placeholder","disabled"])])),_:1}),m(r,{class:"mt-[20rpx]"},{default:d((()=>[m(l,{label:"",prop:"mobile_code",borderBottom:!0},{right:d((()=>[_(I).agreement_show?(p(),c(o,{key:0,mobile:q.mobile,type:"login",modelValue:q.mobile_key,"onUpdate:modelValue":t[2]||(t[2]=e=>q.mobile_key=e),isAgree:F.value},null,8,["mobile","modelValue","isAgree"])):(p(),c(o,{key:1,mobile:q.mobile,type:"login",modelValue:q.mobile_key,"onUpdate:modelValue":t[3]||(t[3]=e=>q.mobile_key=e)},null,8,["mobile","modelValue"]))])),default:d((()=>[m(a,{modelValue:q.mobile_code,"onUpdate:modelValue":t[1]||(t[1]=e=>q.mobile_code=e),type:"number",maxlength:"6",placeholder:_(n)("codePlaceholder"),class:"box-border w-full h-[50rpx] leading-[50rpx] !bg-transparent !px-[20rpx] text-[26rpx] text-[#333]",disabled:z.value,"placeholder-class":"bind-mobile"},null,8,["modelValue","placeholder","disabled"])])),_:1})])),_:1}),_(I).agreement_show?(p(),c(r,{key:0,class:"flex items-center mt-[30rpx] pl-[10rpx] py-[10rpx]",onClick:x(H,["stop"])},{default:d((()=>[m(h,{onChange:H},{default:d((()=>[m(s,{activeColor:"var(--primary-color)",checked:F.value,shape:"circle",size:"28rpx"},null,8,["checked"])])),_:1}),m(r,{class:"text-[24rpx] text-[var(--text-color-light6)] flex items-center flex-wrap"},{default:d((()=>[m(k,null,{default:d((()=>[f(g(_(n)("agreeTips")),1)])),_:1}),m(k,{onClick:t[4]||(t[4]=x((e=>_(b)({url:"/app/pages/auth/agreement?key=privacy"})),["stop"])),class:"text-primary"},{default:d((()=>[f("《"+g(_(n)("privacyAgreement"))+"》",1)])),_:1}),m(k,null,{default:d((()=>[f(g(_(n)("and")),1)])),_:1}),m(k,{onClick:t[5]||(t[5]=x((e=>_(b)({url:"/app/pages/auth/agreement?key=service"})),["stop"])),class:"text-primary"},{default:d((()=>[f("《"+g(_(n)("userAgreement"))+"》",1)])),_:1})])),_:1})])),_:1},8,["onClick"])):v("v-if",!0),m(r,{class:"mt-[100rpx]"},{default:d((()=>[m(w,{class:y(["primary-btn-bg text-[26rpx] !text-[#fff] !h-[80rpx] leading-[80rpx] rounded-full font-500",{"opacity-50":P.value}]),disabled:P.value,onClick:K},{default:d((()=>[f(g(_(n)("bind")),1)])),_:1},8,["class","disabled"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-eca9e58c"]]),$=H(e({__name:"index",setup(e){let o={};J().setTopTabbarParam({title:"",topStatusBar:{textColor:"#333"}}),a((()=>Object.keys(o).length?z(Number(o.height))+z(o.top)+z(8)+"rpx":"auto"));const s=t(""),y=t(!1),k=l(),w=a((()=>k.login)),C=S();r(),a((()=>r().info));const N=L();a((()=>!y.value&&k.login.agreement_show?"":"getPhoneNumber")),t(null);const R=a((()=>!k.login.is_auth_register)),D=t(!1);t(!1);const G=t(),H=()=>{G.value.close()},$=()=>{y.value=!0,G.value.close(),Y()},Q=t(null),W=()=>{Q.value.open()};V((async()=>{await N.getSiteInfoFn(),await k.getLoginConfig();let e=!k.login.is_username&&!k.login.is_mobile&&!k.login.is_bind_mobile;O()?!B()&&e&&R.value&&(h({title:"商家未开启登录注册",icon:"none"}),setTimeout((()=>{b({url:"/app/pages/index/index",mode:"reLaunch"})}),100)):!B()&&e&&(h({title:"商家未开启登录注册",icon:"none"}),setTimeout((()=>{b({url:"/app/pages/index/index",mode:"reLaunch"})}),100))})),I((()=>{D.value=!1}));const X=a((()=>{var e="";return k.login.bg_url&&(e+="background-image:url("+q(k.login.bg_url)+");",e+="background-size: 100%;",e+="background-position: top;",e+="background-repeat: no-repeat;"),e})),Y=(e=null,t=null)=>{((e="")=>!(y.value||!k.login.agreement_show||(e?h({title:n("isAgreeTips"),icon:"none"}):G.value.open(),0)))()||D.value||(D.value=!0,e||(e=()=>{D.value=!1}),Z())},Z=()=>{if(O()){let e=uni.getStorageSync("login_config");if(uni.getStorageSync("member_lock"))return h({title:n("memberLock"),icon:"none"}),void setTimeout((()=>{uni.removeStorageSync("member_lock"),b({url:"/app/pages/index/index",mode:"reLaunch"})}),1e3);if(e.wechat_error)return D.value=!1,void h({title:e.wechat_error,icon:"none"});s.value=uni.getStorageSync("wap_member_mobile"),s.value||(s.value=uni.getStorageSync("wap_member_not_control_mobile")),e.is_auth_register?!s.value&&e.is_bind_mobile?W():e.is_force_access_user_info?C.getAuthCode({scopes:"snsapi_userinfo"}):e.is_force_access_user_info||C.getAuthCode({scopes:"snsapi_base"}):!s.value&&e.is_bind_mobile?W():C.getAuthCode({scopes:"snsapi_base"}),D.value=!1}},ee=()=>{y.value=!y.value};return(e,t)=>{const r=F,a=j,l=T,o=i(u("u-checkbox"),M),s=i(u("u-checkbox-group"),U),h=A,k=i(u("uni-popup"),E),S=i(u("bind-mobile"),K);return p(),c(a,{class:"w-screen h-screen",style:P(e.themeColor())},{default:d((()=>[m(a,{class:"w-screen h-screen",style:P(_(X))},{default:d((()=>[m(a,{class:"mx-[var(--sidebar-m)] px-[var(--pad-sidebar-m)]"},{default:d((()=>[m(a,{class:"pt-[154rpx] flex justify-center"},{default:d((()=>{var e,t;return[(null==(e=_(N).site)?void 0:e.front_end_logo)?(p(),c(a,{key:0,class:"h-[90rpx] w-[300rpx]"},{default:d((()=>{var e;return[m(r,{class:"h-[90rpx] w-[300rpx]",src:_(q)(null==(e=_(N).site)?void 0:e.front_end_logo),mode:"aspectFit"},null,8,["src"])]})),_:1})):(null==(t=_(N).site)?void 0:t.front_end_icon)?(p(),c(a,{key:1,class:"h-[250rpx] w-[250rpx]"},{default:d((()=>{var e;return[m(r,{class:"h-[250rpx] w-[250rpx]",src:_(q)(null==(e=_(N).site)?void 0:e.front_end_icon),mode:"aspectFit"},null,8,["src"])]})),_:1})):(p(),c(a,{key:2,class:"h-[90rpx] w-[300rpx]"}))]})),_:1}),m(a,{class:"text-[var(--text-color-light6)]] text-[28rpx] text-center leading-[34rpx] min-h-[34rpx] mt-[40rpx]"},{default:d((()=>[f(g(_(w).desc),1)])),_:1}),m(a,{class:"mt-[181rpx]"},{default:d((()=>[v(" 微信公众号快捷登录，开启自动注册的情况下才能使用 "),_(O)()&&_(w).is_auth_register?(p(),c(a,{key:0,class:"w-full flex items-center justify-center mb-[40rpx]"},{default:d((()=>[m(l,{class:"w-[630rpx] h-[88rpx] !mx-[0] !bg-[var(--primary-color)] text-[26rpx] rounded-[44rpx] leading-[88rpx] font-500 !text-[#fff]",onClick:t[0]||(t[0]=e=>Y())},{default:d((()=>[f(g(_(n)("quickLoginOrLogout")),1)])),_:1})])),_:1})):v("v-if",!0),v(" 手机号登录 "),_(w).is_mobile?(p(),c(a,{key:1,class:"mb-[40rpx] w-full flex items-center justify-center"},{default:d((()=>[m(l,{class:"w-[630rpx] h-[88rpx] !mx-[0] !bg-[#fff] border-[var(--primary-color)] border-solid border-[2rpx] text-[26rpx] rounded-[44rpx] leading-[84rpx] !text-[var(--primary-color)]",onClick:t[1]||(t[1]=e=>_(b)({url:"/app/pages/auth/login",param:{type:"mobile"}}))},{default:d((()=>[f(g(_(n)("mobileLogin")),1)])),_:1})])),_:1})):!_(w).is_mobile&&_(w).is_username?(p(),c(a,{key:2,class:"w-full flex items-center justify-center"},{default:d((()=>[m(l,{class:"w-[630rpx] h-[88rpx] !mx-[0] !bg-[#fff] !border-[var(--primary-color)] border-solid border-[2rpx] text-[26rpx] rounded-[44rpx] leading-[84rpx] !text-[var(--primary-color)]",onClick:t[2]||(t[2]=e=>_(b)({url:"/app/pages/auth/login",param:{type:"username"}}))},{default:d((()=>[f(g(_(n)("accountLogin")),1)])),_:1})])),_:1})):v("v-if",!0),_(w).agreement_show?(p(),c(a,{key:3,class:"w-full flex items-center justify-center mt-[28rpx]"},{default:d((()=>[m(a,{class:"flex items-center justify-center mt-[28rpx] py-[14rpx] px-[50rpx]",onClick:x(ee,["stop"])},{default:d((()=>[m(s,{onChange:ee},{default:d((()=>[m(o,{activeColor:"var(--primary-color)",checked:y.value,shape:"circle",size:"30rpx"},null,8,["checked"])])),_:1}),m(a,{class:"text-[24rpx] text-[var(--text-color-light6)] flex items-center flex-wrap leading-[30rpx]"},{default:d((()=>[m(h,null,{default:d((()=>[f(g(_(n)("agreeTips")),1)])),_:1}),m(h,{onClick:t[3]||(t[3]=x((e=>_(b)({url:"/app/pages/auth/agreement?key=privacy"})),["stop"])),class:"text-primary"},{default:d((()=>[f("《"+g(_(n)("privacyAgreement"))+"》",1)])),_:1}),m(h,null,{default:d((()=>[f(g(_(n)("and")),1)])),_:1}),m(h,{onClick:t[4]||(t[4]=x((e=>_(b)({url:"/app/pages/auth/agreement?key=service"})),["stop"])),class:"text-primary"},{default:d((()=>[f("《"+g(_(n)("userAgreement"))+"》",1)])),_:1})])),_:1})])),_:1},8,["onClick"])])),_:1})):v("v-if",!0),_(w).is_mobile&&_(w).is_username?(p(),c(a,{key:4,class:"footer w-full"},{default:d((()=>[m(a,{class:"text-[26rpx] leading-[36rpx] text-[333] text-center mb-[30rpx] font-400"},{default:d((()=>[f(g(_(n)("otherLogin")),1)])),_:1}),m(a,{class:"flex justify-center"},{default:d((()=>[m(a,{class:"h-[80rpx] w-[80rpx] text-center leading-[78rpx] border-[2rpx] text-[#FF7100] rounded-[50%] border-solid border-[#ddd] nc-iconfont nc-icon-wodeV6mm3 text-[46rpx] overflow-hidden",onClick:t[5]||(t[5]=e=>_(b)({url:"/app/pages/auth/login",param:{type:"username"}}))})])),_:1}),m(a,{class:"text-[24rpx] leading-[36rpx] text-[var(--text-color-light9)] text-center font-400 mt-[30rpx]"},{default:d((()=>[f(g(_(n)("accountLogin")),1)])),_:1})])),_:1})):v("v-if",!0)])),_:1})])),_:1})])),_:1},8,["style"]),m(k,{ref_key:"popupRef",ref:G,type:"dialog"},{default:d((()=>[m(a,{class:"bg-[#fff] flex flex-col justify-between w-[600rpx] min-h-[280rpx] rounded-[var(--rounded-big)] box-border px-[35rpx] pt-[35rpx] pb-[8rpx] relative"},{default:d((()=>[m(a,{class:"flex justify-center"},{default:d((()=>[m(h,{class:"text-[33rpx] font-700"},{default:d((()=>[f(" 用户协议及隐私保护")])),_:1})])),_:1}),m(a,{class:"flex items-center mb-[20rpx] mt-[20rpx] py-[20rpx]",onClick:x(ee,["stop"])},{default:d((()=>[m(a,{class:"text-[26rpx] text-[var(--text-color-light6)] flex items-center flex-wrap"},{default:d((()=>[m(h,null,{default:d((()=>[f(g(_(n)("agreeTips")),1)])),_:1}),m(h,{onClick:t[6]||(t[6]=x((e=>_(b)({url:"/app/pages/auth/agreement?key=privacy"})),["stop"])),class:"text-primary"},{default:d((()=>[f("《"+g(_(n)("privacyAgreement"))+"》",1)])),_:1}),m(h,null,{default:d((()=>[f(g(_(n)("and")),1)])),_:1}),m(h,{onClick:t[7]||(t[7]=x((e=>_(b)({url:"/app/pages/auth/agreement?key=service"})),["stop"])),class:"text-primary"},{default:d((()=>[f("《"+g(_(n)("userAgreement"))+"》",1)])),_:1})])),_:1})])),_:1},8,["onClick"]),m(a,null,{default:d((()=>[m(a,{class:"w-[100%] flex justify-center bg-[var(--primary-color)] h-[70rpx] leading-[70rpx] text-[#fff] text-[26rpx] border-[0] font-500 rounded-[50rpx]",onClick:$},{default:d((()=>[f("同意并登录")])),_:1}),m(a,{class:"w-[100%] flex justify-center h-[70rpx] leading-[70rpx] text-[#999] text-[24rpx] border-[0] font-500 rounded-[50rpx]",onClick:H},{default:d((()=>[f("不同意")])),_:1})])),_:1})])),_:1})])),_:1},512),v(" 强制绑定手机号 "),m(S,{ref_key:"bindMobileRef",ref:Q},null,512)])),_:1},8,["style"])}}}),[["__scopeId","data-v-ee46f80a"]]);export{$ as default};
